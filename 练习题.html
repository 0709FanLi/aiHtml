<html_code>
  <!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>QuizCraft AI - Personalized Learning Made Easy with AI</title>
      <!-- Font Awesome -->
      <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      />
      <!-- Google Fonts -->
      <link rel="preconnect" href="https://fonts.googleapis.com" />
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
      <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Open+Sans:ital,wght@0,400;0,600;1,400&display=swap"
        rel="stylesheet"
      />
      <!-- Bootstrap 5 -->
      <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        rel="stylesheet"
      />
      <!-- Custom CSS -->
      <style>
        /* ===== VARIABLES ===== */
        :root {
          /* Colors */
          --primary: #1a73e8;
          --secondary: #34a853;
          --neutral-light: #f8f9fa;
          --neutral-medium: #dadce0;
          --neutral-dark: #202124;
          --accent: #fa7b17;
          --success: #0f9d58;
          --warning: #f4b400;
          --error: #d93025;

          /* Typography */
          --font-heading: "Montserrat", sans-serif;
          --font-body: "Open Sans", sans-serif;
        }

        /* ===== GLOBAL STYLES ===== */
        html, body {
          height: 100%;
        }

        body {
          font-family: var(--font-body);
          font-size: 16px;
          line-height: 1.5;
          color: var(--neutral-dark);
          background-color: #fff;
          overflow-x: hidden;
          display: flex;
          flex-direction: column;
          min-height: 100vh; /* 视口高度 */
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
          font-family: var(--font-heading);
          font-weight: 700;
          margin-bottom: 1rem;
        }

        h1 {
          font-size: 2.5rem; /* 40px */
        }

        h2 {
          font-size: 2rem; /* 32px */
        }

        h3 {
          font-size: 1.75rem; /* 28px */
          font-weight: 600;
        }

        h4 {
          font-size: 1.5rem; /* 24px */
          font-weight: 600;
        }

        a {
          color: var(--primary);
          text-decoration: none;
          transition: color 0.3s ease;
        }

        a:hover {
          color: #0d5bbc;
        }

        .btn {
          font-size: 0.9375rem; /* 15px */
          font-weight: 600;
          padding: 0.625rem 1.25rem;
          border-radius: 4px;
          transition: all 0.3s ease;
        }

        .btn-primary {
          background-color: var(--primary);
          border-color: var(--primary);
        }

        .btn-primary:hover {
          background-color: #0d5bbc;
          border-color: #0d5bbc;
        }

        .btn-accent {
          background-color: var(--accent);
          border-color: var(--accent);
          color: white;
        }

        .btn-accent:hover {
          background-color: #e06700;
          border-color: #e06700;
          color: white;
        }

        .btn-outline-primary {
          color: var(--primary);
          border-color: var(--primary);
        }

        .btn-outline-primary:hover {
          background-color: var(--primary);
          color: white;
        }

        .card {
          border: none;
          border-radius: 8px;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
          transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
          transform: translateY(-5px);
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .section-padding {
          padding: 5rem 0;
        }

        .text-primary {
          color: var(--primary) !important;
        }

        .bg-light {
          background-color: var(--neutral-light) !important;
        }

        .form-control {
          padding: 0.75rem 1rem;
          border: 1px solid var(--neutral-medium);
          border-radius: 4px;
        }

        .form-control:focus {
          border-color: var(--primary);
          box-shadow: 0 0 0 0.2rem rgba(26, 115, 232, 0.25);
        }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
          from {
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }

        @keyframes slideInRight {
          from {
            transform: translateX(50px);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }

        @keyframes slideInLeft {
          from {
            transform: translateX(-50px);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }

        @keyframes slideInUp {
          from {
            transform: translateY(30px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }

        .animate-fade-in {
          animation: fadeIn 0.8s ease forwards;
        }

        .animate-slide-right {
          animation: slideInRight 0.8s ease forwards;
        }

        .animate-slide-left {
          animation: slideInLeft 0.8s ease forwards;
        }

        .animate-slide-up {
          animation: slideInUp 0.8s ease forwards;
        }

        .delay-100 {
          animation-delay: 0.1s;
        }
        .delay-200 {
          animation-delay: 0.2s;
        }
        .delay-300 {
          animation-delay: 0.3s;
        }
        .delay-400 {
          animation-delay: 0.4s;
        }
        .delay-500 {
          animation-delay: 0.5s;
        }

        /* ===== HEADER ===== */
        .navbar {
          padding: 1rem 2rem;
          background-color: white;
          transition: all 0.3s ease;
        }

        .navbar.scrolled {
          padding: 0.5rem 2rem;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand {
          font-family: var(--font-heading);
          font-weight: 700;
          font-size: 1.5rem;
          color: var(--primary);
        }

        .navbar-nav {
          display: flex;
          justify-content: center;
          width: 100%;
        }

        .navbar-nav .nav-item {
          margin: 0 0.5rem;
        }

        .navbar-nav .nav-link {
          color: var(--neutral-dark);
          font-weight: 500;
          padding: 0.5rem 1rem;
          transition: color 0.3s ease;
        }

        .navbar-nav .nav-link:hover,
        .navbar-nav .nav-link.active {
          color: var(--primary);
        }

        .navbar-user {
          display: flex;
          align-items: center;
        }

        .navbar-user-avatar {
          width: 32px;
          height: 32px;
          border-radius: 50%;
          margin-right: 0.5rem;
        }

        .navbar-user-name {
          font-weight: 500;
          margin-right: 0.5rem;
        }

        .navbar-user-credits {
          background-color: rgba(26, 115, 232, 0.1);
          color: var(--primary);
          padding: 0.25rem 0.5rem;
          border-radius: 100px;
          font-size: 0.75rem;
          font-weight: 600;
          min-width: 70px;
          text-align: center;
          white-space: nowrap;
        }

        /* ===== HERO SECTION ===== */
        .hero {
          background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
          padding: 6rem 0;
          position: relative;
          overflow: hidden;
        }

        .hero h1 {
          font-size: 3rem;
          margin-bottom: 1.5rem;
        }

        .hero p {
          font-size: 1.25rem;
          margin-bottom: 2rem;
          color: #495057;
        }

        .hero-buttons .btn {
          margin-right: 1rem;
          margin-bottom: 1rem;
          padding: 0.75rem 1.5rem;
          font-size: 1rem;
        }

        /* ===== FEATURES SECTION ===== */
        .features-card {
          padding: 2rem;
          height: 100%;
          text-align: center;
        }

        .features-card i {
          font-size: 2.5rem;
          color: var(--primary);
          margin-bottom: 1.5rem;
        }

        .features-card h3 {
          font-size: 1.5rem;
          margin-bottom: 1rem;
        }

        /* ===== TESTIMONIALS ===== */
        .testimonial-card {
          padding: 2rem;
          margin-bottom: 2rem;
        }

        .testimonial-card .quote {
          font-size: 1.1rem;
          font-style: italic;
          margin-bottom: 1rem;
        }

        .testimonial-author {
          display: flex;
          align-items: center;
        }

        .testimonial-author img {
          width: 50px;
          height: 50px;
          border-radius: 50%;
          margin-right: 1rem;
        }

        .testimonial-author-name {
          font-weight: 600;
          margin-bottom: 0.25rem;
        }

        .testimonial-author-title {
          font-size: 0.875rem;
          color: #6c757d;
        }

        /* ===== STATS SECTION ===== */
        .stats-container {
          background-color: var(--primary);
          padding: 4rem 0;
          color: white;
        }

        .stat-item {
          text-align: center;
        }

        .stat-number {
          font-size: 3rem;
          font-weight: 700;
          margin-bottom: 0.5rem;
        }

        .stat-label {
          font-size: 1.125rem;
          opacity: 0.9;
        }

        /* ===== PRICING SECTION ===== */
        .pricing-card {
          padding: 2rem;
          text-align: center;
          border: 1px solid var(--neutral-medium);
          height: 100%;
          position: relative;
        }

        .pricing-card.popular {
          border-color: var(--primary);
          box-shadow: 0 5px 20px rgba(26, 115, 232, 0.15);
        }

        .pricing-card .popular-badge {
          position: absolute;
          top: 0;
          right: 1.5rem;
          background-color: var(--primary);
          color: white;
          padding: 0.25rem 1rem;
          font-size: 0.75rem;
          font-weight: 600;
          border-radius: 0 0 8px 8px;
        }

        .pricing-card .price {
          font-size: 3rem;
          font-weight: 700;
          color: var(--primary);
          margin: 1.5rem 0;
        }

        .pricing-card .price small {
          font-size: 1rem;
          font-weight: 400;
          color: #6c757d;
        }

        .pricing-card .feature-list {
          margin: 2rem 0;
          padding: 0;
          list-style: none;
        }

        .pricing-card .feature-list li {
          margin-bottom: 0.75rem;
          padding-bottom: 0.75rem;
          border-bottom: 1px solid #f1f1f1;
        }

        .pricing-card .feature-list li:last-child {
          border-bottom: none;
        }

        /* ===== HOW IT WORKS ===== */
        .step-card {
          padding: 2rem;
          text-align: center;
          position: relative;
        }

        .step-number {
          width: 40px;
          height: 40px;
          background-color: var(--primary);
          color: white;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: 600;
          margin: 0 auto 1.5rem;
        }

        .step-card i {
          font-size: 3rem;
          color: var(--primary);
          margin-bottom: 1.5rem;
        }

        .step-connector {
          position: absolute;
          top: 60px;
          right: -30px;
          width: 60px;
          height: 2px;
          background-color: var(--primary);
          z-index: 1;
        }

        .step-connector:after {
          content: "";
          position: absolute;
          right: 0;
          top: -3px;
          width: 8px;
          height: 8px;
          border-top: 2px solid var(--primary);
          border-right: 2px solid var(--primary);
          transform: rotate(45deg);
        }

        /* ===== FAQ SECTION ===== */
        .accordion-item {
          border: 1px solid var(--neutral-medium);
          border-radius: 8px !important;
          margin-bottom: 1rem;
          overflow: hidden;
        }

        .accordion-button {
          font-weight: 600;
          padding: 1.25rem;
        }

        .accordion-button:not(.collapsed) {
          background-color: rgba(26, 115, 232, 0.05);
          color: var(--primary);
          box-shadow: none;
        }

        .accordion-body {
          padding: 1.25rem;
        }

        /* ===== MODALS ===== */
        .modal-content {
          border: none;
          border-radius: 8px;
        }

        .modal-header {
          border-bottom: none;
          padding: 1.5rem 1.5rem 0.5rem;
        }

        .modal-body {
          padding: 1.5rem;
        }

        .modal-footer {
          border-top: none;
          padding: 0.5rem 1.5rem 1.5rem;
        }

        .auth-tabs {
          display: flex;
          margin-bottom: 2rem;
          border-bottom: 1px solid var(--neutral-medium);
        }

        .auth-tab {
          flex: 1;
          text-align: center;
          padding: 1rem;
          cursor: pointer;
          font-weight: 600;
          color: #6c757d;
          transition: all 0.3s ease;
        }

        .auth-tab.active {
          color: var(--primary);
          border-bottom: 2px solid var(--primary);
        }

        .social-login-btn {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 100%;
          padding: 0.75rem;
          margin-bottom: 1rem;
          border-radius: 4px;
          font-weight: 500;
          transition: all 0.3s ease;
        }

        .social-login-btn i {
          margin-right: 0.5rem;
          font-size: 1.25rem;
        }

        .google-btn {
          background-color: white;
          color: #444;
          border: 1px solid #ddd;
        }

        .google-btn:hover {
          background-color: #f8f8f8;
        }

        .facebook-btn {
          background-color: #1877f2;
          color: white;
          border: 1px solid #1877f2;
        }

        .facebook-btn:hover {
          background-color: #166fe5;
        }

        /* ===== USER DASHBOARD ===== */
        .dashboard-container {
          margin-top: 2rem;
          display: none;
        }

        .dashboard-sidebar {
          background-color: white;
          border-radius: 8px;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
          padding: 1.5rem;
        }

        .dashboard-sidebar .user-profile {
          display: flex;
          align-items: center;
          margin-bottom: 2rem;
          padding-bottom: 1rem;
          border-bottom: 1px solid var(--neutral-medium);
        }

        .dashboard-sidebar .user-avatar {
          width: 60px;
          height: 60px;
          border-radius: 50%;
          margin-right: 1rem;
        }

        .dashboard-sidebar .user-info {
          flex: 1;
        }

        .dashboard-sidebar .user-name {
          font-weight: 600;
          font-size: 1.125rem;
          margin-bottom: 0.25rem;
        }

        .dashboard-sidebar .user-plan {
          color: var(--primary);
          font-size: 0.875rem;
        }

        .dashboard-sidebar .nav-link {
          padding: 0.75rem 0;
          color: var(--neutral-dark);
          font-weight: 500;
          display: flex;
          align-items: center;
        }

        .dashboard-sidebar .nav-link i {
          margin-right: 0.75rem;
          font-size: 1.25rem;
          width: 20px;
          text-align: center;
        }

        .dashboard-sidebar .nav-link.active {
          color: var(--primary);
        }

        .dashboard-content {
          background-color: white;
          border-radius: 8px;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
          padding: 2rem;
        }

        .dashboard-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 2rem;
          padding-bottom: 1rem;
          border-bottom: 1px solid var(--neutral-medium);
        }

        .generation-history-item {
          padding: 1rem;
          border: 1px solid var(--neutral-medium);
          border-radius: 8px;
          margin-bottom: 1rem;
          transition: all 0.3s ease;
        }

        .generation-history-item:hover {
          box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .generation-history-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 0.5rem;
        }

        .generation-history-title {
          font-weight: 600;
          margin: 0;
        }

        .generation-history-date {
          font-size: 0.875rem;
          color: #6c757d;
        }

        .generation-history-meta {
          display: flex;
          flex-wrap: wrap;
          margin-bottom: 0.5rem;
        }

        .generation-history-tag {
          background-color: rgba(26, 115, 232, 0.1);
          color: var(--primary);
          padding: 0.25rem 0.5rem;
          border-radius: 100px;
          font-size: 0.75rem;
          margin-right: 0.5rem;
          margin-bottom: 0.5rem;
        }

        .generation-history-preview {
          font-size: 0.875rem;
          color: #495057;
          margin-bottom: 1rem;
          max-height: 3.5rem;
          overflow: hidden;
        }

        /* ===== GENERATOR INTERFACE ===== */
        .generator-container {
          background-color: white;
          border-radius: 8px;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
          margin-top: 2rem;
          overflow: hidden;
        }

        .generator-sidebar {
          background-color: #f8f9fa;
          padding: 2rem;
          border-right: 1px solid var(--neutral-medium);
        }

        .generator-form-group {
          margin-bottom: 1.5rem;
        }

        .generator-form-group label {
          display: block;
          font-weight: 600;
          margin-bottom: 0.5rem;
        }

        .difficulty-slider {
          width: 100%;
          height: 10px;
          border-radius: 5px;
          background: linear-gradient(to right, #4caf50, #ffeb3b, #f44336);
          outline: none;
          -webkit-appearance: none;
          appearance: none;
        }

        .difficulty-slider::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          background: white;
          border: 2px solid var(--primary);
          cursor: pointer;
        }

        .difficulty-labels {
          display: flex;
          justify-content: space-between;
          margin-top: 0.5rem;
          font-size: 0.875rem;
        }

        .question-type-item {
          margin-bottom: 0.5rem;
        }

        .generator-preview {
          padding: 2rem;
          position: relative;
        }

        .generator-preview-placeholder {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 100%;
          text-align: center;
          color: #6c757d;
        }

        .generator-preview-placeholder i {
          font-size: 4rem;
          margin-bottom: 1.5rem;
          color: var(--neutral-medium);
        }

        .generator-preview-content {
          display: none;
        }

        .generator-loading {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(255, 255, 255, 0.9);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          z-index: 10;
          display: none;
        }

        .generator-loading-spinner {
          width: 50px;
          height: 50px;
          border: 5px solid var(--neutral-medium);
          border-top: 5px solid var(--primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin-bottom: 1.5rem;
        }

        @keyframes spin {
          0% {
            transform: rotate(0deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }

        .question-item {
          margin-bottom: 2rem;
          padding-bottom: 1.5rem;
          border-bottom: 1px solid var(--neutral-medium);
        }

        .question-text {
          font-weight: 600;
          margin-bottom: 1rem;
        }

        .question-options {
          margin-left: 1.5rem;
        }

        .question-option {
          margin-bottom: 0.5rem;
        }

        .question-answer {
          margin-top: 1rem;
          padding: 0.75rem;
          background-color: rgba(52, 168, 83, 0.1);
          border-radius: 4px;
          color: var(--secondary);
          font-weight: 500;
        }

        .preview-actions {
          display: flex;
          justify-content: space-between;
          margin-top: 2rem;
          padding-top: 1.5rem;
          border-top: 1px solid var(--neutral-medium);
        }

        .toggle-answers-btn {
          color: var(--primary);
          background: none;
          border: none;
          padding: 0;
          font-weight: 500;
          cursor: pointer;
        }

        /* ===== FOOTER ===== */
        .footer {
          background-color: var(--neutral-dark);
          color: white;
          padding: 4rem 0 2rem;
        }

        .footer-logo {
          font-family: var(--font-heading);
          font-weight: 700;
          font-size: 1.5rem;
          color: white;
          margin-bottom: 1rem;
        }

        .footer-text {
          color: rgba(255, 255, 255, 0.7);
          margin-bottom: 2rem;
        }

        .footer-heading {
          font-size: 1.125rem;
          margin-bottom: 1.5rem;
          color: white;
        }

        .footer-links {
          list-style: none;
          padding: 0;
          margin: 0;
        }

        .footer-links li {
          margin-bottom: 0.75rem;
        }

        .footer-links a {
          color: rgba(255, 255, 255, 0.7);
          transition: color 0.3s ease;
        }

        .footer-links a:hover {
          color: white;
        }

        .footer-social {
          display: flex;
          margin-bottom: 2rem;
        }

        .footer-social a {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 36px;
          height: 36px;
          background-color: rgba(255, 255, 255, 0.1);
          border-radius: 50%;
          margin-right: 0.75rem;
          color: white;
          transition: all 0.3s ease;
        }

        .footer-social a:hover {
          background-color: var(--primary);
        }

        .footer-newsletter .form-control {
          background-color: rgba(255, 255, 255, 0.1);
          border: none;
          color: white;
        }

        .footer-newsletter .form-control::placeholder {
          color: rgba(255, 255, 255, 0.5);
        }

        .footer-newsletter .btn {
          padding: 0.75rem 1rem;
        }

        .footer-bottom {
          padding-top: 2rem;
          margin-top: 2rem;
          border-top: 1px solid rgba(255, 255, 255, 0.1);
          text-align: center;
          color: rgba(255, 255, 255, 0.5);
          font-size: 0.875rem;
        }

        /* ===== RESPONSIVE STYLES ===== */
        @media (max-width: 1199px) {
          .navbar {
            padding: 1rem;
          }
          .navbar.scrolled {
            padding: 0.5rem 1rem;
          }
          .hero h1 {
            font-size: 2.5rem;
          }
        }

        @media (max-width: 991px) {
          .section-padding {
            padding: 4rem 0;
          }
          .hero {
            padding: 5rem 0;
          }
          .hero h1 {
            font-size: 2.25rem;
          }
          .hero p {
            font-size: 1.125rem;
          }
          .stat-number {
            font-size: 2.5rem;
          }
          .step-connector {
            display: none;
          }
          .generator-sidebar {
            border-right: none;
            border-bottom: 1px solid var(--neutral-medium);
          }
        }

        @media (max-width: 767px) {
          .section-padding {
            padding: 3rem 0;
          }
          .hero {
            padding: 4rem 0;
          }
          .hero h1 {
            font-size: 2rem;
          }
          .navbar-brand {
            font-size: 1.25rem;
          }
          .pricing-card {
            margin-bottom: 1.5rem;
          }
          .footer {
            padding: 3rem 0 1.5rem;
          }
        }

        /* Section visibility for SPA */
        .content-section {
          display: none;
        }

        .content-section.active {
          display: block;
        }

        #generator-section {
          padding-top: 7rem;
          min-height: calc(100vh - 100px);
          background-color: var(--neutral-light);
        }

        #dashboard-section {
          padding-top: 7rem;
          min-height: calc(100vh - 100px);
          background-color: var(--neutral-light);
        }

        /* Payment Process */
        .payment-steps {
          display: flex;
          margin-bottom: 2rem;
        }

        .payment-step {
          flex: 1;
          text-align: center;
          position: relative;
        }

        .payment-step:not(:last-child):after {
          content: "";
          position: absolute;
          top: 15px;
          right: -30%;
          width: 60%;
          height: 2px;
          background-color: var(--neutral-medium);
        }

        .payment-step.active:not(:last-child):after,
        .payment-step.completed:not(:last-child):after {
          background-color: var(--primary);
        }

        .step-icon {
          width: 32px;
          height: 32px;
          border-radius: 50%;
          background-color: var(--neutral-medium);
          color: white;
          display: flex;
          align-items: center;
          justify-content: center;
          margin: 0 auto 0.5rem;
        }

        .payment-step.active .step-icon,
        .payment-step.completed .step-icon {
          background-color: var(--primary);
        }

        .step-label {
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--neutral-dark);
        }

        .payment-step.active .step-label {
          color: var(--primary);
        }

        .payment-form-container {
          padding: 2rem;
          border: 1px solid var(--neutral-medium);
          border-radius: 8px;
        }

        /* Notification Styles */
        .notification {
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 15px 20px;
          border-radius: 4px;
          background-color: white;
          box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
          z-index: 1050;
          transition: all 0.3s ease;
          transform: translateX(120%);
          max-width: 350px;
        }

        .notification.show {
          transform: translateX(0);
        }

        .notification-success {
          border-left: 4px solid var(--success);
        }

        .notification-error {
          border-left: 4px solid var(--error);
        }

        .notification-warning {
          border-left: 4px solid var(--warning);
        }

        .notification-info {
          border-left: 4px solid var(--primary);
        }

        .notification-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 0.5rem;
        }

        .notification-title {
          font-weight: 600;
          margin: 0;
        }

        .notification-close {
          background: none;
          border: none;
          font-size: 1rem;
          cursor: pointer;
          color: #6c757d;
        }

        .notification-message {
          font-size: 0.875rem;
          margin: 0;
        }
        
        /* 确保条款和隐私政策模态框在其他模态框之上 */
        #termsModal, #privacyModal {
          z-index: 2050 !important;
        }
        
        /* 移除多余的模态框背景样式 */
        body.multiple-modals .modal-backdrop.fade.show:not(:last-child) {
          display: none !important;
        }
        
        /* 确保只有最上层的蒙层可见 */
        .custom-backdrop {
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background-color: rgba(0, 0, 0, 0.5);
          z-index: 2000;
        }
        .relative {
          position: relative;
        }
        
        /* 自定义select样式 */
        .form-select {
          background-color: #ffffff !important;
          border: 1px solid #ced4da;
          color: #212529;
        }
        
        /* 特别为GradeLevel和Subject下拉框自定义样式 */
        #grade-select, #subject-select {
          background-color: #ffffff !important;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
          transition: all 0.2s ease;
        }
        
        #grade-select:focus, #subject-select:focus {
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
          border-color: var(--primary);
        }

        /* 在样式部分添加以下CSS */
        main {
          flex: 1; /* 使main元素填充剩余空间 */
        }

        #how-it-works-section {
          padding-top: 7rem;
          min-height: calc(100vh - 100px);
          display: flex;
          flex-direction: column;
        }

        #how-it-works-section section {
          flex: 1;
          display: flex;
          flex-direction: column;
        }

        #how-it-works-section .container {
          flex-grow: 1;
          display: flex;
          flex-direction: column;
        }

        #how-it-works-section .row:last-child {
          margin-top: auto;
        }
      </style>
    </head>
    <body>
      <!-- Header -->
      <header>
        <nav class="navbar navbar-expand-lg fixed-top">
          <div class="container">
            <a class="navbar-brand" href="#home">
              <i class="fas fa-brain me-2"></i>
              QuizCraft AI
            </a>
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarNav"
              aria-controls="navbarNav"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav mx-auto">
                <li class="nav-item">
                  <a class="nav-link active" href="#home" data-section="home"
                    >Home</a
                  >
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#features" data-section="features"
                    >Features</a
                  >
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#pricing" data-section="pricing"
                    >Pricing</a
                  >
                </li>
                <li class="nav-item">
                  <a
                    class="nav-link"
                    href="#how-it-works"
                    data-section="how-it-works"
                    >How it Works</a
                  >
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#faq" data-section="faq">FAQ</a>
                </li>
              </ul>
              <div class="ms-lg-auto mt-3 mt-lg-0 d-flex" id="auth-buttons">
                <button
                  class="btn btn-outline-primary me-2"
                  id="login-button"
                  data-bs-toggle="modal"
                  data-bs-target="#authModal"
                  data-auth-tab="login"
                >
                  Login
                </button>
                <button
                  class="btn btn-primary"
                  id="register-button"
                  data-bs-toggle="modal"
                  data-bs-target="#authModal"
                  data-auth-tab="register"
                >
                  Register
                </button>
              </div>
              <div
                class="ms-lg-auto mt-3 mt-lg-0 navbar-user"
                id="user-info"
                style="display: none"
              >
                <img
                  src="https://i.pravatar.cc/150?img=12"
                  alt="User Avatar"
                  class="navbar-user-avatar"
                />
                <span class="navbar-user-name" id="navbar-username"
                  >Username</span
                >
                <span class="navbar-user-credits" id="navbar-credits"
                  >5 credits</span
                >
                <div class="dropdown ms-2">
                  <button
                    class="btn btn-sm btn-light dropdown-toggle"
                    type="button"
                    id="userDropdown"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    <i class="fas fa-cog"></i>
                  </button>
                  <ul
                    class="dropdown-menu dropdown-menu-end"
                    aria-labelledby="userDropdown"
                  >
                    <li>
                      <a
                        class="dropdown-item"
                        href="#dashboard"
                        data-section="dashboard"
                        >Dashboard</a
                      >
                    </li>
                    <li>
                      <a class="dropdown-item" href="#" id="logout-button"
                        >Logout</a
                      >
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </nav>
      </header>

      <!-- Main Content Area -->
      <main>
        <!-- Home Section -->
        <section id="home-section" class="content-section active">
          <!-- Hero -->
          <section id="home" class="hero">
            <div class="container">
              <div class="row align-items-center">
                <div class="col-lg-6 animate-fade-in">
                  <h1 class="mb-4">Personalized Learning Made Easy with AI</h1>
                  <p class="mb-5">
                    Generate custom quizzes and worksheets tailored to any grade
                    level and subject, aligned with US education standards.
                  </p>
                  <div class="hero-buttons">
                    <button class="btn btn-accent" id="try-free-button">
                      Try for Free
                    </button>
                    <a href="#how-it-works" class="btn btn-outline-primary"
                      >Learn More</a
                    >
                  </div>
                </div>
                <div class="col-lg-6 d-none d-lg-block animate-slide-right">
                  <img
                    src="https://images.unsplash.com/photo-1503676260728-1c00da094a0b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1009&q=80"
                    alt="Students learning"
                    class="img-fluid rounded"
                  />
                </div>
              </div>
            </div>
          </section>

          <!-- Features Cards -->
          <section class="section-padding">
            <div class="container">
              <div class="row justify-content-center">
                <div class="col-lg-3 col-md-6 mb-4 animate-slide-up delay-100">
                  <div class="card features-card">
                    <i class="fas fa-check-circle"></i>
                    <h3>Aligned with US Education Standards</h3>
                    <p>
                      All our quizzes and worksheets meet standards across all
                      US states, ensuring educational relevance.
                    </p>
                  </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-4 animate-slide-up delay-200">
                  <div class="card features-card">
                    <i class="fas fa-sliders-h"></i>
                    <h3>Customizable Difficulty Levels</h3>
                    <p>
                      Adjust complexity to match student abilities, from basic
                      comprehension to advanced application.
                    </p>
                  </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-4 animate-slide-up delay-300">
                  <div class="card features-card">
                    <i class="fas fa-list-ol"></i>
                    <h3>Multiple Question Types</h3>
                    <p>
                      Choose from multiple-choice, true/false, short answer, and
                      more to diversify learning assessment.
                    </p>
                  </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-4 animate-slide-up delay-400">
                  <div class="card features-card">
                    <i class="fas fa-bolt"></i>
                    <h3>Instant Generation & Download</h3>
                    <p>
                      Create customized materials in seconds and download for
                      immediate classroom use.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Testimonials -->
          <section class="section-padding bg-light">
            <div class="container">
              <div class="row justify-content-center mb-5">
                <div class="col-lg-6 text-center">
                  <h2>Trusted by Educators Nationwide</h2>
                  <p class="lead">
                    See what teachers are saying about QuizCraft AI
                  </p>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-4 animate-fade-in">
                  <div class="card testimonial-card">
                    <div class="quote">
                      "QuizCraft AI has been a game-changer for my classroom. I
                      can quickly generate relevant practice materials that
                      match exactly what we're studying."
                    </div>
                    <div class="testimonial-author">
                      <img
                        src="https://i.pravatar.cc/150?img=32"
                        alt="Sarah Johnson"
                      />
                      <div>
                        <div class="testimonial-author-name">Sarah Johnson</div>
                        <div class="testimonial-author-title">
                          5th Grade Teacher, California
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-lg-4 animate-fade-in delay-200">
                  <div class="card testimonial-card">
                    <div class="quote">
                      "The ability to customize difficulty levels has helped me
                      provide the right challenges for all my students,
                      regardless of where they are in their learning journey."
                    </div>
                    <div class="testimonial-author">
                      <img
                        src="https://i.pravatar.cc/150?img=67"
                        alt="Michael Rodriguez"
                      />
                      <div>
                        <div class="testimonial-author-name">
                          Michael Rodriguez
                        </div>
                        <div class="testimonial-author-title">
                          High School Math Teacher, Texas
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-lg-4 animate-fade-in delay-400">
                  <div class="card testimonial-card">
                    <div class="quote">
                      "As a homeschooling parent, I appreciate how QuizCraft AI
                      helps me create professional-quality learning materials
                      that keep my children engaged and challenged."
                    </div>
                    <div class="testimonial-author">
                      <img
                        src="https://i.pravatar.cc/150?img=47"
                        alt="Emily Warren"
                      />
                      <div>
                        <div class="testimonial-author-name">Emily Warren</div>
                        <div class="testimonial-author-title">
                          Homeschool Parent, Florida
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Stats -->
          <section class="stats-container">
            <div class="container">
              <div class="row">
                <div class="col-md-3 col-6 mb-4 mb-md-0">
                  <div class="stat-item">
                    <div class="stat-number">10,000+</div>
                    <div class="stat-label">Teachers Trust Us</div>
                  </div>
                </div>
                <div class="col-md-3 col-6 mb-4 mb-md-0">
                  <div class="stat-item">
                    <div class="stat-number">1M+</div>
                    <div class="stat-label">Questions Generated</div>
                  </div>
                </div>
                <div class="col-md-3 col-6">
                  <div class="stat-item">
                    <div class="stat-number">50+</div>
                    <div class="stat-label">Subject Areas</div>
                  </div>
                </div>
                <div class="col-md-3 col-6">
                  <div class="stat-item">
                    <div class="stat-number">98%</div>
                    <div class="stat-label">Satisfaction Rate</div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </section>

        <!-- Features Section -->
        <section id="features-section" class="content-section">
          <section
            id="features"
            class="section-padding"
            style="padding-top: 7rem"
          >
            <div class="container">
              <div class="row justify-content-center mb-5">
                <div class="col-lg-6 text-center">
                  <h2>Powerful Features for Everyone</h2>
                  <p class="lead">
                    Designed to support learning at every level
                  </p>
                </div>
              </div>

              <!-- For Teachers -->
              <div class="row align-items-center mb-5">
                <div class="col-lg-6 animate-slide-left">
                  <h3 class="mb-4">For Teachers</h3>
                  <div class="d-flex mb-4">
                    <div class="me-3">
                      <i
                        class="fas fa-clock text-primary"
                        style="font-size: 2rem"
                      ></i>
                    </div>
                    <div>
                      <h4>Save Valuable Time</h4>
                      <p>
                        Create quality educational materials in minutes instead
                        of hours, freeing you to focus on what matters most:
                        teaching.
                      </p>
                    </div>
                  </div>
                  <div class="d-flex mb-4">
                    <div class="me-3">
                      <i
                        class="fas fa-bullseye text-primary"
                        style="font-size: 2rem"
                      ></i>
                    </div>
                    <div>
                      <h4>Standards Alignment</h4>
                      <p>
                        Every question aligns with specific grade-level
                        standards, ensuring your materials meet educational
                        requirements.
                      </p>
                    </div>
                  </div>
                  <div class="d-flex mb-4">
                    <div class="me-3">
                      <i
                        class="fas fa-users text-primary"
                        style="font-size: 2rem"
                      ></i>
                    </div>
                    <div>
                      <h4>Differentiation Made Easy</h4>
                      <p>
                        Create variants of the same quiz at different difficulty
                        levels to meet the needs of all your students.
                      </p>
                    </div>
                  </div>
                </div>
                <div class="col-lg-6 d-none d-lg-block animate-slide-right">
                  <img
                    src="https://images.unsplash.com/photo-1524178232363-1fb2b075b655?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=870&q=80"
                    alt="Teacher using technology"
                    class="img-fluid rounded shadow"
                  />
                </div>
              </div>

              <!-- For Students -->
              <div class="row align-items-center mb-5 flex-lg-row-reverse">
                <div class="col-lg-6 animate-slide-right">
                  <h3 class="mb-4">For Students</h3>
                  <div class="d-flex mb-4">
                    <div class="me-3">
                      <i
                        class="fas fa-brain text-primary"
                        style="font-size: 2rem"
                      ></i>
                    </div>
                    <div>
                      <h4>Targeted Practice</h4>
                      <p>
                        Get practice material that focuses precisely on the
                        concepts you're learning, with the right level of
                        challenge.
                      </p>
                    </div>
                  </div>
                  <div class="d-flex mb-4">
                    <div class="me-3">
                      <i
                        class="fas fa-graduation-cap text-primary"
                        style="font-size: 2rem"
                      ></i>
                    </div>
                    <div>
                      <h4>Exam Preparation</h4>
                      <p>
                        Practice with questions similar to those you'll
                        encounter on tests, building confidence and improving
                        performance.
                      </p>
                    </div>
                  </div>
                  <div class="d-flex mb-4">
                    <div class="me-3">
                      <i
                        class="fas fa-lightbulb text-primary"
                        style="font-size: 2rem"
                      ></i>
                    </div>
                    <div>
                      <h4>Learn from Mistakes</h4>
                      <p>
                        Access detailed explanations for each question to
                        understand concepts better when you make mistakes.
                      </p>
                    </div>
                  </div>
                </div>
                <div class="col-lg-6 d-none d-lg-block animate-slide-left">
                  <img
                    src="https://images.unsplash.com/photo-1531497865144-0464ef8fb9a9?q=80&w=2574&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
                    alt="Students studying"
                    class="img-fluid rounded shadow"
                  />
                </div>
              </div>

              <!-- For Parents -->
              <div class="row align-items-center">
                <div class="col-lg-6 animate-slide-left">
                  <h3 class="mb-4">For Parents</h3>
                  <div class="d-flex mb-4">
                    <div class="me-3">
                      <i
                        class="fas fa-home text-primary"
                        style="font-size: 2rem"
                      ></i>
                    </div>
                    <div>
                      <h4>Homeschooling Support</h4>
                      <p>
                        Create professional educational materials that match
                        your curriculum and teaching approach.
                      </p>
                    </div>
                  </div>
                  <div class="d-flex mb-4">
                    <div class="me-3">
                      <i
                        class="fas fa-chart-line text-primary"
                        style="font-size: 2rem"
                      ></i>
                    </div>
                    <div>
                      <h4>Track Progress</h4>
                      <p>
                        Generate consistent materials over time to track your
                        child's academic growth and identify areas for
                        improvement.
                      </p>
                    </div>
                  </div>
                  <div class="d-flex mb-4">
                    <div class="me-3">
                      <i
                        class="fas fa-star text-primary"
                        style="font-size: 2rem"
                      ></i>
                    </div>
                    <div>
                      <h4>Extra Support</h4>
                      <p>
                        Provide additional practice in subjects where your child
                        needs more help, tailored to their specific needs.
                      </p>
                    </div>
                  </div>
                </div>
                <div class="col-lg-6 d-none d-lg-block animate-slide-right">
                  <img
                    src="https://images.unsplash.com/photo-1587691592099-24045742c181?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=873&q=80"
                    alt="Parent helping child"
                    class="img-fluid rounded shadow"
                  />
                </div>
              </div>

              <div class="text-center mt-5">
                <button class="btn btn-accent btn-lg" id="get-started-button">
                  Get Started
                </button>
              </div>
            </div>
          </section>
        </section>

        <!-- Pricing Section -->
        <section id="pricing-section" class="content-section">
          <section
            id="pricing"
            class="section-padding bg-light"
            style="padding-top: 7rem"
          >
            <div class="container">
              <div class="row justify-content-center mb-5">
                <div class="col-lg-6 text-center">
                  <h2>Simple, Transparent Pricing</h2>
                  <p class="lead">Choose the plan that works for you</p>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-4 col-md-6 mb-4">
                  <div class="card pricing-card h-100 animate-slide-up">
                    <div class="card-body">
                      <h3>Free Trial</h3>
                      <div class="price">$0</div>
                      <p>Perfect for first-time users</p>
                      <ul class="feature-list">
                        <li>1 generation (no login required)</li>
                        <li>All question types</li>
                        <li>PDF download</li>
                      </ul>
                      <button
                        class="btn btn-outline-primary w-100"
                        id="try-free-pricing"
                      >
                        Try Now
                      </button>
                    </div>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                  <div
                    class="card pricing-card h-100 animate-slide-up delay-100"
                  >
                    <div class="card-body">
                      <h3>Basic</h3>
                      <div class="price">$0.99</div>
                      <p>For occasional use</p>
                      <ul class="feature-list">
                        <li>2 generations</li>
                        <li>All question types</li>
                        <li>PDF and Word downloads</li>
                      </ul>
                      <button
                        class="btn btn-outline-primary w-100 buy-btn"
                        data-plan="basic"
                      >
                        Buy Now
                      </button>
                    </div>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                  <div
                    class="card pricing-card h-100 animate-slide-up delay-200"
                  >
                    <div class="card-body">
                      <h3>Standard</h3>
                      <div class="price">$4.99</div>
                      <p>Best for regular projects</p>
                      <ul class="feature-list">
                        <li>10 generations</li>
                        <li>All question types</li>
                        <li>All download formats</li>
                      </ul>
                      <button
                        class="btn btn-outline-primary w-100 buy-btn"
                        data-plan="standard"
                      >
                        Buy Now
                      </button>
                    </div>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                  <div
                    class="card pricing-card popular h-100 animate-slide-up delay-300"
                  >
                    <div class="popular-badge">Most Popular</div>
                    <div class="card-body">
                      <h3>Premium</h3>
                      <div class="price">$9.99</div>
                      <p>Best value for active users</p>
                      <ul class="feature-list">
                        <li>30 generations</li>
                        <li>All question types</li>
                        <li>All download formats</li>
                        <li>Save favorites</li>
                      </ul>
                      <button
                        class="btn btn-accent w-100 buy-btn"
                        data-plan="premium"
                      >
                        Buy Now
                      </button>
                    </div>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                  <div
                    class="card pricing-card h-100 animate-slide-up delay-400"
                  >
                    <div class="card-body">
                      <h3>Monthly</h3>
                      <div class="price">$10.99 <small>/month</small></div>
                      <p>For consistent monthly use</p>
                      <ul class="feature-list">
                        <li>50 generations per month</li>
                        <li>All question types</li>
                        <li>All download formats</li>
                        <li>Priority support</li>
                      </ul>
                      <button
                        class="btn btn-outline-primary w-100 buy-btn"
                        data-plan="monthly"
                      >
                        Subscribe
                      </button>
                    </div>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 mb-4">
                  <div
                    class="card pricing-card h-100 animate-slide-up delay-500"
                  >
                    <div class="card-body">
                      <h3>Annual</h3>
                      <div class="price">$99.99 <small>/year</small></div>
                      <p>Best value for schools & educators</p>
                      <ul class="feature-list">
                        <li>1000 generations per year</li>
                        <li>All question types</li>
                        <li>All download formats</li>
                        <li>Priority support</li>
                        <li>Bulk generation</li>
                      </ul>
                      <button
                        class="btn btn-outline-primary w-100 buy-btn"
                        data-plan="annual"
                      >
                        Subscribe
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="row mt-4">
                <div class="col-12 text-center">
                  <p class="mb-0">
                    Need a custom plan for your school or district?
                    <a
                      href="#"
                      data-bs-toggle="modal"
                      data-bs-target="#contactModal"
                      >Contact us</a
                    >
                    for special pricing.
                  </p>
                </div>
              </div>
            </div>
          </section>
        </section>

        <!-- How It Works Section -->
        <section id="how-it-works-section" class="content-section">
          <section
            id="how-it-works"
            class="section-padding"
            style="padding-top: 7rem; min-height: calc(100vh - 100px); display: flex; flex-direction: column;"
          >
            <div class="container">
              <div class="row justify-content-center mb-5">
                <div class="col-lg-6 text-center">
                  <h2>How It Works</h2>
                  <p class="lead">
                    Creating the perfect quiz is just four steps away
                  </p>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-3 col-md-6 mb-4 position-relative">
                  <div class="card step-card animate-fade-in">
                    <div class="step-number">1</div>
                    <i class="fas fa-chalkboard-teacher"></i>
                    <h4>Select your grade and subject</h4>
                    <p>
                      Choose from K-12 grade levels and various subject areas
                      including Mathematics, Science, English Language Arts, and
                      more.
                    </p>
                    <div class="step-connector d-none d-lg-block"></div>
                  </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-4 position-relative">
                  <div class="card step-card animate-fade-in delay-200">
                    <div class="step-number">2</div>
                    <i class="fas fa-sliders-h"></i>
                    <h4>Customize your questions</h4>
                    <p>
                      Adjust difficulty level, select question types, and
                      specify the number of questions you need for your
                      worksheet or quiz.
                    </p>
                    <div class="step-connector d-none d-lg-block"></div>
                  </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-4 position-relative">
                  <div class="card step-card animate-fade-in delay-300">
                    <div class="step-number">3</div>
                    <i class="fas fa-magic"></i>
                    <h4>Generate and preview</h4>
                    <p>
                      Our AI creates high-quality, standards-aligned questions
                      instantly. Review them and make any adjustments as needed.
                    </p>
                    <div class="step-connector d-none d-lg-block"></div>
                  </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-4">
                  <div class="card step-card animate-fade-in delay-400">
                    <div class="step-number">4</div>
                    <i class="fas fa-download"></i>
                    <h4>Download or save</h4>
                    <p>
                      Export your quiz as a PDF, Word document, or save it to
                      your account for future access and sharing.
                    </p>
                  </div>
                </div>
              </div>
              <div class="text-center mt-4">
                <button class="btn btn-accent btn-lg" id="try-now-button">
                  Try Now
                </button>
              </div>
            </div>
          </section>
        </section>

        <!-- FAQ Section -->
        <section id="faq-section" class="content-section">
          <section
            id="faq"
            class="section-padding bg-light"
            style="padding-top: 7rem"
          >
            <div class="container">
              <div class="row justify-content-center mb-5">
                <div class="col-lg-6 text-center">
                  <h2>Frequently Asked Questions</h2>
                  <p class="lead">
                    Find answers to common questions about QuizCraft AI
                  </p>
                </div>
              </div>
              <div class="row justify-content-center">
                <div class="col-lg-8">
                  <div class="accordion" id="faqAccordion">
                    <!-- General Questions -->
                    <h3 class="mb-4">General</h3>
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingOne">
                        <button
                          class="accordion-button"
                          type="button"
                          data-bs-toggle="collapse"
                          data-bs-target="#collapseOne"
                          aria-expanded="true"
                          aria-controls="collapseOne"
                        >
                          How do I get started with QuizCraft AI?
                        </button>
                      </h2>
                      <div
                        id="collapseOne"
                        class="accordion-collapse collapse show"
                        aria-labelledby="headingOne"
                        data-bs-parent="#faqAccordion"
                      >
                        <div class="accordion-body">
                          Getting started is easy! Click the "Try for Free"
                          button to access our generator without creating an
                          account. If you want to save your work or get more
                          generations, you'll need to create an account and
                          choose a plan that suits your needs.
                        </div>
                      </div>
                    </div>
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingTwo">
                        <button
                          class="accordion-button collapsed"
                          type="button"
                          data-bs-toggle="collapse"
                          data-bs-target="#collapseTwo"
                          aria-expanded="false"
                          aria-controls="collapseTwo"
                        >
                          What does the free trial include?
                        </button>
                      </h2>
                      <div
                        id="collapseTwo"
                        class="accordion-collapse collapse"
                        aria-labelledby="headingTwo"
                        data-bs-parent="#faqAccordion"
                      >
                        <div class="accordion-body">
                          The free trial allows you to create one complete quiz
                          or worksheet without creating an account. You'll have
                          access to all question types and can download your
                          creation as a PDF. It's a great way to experience the
                          quality and usefulness of our platform before
                          committing to a plan.
                        </div>
                      </div>
                    </div>
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingThree">
                        <button
                          class="accordion-button collapsed"
                          type="button"
                          data-bs-toggle="collapse"
                          data-bs-target="#collapseThree"
                          aria-expanded="false"
                          aria-controls="collapseThree"
                        >
                          Which educational standards do your questions align
                          with?
                        </button>
                      </h2>
                      <div
                        id="collapseThree"
                        class="accordion-collapse collapse"
                        aria-labelledby="headingThree"
                        data-bs-parent="#faqAccordion"
                      >
                        <div class="accordion-body">
                          Our questions align with Common Core State Standards,
                          Next Generation Science Standards (NGSS), and
                          state-specific standards across the US. When you
                          select a grade level and subject, our AI automatically
                          generates questions that meet the appropriate
                          standards for that combination.
                        </div>
                      </div>
                    </div>

                    <!-- Account Questions -->
                    <h3 class="mb-4 mt-5">Account & Usage</h3>
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingFour">
                        <button
                          class="accordion-button collapsed"
                          type="button"
                          data-bs-toggle="collapse"
                          data-bs-target="#collapseFour"
                          aria-expanded="false"
                          aria-controls="collapseFour"
                        >
                          How do generations work? What counts as one
                          generation?
                        </button>
                      </h2>
                      <div
                        id="collapseFour"
                        class="accordion-collapse collapse"
                        aria-labelledby="headingFour"
                        data-bs-parent="#faqAccordion"
                      >
                        <div class="accordion-body">
                          A single generation refers to creating one set of
                          questions based on your selected parameters. This
                          could be anywhere from 5 to 50 questions in a single
                          quiz or worksheet. You can edit your parameters and
                          regenerate as much as you want before finalizing, and
                          it will only count as one generation when you save or
                          download the final result.
                        </div>
                      </div>
                    </div>
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingFive">
                        <button
                          class="accordion-button collapsed"
                          type="button"
                          data-bs-toggle="collapse"
                          data-bs-target="#collapseFive"
                          aria-expanded="false"
                          aria-controls="collapseFive"
                        >
                          How long do my generations last? Do they expire?
                        </button>
                      </h2>
                      <div
                        id="collapseFive"
                        class="accordion-collapse collapse"
                        aria-labelledby="headingFive"
                        data-bs-parent="#faqAccordion"
                      >
                        <div class="accordion-body">
                          For one-time purchase plans (Basic, Standard,
                          Premium), your generations never expire—use them
                          whenever you want. For subscription plans (Monthly,
                          Annual), your allocated generations reset at the
                          beginning of each billing cycle. Any unused
                          generations from the previous cycle do not roll over.
                        </div>
                      </div>
                    </div>

                    <!-- Payments Questions -->
                    <h3 class="mb-4 mt-5">Payments & Billing</h3>
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingSix">
                        <button
                          class="accordion-button collapsed"
                          type="button"
                          data-bs-toggle="collapse"
                          data-bs-target="#collapseSix"
                          aria-expanded="false"
                          aria-controls="collapseSix"
                        >
                          What payment methods do you accept?
                        </button>
                      </h2>
                      <div
                        id="collapseSix"
                        class="accordion-collapse collapse"
                        aria-labelledby="headingSix"
                        data-bs-parent="#faqAccordion"
                      >
                        <div class="accordion-body">
                          We accept all major credit cards (Visa, Mastercard,
                          American Express, Discover), PayPal, and for schools
                          and educational institutions, we also accept purchase
                          orders.
                        </div>
                      </div>
                    </div>
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingSeven">
                        <button
                          class="accordion-button collapsed"
                          type="button"
                          data-bs-toggle="collapse"
                          data-bs-target="#collapseSeven"
                          aria-expanded="false"
                          aria-controls="collapseSeven"
                        >
                          Do you offer refunds?
                        </button>
                      </h2>
                      <div
                        id="collapseSeven"
                        class="accordion-collapse collapse"
                        aria-labelledby="headingSeven"
                        data-bs-parent="#faqAccordion"
                      >
                        <div class="accordion-body">
                          For subscription plans, we offer a 7-day money-back
                          guarantee if you're not satisfied. For one-time
                          purchases, refunds are considered on a case-by-case
                          basis if there are technical issues that prevent you
                          from using the Service. Please contact our support
                          team within 14 days of purchase if you encounter any
                          problems.
                        </div>
                      </div>
                    </div>

                    <!-- Technical Questions -->
                    <h3 class="mb-4 mt-5">Technical</h3>
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingEight">
                        <button
                          class="accordion-button collapsed"
                          type="button"
                          data-bs-toggle="collapse"
                          data-bs-target="#collapseEight"
                          aria-expanded="false"
                          aria-controls="collapseEight"
                        >
                          How do you ensure content quality?
                        </button>
                      </h2>
                      <div
                        id="collapseEight"
                        class="accordion-collapse collapse"
                        aria-labelledby="headingEight"
                        data-bs-parent="#faqAccordion"
                      >
                        <div class="accordion-body">
                          Our AI system has been trained on high-quality
                          educational materials and vetted by experienced
                          educators. We continuously improve our algorithms
                          based on user feedback and regular quality reviews.
                          Each question type and subject area undergoes specific
                          validation processes to ensure accuracy, clarity, and
                          educational value.
                        </div>
                      </div>
                    </div>
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingNine">
                        <button
                          class="accordion-button collapsed"
                          type="button"
                          data-bs-toggle="collapse"
                          data-bs-target="#collapseNine"
                          aria-expanded="false"
                          aria-controls="collapseNine"
                        >
                          Can I edit generated questions?
                        </button>
                      </h2>
                      <div
                        id="collapseNine"
                        class="accordion-collapse collapse"
                        aria-labelledby="headingNine"
                        data-bs-parent="#faqAccordion"
                      >
                        <div class="accordion-body">
                          Currently, our platform allows you to regenerate
                          questions you don't like, but direct editing is not
                          available. However, when you download as a Word
                          document, you'll have full editing capability. We're
                          working on adding in-platform editing features in a
                          future update.
                        </div>
                      </div>
                    </div>
                    <!-- <div class="accordion-item">
                      <h2 class="accordion-header" id="headingTen">
                        <button
                          class="accordion-button collapsed"
                          type="button"
                          data-bs-toggle="collapse"
                          data-bs-target="#collapseTen"
                          aria-expanded="false"
                          aria-controls="collapseTen"
                        >
                          How can I get help if I have issues?
                        </button>
                      </h2>
                      <div
                        id="collapseTen"
                        class="accordion-collapse collapse"
                        aria-labelledby="headingTen"
                        data-bs-parent="#faqAccordion"
                      >
                        <div class="accordion-body">
                          We offer multiple support channels: email support at
                          support@quizcraftai.com, an online help center with
                          tutorials and guides, and live chat support during
                          business hours (9am-5pm EST, Monday-Friday). Premium
                          and subscription plan members receive priority
                          support.
                        </div>
                      </div> -->
                    </div>
                  </div>
                  <div class="text-center mt-5">
                    <p>Still have questions? We're here to help!</p>
                    <button
                      class="btn btn-primary"
                      data-bs-toggle="modal"
                      data-bs-target="#contactModal"
                    >
                      Contact Support
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </section>

        <!-- Generator Section -->
        <section id="generator-section" class="content-section">
          <div class="container">
            <div class="row justify-content-center mb-4">
              <div class="col-lg-10">
                <h2 class="text-center mb-4">Quiz Generator</h2>
                <p class="text-center mb-5">
                  Customize your educational content by selecting the parameters
                  below
                </p>
              </div>
            </div>
            <div class="row">
              <div class="col-lg-12">
                <div class="generator-container">
                  <div class="row g-0">
                    <div class="col-lg-4 generator-sidebar">
                      <form id="generator-form">
                        <div class="generator-form-group">
                          <label for="grade-select">Grade Level</label>
                          <select
                            class="form-select"
                            id="grade-select"
                            required
                            oninvalid="this.setCustomValidity('Please select a grade level')"
                            oninput="this.setCustomValidity('')"
                          >
                            <option value="" selected disabled>
                              Select grade level
                            </option>
                            <option value="kindergarten">Kindergarten</option>
                            <option value="1st">1st Grade</option>
                            <option value="2nd">2nd Grade</option>
                            <option value="3rd">3rd Grade</option>
                            <option value="4th">4th Grade</option>
                            <option value="5th">5th Grade</option>
                            <option value="6th">6th Grade</option>
                            <option value="7th">7th Grade</option>
                            <option value="8th">8th Grade</option>
                            <option value="9th">9th Grade</option>
                            <option value="10th">10th Grade</option>
                            <option value="11th">11th Grade</option>
                            <option value="12th">12th Grade</option>
                          </select>
                        </div>
                        <div class="generator-form-group">
                          <label for="subject-select">Subject</label>
                          <select
                            class="form-select"
                            id="subject-select"
                            required
                            oninvalid="this.setCustomValidity('Please select a subject')"
                            oninput="this.setCustomValidity('')"
                          >
                            <option value="" selected disabled>
                              Select subject
                            </option>
                            <optgroup label="Mathematics">
                              <option value="math-arithmetic">
                                Arithmetic
                              </option>
                              <option value="math-algebra">Algebra</option>
                              <option value="math-geometry">Geometry</option>
                              <option value="math-statistics">
                                Statistics
                              </option>
                            </optgroup>
                            <optgroup label="Science">
                              <option value="science-general">
                                General Science
                              </option>
                              <option value="science-biology">Biology</option>
                              <option value="science-chemistry">
                                Chemistry
                              </option>
                              <option value="science-physics">Physics</option>
                            </optgroup>
                            <optgroup label="English Language Arts">
                              <option value="ela-reading">Reading</option>
                              <option value="ela-grammar">Grammar</option>
                              <option value="ela-vocabulary">Vocabulary</option>
                              <option value="ela-writing">Writing</option>
                            </optgroup>
                            <optgroup label="Social Studies">
                              <option value="social-history">History</option>
                              <option value="social-geography">
                                Geography
                              </option>
                              <option value="social-civics">Civics</option>
                              <option value="social-economics">
                                Economics
                              </option>
                            </optgroup>
                            <optgroup label="Foreign Languages">
                              <option value="language-spanish">Spanish</option>
                              <option value="language-french">French</option>
                              <option value="language-german">German</option>
                            </optgroup>
                          </select>
                        </div>
                        <div class="generator-form-group">
                          <label for="difficulty-slider"
                            >Difficulty Level</label
                          >
                          <input
                            type="range"
                            class="difficulty-slider"
                            id="difficulty-slider"
                            min="1"
                            max="3"
                            value="2"
                          />
                          <div class="difficulty-labels">
                            <span>Easy</span>
                            <span>Medium</span>
                            <span>Hard</span>
                          </div>
                        </div>
                        <div class="generator-form-group">
                          <label for="questions-count"
                            >Number of Questions</label
                          >
                          <input
                            type="number"
                            class="form-control"
                            id="questions-count"
                            min="5"
                            max="50"
                            value="10"
                            required
                          />
                        </div>
                        <div class="generator-form-group">
                          <label>Question Types</label>
                          <div class="question-type-item">
                            <div class="form-check">
                              <input
                                class="form-check-input question-type-checkbox"
                                type="checkbox"
                                value="multiple_choice"
                                id="type-multiple-choice"
                                checked
                              />
                              <label
                                class="form-check-label"
                                for="type-multiple-choice"
                              >
                                Multiple Choice
                              </label>
                            </div>
                          </div>
                          <div class="question-type-item">
                            <div class="form-check">
                              <input
                                class="form-check-input question-type-checkbox"
                                type="checkbox"
                                value="true_false"
                                id="type-true-false"
                                checked
                              />
                              <label
                                class="form-check-label"
                                for="type-true-false"
                              >
                                True/False
                              </label>
                            </div>
                          </div>
                          <div class="question-type-item">
                            <div class="form-check">
                              <input
                                class="form-check-input question-type-checkbox"
                                type="checkbox"
                                value="fill_blank"
                                id="type-fill-blank"
                              />
                              <label
                                class="form-check-label"
                                for="type-fill-blank"
                              >
                                Fill in the Blank
                              </label>
                            </div>
                          </div>
                          <div class="question-type-item">
                            <div class="form-check">
                              <input
                                class="form-check-input question-type-checkbox"
                                type="checkbox"
                                value="short_answer"
                                id="type-short-answer"
                              />
                              <label
                                class="form-check-label"
                                for="type-short-answer"
                              >
                                Short Answer
                              </label>
                            </div>
                          </div>
                          <div class="question-type-item">
                            <div class="form-check">
                              <input
                                class="form-check-input question-type-checkbox"
                                type="checkbox"
                                value="word_problem"
                                id="type-word-problem"
                              />
                              <label
                                class="form-check-label"
                                for="type-word-problem"
                              >
                                Word Problems
                              </label>
                            </div>
                          </div>
                        </div>
                        <div class="generator-form-group">
                          <div class="form-check form-switch">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              id="comprehensive-test"
                            />
                            <label
                              class="form-check-label"
                              for="comprehensive-test"
                              >Make comprehensive test</label
                            >
                          </div>
                        </div>
                        <button
                          type="submit"
                          class="btn btn-accent w-100"
                          id="generate-btn"
                        >
                          <i class="fas fa-wand-magic-sparkles me-2"></i>
                          Generate
                        </button>
                      </form>
                    </div>
                    <div class="col-lg-8 generator-preview">
                      <div
                        class="generator-preview-placeholder"
                        id="preview-placeholder"
                      >
                        <i class="fas fa-file-alt"></i>
                        <h4>Your preview will appear here</h4>
                        <p>
                          Adjust the parameters on the left and click "Generate"
                          to create your quiz
                        </p>
                      </div>
                      <div
                        class="generator-preview-content"
                        id="preview-content"
                      >
                        <div class="text-center mb-4">
                          <h4 id="preview-title">5th Grade Math Practice</h4>
                          <p class="mb-0">
                            Generated on
                            <span id="preview-date">August 15, 2023</span>
                          </p>
                        </div>
                        <div id="questions-container">
                          <!-- Questions will be inserted here by JavaScript -->
                        </div>
                        <div class="preview-actions">
                          <button
                            class="toggle-answers-btn"
                            id="toggle-answers"
                          >
                            <i class="fas fa-eye me-1"></i> Show Answers
                          </button>
                          <div class="btn-group">
                            <button
                              class="btn btn-outline-primary"
                              id="download-pdf"
                            >
                              <i class="fas fa-file-pdf me-1"></i> PDF
                            </button>
                            <button
                              class="btn btn-outline-primary"
                              id="download-word"
                            >
                              <i class="fas fa-file-word me-1"></i> Word
                            </button>
                            <!-- <button
                              class="btn btn-outline-primary"
                              id="print-quiz"
                            >
                              <i class="fas fa-print me-1"></i> Print
                            </button> -->
                          </div>
                        </div>
                      </div>
                      <div class="generator-loading" id="loading-indicator">
                        <div class="generator-loading-spinner"></div>
                        <h4 class="mt-3 mb-2">
                          AI is crafting your questions...
                        </h4>
                        <p class="text-muted">This may take a few seconds</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Dashboard Section -->
        <section id="dashboard-section" class="content-section">
          <div class="container">
            <div class="row">
              <div class="col-lg-3">
                <div class="dashboard-sidebar">
                  <div class="user-profile">
                    <img
                      src="https://i.pravatar.cc/150?img=12"
                      alt="User Avatar"
                      class="user-avatar"
                    />
                    <div class="user-info">
                      <div class="user-name" id="sidebar-username">
                        John Doe
                      </div>
                      <div class="user-plan" id="sidebar-plan">
                        Premium Plan
                      </div>
                    </div>
                  </div>
                  <div class="nav flex-column">
                    <a
                      class="nav-link active"
                      href="#dashboard-overview"
                      data-tab="dashboard-overview"
                    >
                      <i class="fas fa-th-large"></i> Dashboard
                    </a>
                    <a
                      class="nav-link"
                      href="#generation-history"
                      data-tab="generation-history"
                    >
                      <i class="fas fa-history"></i> Generation History
                    </a>
                    <a class="nav-link" href="#favorites" data-tab="favorites">
                      <i class="fas fa-star"></i> My Favorites
                    </a>
                    <a
                      class="nav-link"
                      href="#account-settings"
                      data-tab="account-settings"
                    >
                      <i class="fas fa-cog"></i> Account Settings
                    </a>
                  </div>
                  <div class="mt-4 pt-3 border-top">
                    <div class="mb-3">
                      <small class="text-muted d-block mb-1"
                        >Remaining Generations</small
                      >
                      <div class="progress" style="height: 10px">
                        <div
                          class="progress-bar bg-primary"
                          role="progressbar"
                          style="width: 60%"
                          aria-valuenow="18"
                          aria-valuemin="0"
                          aria-valuemax="30"
                        ></div>
                      </div>
                      <div class="d-flex justify-content-between mt-1">
                        <small
                          ><span id="remaining-generations">18</span>
                          left</small
                        >
                        <small>of <span id="total-generations">30</span></small>
                      </div>
                    </div>
                    <button
                      class="btn btn-outline-primary btn-sm w-100"
                      id="upgrade-btn"
                    >
                      <i class="fas fa-arrow-up me-1"></i> Upgrade Plan
                    </button>
                  </div>
                </div>
              </div>
              <div class="col-lg-9">
                <div class="dashboard-content">
                  <!-- Dashboard Overview Tab -->
                  <div class="dashboard-tab active" id="dashboard-overview">
                    <div class="dashboard-header">
                      <h3>Dashboard</h3>
                      <button class="btn btn-primary" id="create-new-quiz">
                        <i class="fas fa-plus me-1"></i> Create New Quiz
                      </button>
                    </div>
                    <div class="row mb-4">
                      <div class="col-md-4 mb-3 mb-md-0">
                        <div class="card">
                          <div class="card-body text-center">
                            <i
                              class="fas fa-file-alt text-primary mb-3"
                              style="font-size: 2rem"
                            ></i>
                            <h5>Total Quizzes</h5>
                            <h3>12</h3>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-4 mb-3 mb-md-0">
                        <div class="card">
                          <div class="card-body text-center">
                            <i
                              class="fas fa-clock text-primary mb-3"
                              style="font-size: 2rem"
                            ></i>
                            <h5>Last Activity</h5>
                            <h3>2 days ago</h3>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="card">
                          <div class="card-body text-center">
                            <i
                              class="fas fa-star text-primary mb-3"
                              style="font-size: 2rem"
                            ></i>
                            <h5>Favorites</h5>
                            <h3>5</h3>
                          </div>
                        </div>
                      </div>
                    </div>
                    <h4 class="mb-3">Recent Activity</h4>
                    <div class="list-group">
                      <div class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                          <h5 class="mb-1">8th Grade Algebra Quiz</h5>
                          <small>2 days ago</small>
                        </div>
                        <p class="mb-1">
                          Generated a 15-question quiz on algebraic expressions
                          and equations.
                        </p>
                        <div>
                          <span class="badge bg-primary">8th Grade</span>
                          <span class="badge bg-info">Algebra</span>
                        </div>
                      </div>
                      <div class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                          <h5 class="mb-1">5th Grade Science Worksheet</h5>
                          <small>5 days ago</small>
                        </div>
                        <p class="mb-1">
                          Created a science worksheet on the solar system.
                        </p>
                        <div>
                          <span class="badge bg-primary">5th Grade</span>
                          <span class="badge bg-success">Science</span>
                        </div>
                      </div>
                      <div class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                          <h5 class="mb-1">11th Grade Grammar Test</h5>
                          <small>1 week ago</small>
                        </div>
                        <p class="mb-1">
                          Generated an English grammar test on punctuation and
                          sentence structure.
                        </p>
                        <div>
                          <span class="badge bg-primary">11th Grade</span>
                          <span class="badge bg-warning">Grammar</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Generation History Tab -->
                  <div
                    class="dashboard-tab"
                    id="generation-history"
                    style="display: none"
                  >
                    <div class="dashboard-header">
                      <h3>Generation History</h3>
                      <div>
                        <input
                          type="text"
                          class="form-control"
                          placeholder="Search history..."
                          id="history-search"
                        />
                      </div>
                    </div>
                    <div class="generation-history-list">
                      <div class="generation-history-item">
                        <div class="generation-history-header">
                          <h5 class="generation-history-title">
                            8th Grade Algebra Quiz
                          </h5>
                          <div class="generation-history-date">
                            August 13, 2023
                          </div>
                        </div>
                        <div class="generation-history-meta">
                          <span class="generation-history-tag">8th Grade</span>
                          <span class="generation-history-tag">Algebra</span>
                          <span class="generation-history-tag"
                            >15 Questions</span
                          >
                          <span class="generation-history-tag">Medium</span>
                        </div>
                        <div class="generation-history-preview">
                          1. Solve for x: 2(x + 3) - 5 = 3x - 7 2. If a = 3 and
                          b = -2, evaluate 2a² + 3ab - b² 3. Factor the
                          expression: x² - 9x + 20
                        </div>
                        <div class="d-flex justify-content-end">
                          <button class="btn btn-sm btn-outline-primary me-2">
                            <i class="fas fa-eye me-1"></i> View
                          </button>
                          <button class="btn btn-sm btn-outline-secondary me-2">
                            <i class="fas fa-star me-1"></i> Save
                          </button>
                          <button class="btn btn-sm btn-outline-danger">
                            <i class="fas fa-trash me-1"></i> Delete
                          </button>
                        </div>
                      </div>
                      <div class="generation-history-item">
                        <div class="generation-history-header">
                          <h5 class="generation-history-title">
                            5th Grade Science Worksheet
                          </h5>
                          <div class="generation-history-date">
                            August 10, 2023
                          </div>
                        </div>
                        <div class="generation-history-meta">
                          <span class="generation-history-tag">5th Grade</span>
                          <span class="generation-history-tag">Science</span>
                          <span class="generation-history-tag"
                            >10 Questions</span
                          >
                          <span class="generation-history-tag">Easy</span>
                        </div>
                        <div class="generation-history-preview">
                          1. Name the eight planets in our solar system in order
                          from the sun. 2. What is the difference between a star
                          and a planet? 3. Why is Earth called the "Goldilocks"
                          planet?
                        </div>
                        <div class="d-flex justify-content-end">
                          <button class="btn btn-sm btn-outline-primary me-2">
                            <i class="fas fa-eye me-1"></i> View
                          </button>
                          <button class="btn btn-sm btn-outline-secondary me-2">
                            <i class="fas fa-star me-1"></i> Save
                          </button>
                          <button class="btn btn-sm btn-outline-danger">
                            <i class="fas fa-trash me-1"></i> Delete
                          </button>
                        </div>
                      </div>
                      <div class="generation-history-item">
                        <div class="generation-history-header">
                          <h5 class="generation-history-title">
                            11th Grade Grammar Test
                          </h5>
                          <div class="generation-history-date">
                            August 8, 2023
                          </div>
                        </div>
                        <div class="generation-history-meta">
                          <span class="generation-history-tag">11th Grade</span>
                          <span class="generation-history-tag">Grammar</span>
                          <span class="generation-history-tag"
                            >20 Questions</span
                          >
                          <span class="generation-history-tag">Hard</span>
                        </div>
                        <div class="generation-history-preview">
                          1. Identify the grammatical error in the following
                          sentence: "Neither the teachers nor the principal were
                          at the meeting." 2. Which punctuation mark is needed
                          in this sentence: "I asked myself 'Why did I do that'"
                        </div>
                        <div class="d-flex justify-content-end">
                          <button class="btn btn-sm btn-outline-primary me-2">
                            <i class="fas fa-eye me-1"></i> View
                          </button>
                          <button class="btn btn-sm btn-outline-secondary me-2">
                            <i class="fas fa-star me-1"></i> Save
                          </button>
                          <button class="btn btn-sm btn-outline-danger">
                            <i class="fas fa-trash me-1"></i> Delete
                          </button>
                        </div>
                      </div>
                    </div>
                    <nav aria-label="History pagination" class="mt-4">
                      <ul class="pagination justify-content-center">
                        <li class="page-item disabled">
                          <a
                            class="page-link"
                            href="#"
                            tabindex="-1"
                            aria-disabled="true"
                            >Previous</a
                          >
                        </li>
                        <li class="page-item active">
                          <a class="page-link" href="#">1</a>
                        </li>
                        <li class="page-item">
                          <a class="page-link" href="#">2</a>
                        </li>
                        <li class="page-item">
                          <a class="page-link" href="#">3</a>
                        </li>
                        <li class="page-item">
                          <a class="page-link" href="#">Next</a>
                        </li>
                      </ul>
                    </nav>
                  </div>

                  <!-- Favorites Tab -->
                  <div
                    class="dashboard-tab"
                    id="favorites"
                    style="display: none"
                  >
                    <div class="dashboard-header">
                      <h3>My Favorites</h3>
                      <div>
                        <input
                          type="text"
                          class="form-control"
                          placeholder="Search favorites..."
                          id="favorites-search"
                        />
                      </div>
                    </div>
                    
                    <!-- 删除筛选控件 -->
                    
                    <div class="favorites-list">
                      <!-- 收藏列表内容将通过JavaScript动态填充 -->
                      <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status"></div>
                        <p class="mt-3">Loading favorites...</p>
                      </div>
                    </div>
                    <nav aria-label="Favorites pagination" class="mt-4">
                      <ul class="pagination justify-content-center favorites-pagination">
                        <!-- 分页控件将通过JavaScript动态填充 -->
                      </ul>
                    </nav>
                  </div>

                  <!-- Account Settings Tab -->
                  <div
                    class="dashboard-tab"
                    id="account-settings"
                    style="display: none"
                  >
                    <div class="dashboard-header">
                      <h3>Account Settings</h3>
                    </div>
                    <div class="row">
                      <div class="col-md-6 mb-4">
                        <div class="card">
                          <div class="card-body">
                            <h5 class="card-title mb-3">Profile Information</h5>
                            <form id="profile-form">
                              <div class="mb-3">
                                <label for="profile-name" class="form-label"
                                  >Full Name</label
                                >
                                <input
                                  type="text"
                                  class="form-control"
                                  id="profile-name"
                                  value="John Doe"
                                />
                              </div>
                              <div class="mb-3">
                                <label for="profile-email" class="form-label"
                                  >Email Address</label
                                >
                                <input
                                  type="email"
                                  class="form-control"
                                  id="profile-email"
                                  value="john.doe@example.com"
                                />
                              </div>
                              <div class="mb-3">
                                <label for="profile-role" class="form-label"
                                  >Role</label
                                >
                                <select class="form-select" id="profile-role">
                                  <option value="teacher" selected>
                                    Teacher
                                  </option>
                                  <option value="student">Student</option>
                                  <option value="parent">Parent</option>
                                  <option value="administrator">
                                    Administrator
                                  </option>
                                  <option value="other">Other</option>
                                </select>
                              </div>
                              <button type="submit" class="btn btn-primary">
                                Update Profile
                              </button>
                            </form>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6 mb-4">
                        <div class="card">
                          <div class="card-body">
                            <h5 class="card-title mb-3">Change Password</h5>
                            <form id="password-form">
                              <div class="mb-3">
                                <label for="current-password" class="form-label"
                                  >Current Password</label
                                >
                                <input
                                  type="password"
                                  class="form-control"
                                  id="current-password"
                                />
                              </div>
                              <div class="mb-3">
                                <label for="new-password" class="form-label"
                                  >New Password</label
                                >
                                <input
                                  type="password"
                                  class="form-control"
                                  id="new-password"
                                />
                                <div class="progress mt-2" style="height: 5px">
                                  <div
                                    class="progress-bar bg-danger"
                                    role="progressbar"
                                    style="width: 0%"
                                    id="password-strength"
                                  ></div>
                                </div>
                                <small class="text-muted" id="password-feedback"
                                  >Password strength will be shown here</small
                                >
                              </div>
                              <div class="mb-3">
                                <label for="confirm-password" class="form-label"
                                  >Confirm New Password</label
                                >
                                <input
                                  type="password"
                                  class="form-control"
                                  id="confirm-password"
                                />
                              </div>
                              <button type="submit" class="btn btn-primary">
                                Change Password
                              </button>
                            </form>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6 mb-4">
                        <div class="card">
                          <div class="card-body">
                            <h5 class="card-title mb-3">
                              Subscription Details
                            </h5>
                            <div class="mb-3">
                              <p class="mb-1">
                                <strong>Current Plan:</strong>
                                <span class="text-primary">Premium</span>
                              </p>
                              <p class="mb-1">
                                <strong>Billing Cycle:</strong> One-time
                                purchase
                              </p>
                              <p class="mb-1">
                                <strong>Purchase Date:</strong> August 5, 2023
                              </p>
                              <p class="mb-1">
                                <strong>Generations:</strong> 18/30 remaining
                              </p>
                            </div>
                            <button
                              type="button"
                              class="btn btn-outline-primary"
                              id="view-plans-btn"
                            >
                              View Plans
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-6 mb-4">
                        <div class="card">
                          <div class="card-body">
                            <h5 class="card-title mb-3">Preferences</h5>
                            <form id="preferences-form">
                              <div class="mb-3">
                                <label class="form-label d-block"
                                  >Email Notifications</label
                                >
                                <div class="form-check">
                                  <input
                                    class="form-check-input"
                                    type="checkbox"
                                    id="notification-updates"
                                    checked
                                  />
                                  <label
                                    class="form-check-label"
                                    for="notification-updates"
                                  >
                                    Product updates and announcements
                                  </label>
                                </div>
                                <div class="form-check">
                                  <input
                                    class="form-check-input"
                                    type="checkbox"
                                    id="notification-tips"
                                    checked
                                  />
                                  <label
                                    class="form-check-label"
                                    for="notification-tips"
                                  >
                                    Educational tips and resources
                                  </label>
                                </div>
                                <div class="form-check">
                                  <input
                                    class="form-check-input"
                                    type="checkbox"
                                    id="notification-special"
                                  />
                                  <label
                                    class="form-check-label"
                                    for="notification-special"
                                  >
                                    Special offers and promotions
                                  </label>
                                </div>
                              </div>
                              <div class="mb-3">
                                <label
                                  for="default-difficulty"
                                  class="form-label"
                                  >Default Difficulty</label
                                >
                                <select
                                  class="form-select"
                                  id="default-difficulty"
                                >
                                  <option value="easy">Easy</option>
                                  <option value="medium" selected>
                                    Medium
                                  </option>
                                  <option value="hard">Hard</option>
                                </select>
                              </div>
                              <button type="submit" class="btn btn-primary">
                                Save Preferences
                              </button>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>

      <!-- Footer -->
      <footer class="footer">
        <div class="container">
          <div class="row relative">
            <div class="col-lg-4 mb-4 mb-lg-0">
              <div class="footer-logo">
                <i class="fas fa-brain me-2"></i> QuizCraft AI
              </div>
              <p class="footer-text">
                Empowering educators and learners with AI-generated educational
                content tailored to every student's needs. Making personalized
                learning accessible to everyone.
              </p>
            </div>
            <div class="col-lg-8 col-md-8 mb-4 mb-md-0">
              <ul class="footer-links d-flex justify-content-around align-items-center" style="position: relative;top:50%;">
                <li class="me-4"><a href="#" id="terms-link" onclick="openTermsModal(event)">Terms of Service</a></li>
                <li class="me-4"><a href="#" id="privacy-link" onclick="openPrivacyModal(event)">Privacy Policy</a></li>
              </ul>
            </div>
          </div>
          <div class="footer-bottom">
            <p>© 2025 QuizCraft AI. All rights reserved.</p>
          </div>
        </div>
      </footer>

      <!-- Terms of Service Modal -->
      <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="termsModalLabel">Terms of Service</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <h4>QuizCraft AI Terms of Service</h4>
              <p>Last Updated: February 15, 2025</p>
              
              <h5>1. Introduction</h5>
              <p>Welcome to QuizCraft AI. These Terms of Service ("Terms") govern your access to and use of the QuizCraft AI platform, including our website at www.quizcraftai.com, our mobile applications, and all related services (collectively, the "Service"). By accessing or using our Service, you agree to be bound by these Terms. If you disagree with any part of the Terms, you do not have permission to access the Service.</p>
              
              <h5>2. Definitions</h5>
              <p>Throughout these Terms, we use certain defined terms:</p>
              <ul>
                <li>"QuizCraft AI", "we", "us", and "our" refer to QuizCraft AI, Inc., the company that operates the Service.</li>
                <li>"User", "you", and "your" refer to you, the person accessing or using the Service.</li>
                <li>"Content" refers to all questions, quizzes, worksheets, text, information, data, graphics, images, and other materials that may be viewed on or accessed through the Service.</li>
                <li>"User Content" refers to all Content that a User creates, uploads, or generates using the Service.</li>
              </ul>
              
              <h5>3. Account Registration</h5>
              <p>To access certain features of the Service, you may be required to register for an account. You agree to provide accurate, current, and complete information during the registration process and to update such information to keep it accurate, current, and complete. You are responsible for safeguarding your password and for all activities that occur under your account. You agree to notify us immediately of any unauthorized use of your account.</p>
              
              <h5>4. Subscription and Billing</h5>
              <p>4.1 <strong>Free Trial.</strong> We offer a free trial to new users. The free trial provides limited access to the Service and does not require payment information.</p>
              <p>4.2 <strong>Paid Plans.</strong> We offer various paid plans with different features and generation limits. By selecting a paid plan, you agree to pay the subscription fees indicated for that plan. Payments are charged at the beginning of the subscription period.</p>
              <p>4.3 <strong>Automatic Renewal.</strong> Subscription plans automatically renew at the end of each billing period unless canceled prior to the renewal date.</p>
              <p>4.4 <strong>Refunds.</strong> For subscription plans, we offer a 7-day money-back guarantee if you're not satisfied. For one-time purchases, refunds are considered on a case-by-case basis and are generally only provided if there are technical issues that prevent you from using the Service.</p>
              
              <h5>5. Acceptable Use</h5>
              <p>You agree not to use the Service to:</p>
              <ul>
                <li>Violate any applicable law or regulation.</li>
                <li>Infringe the intellectual property rights of others.</li>
                <li>Harass, abuse, or harm another person.</li>
                <li>Generate or distribute harmful, offensive, or inappropriate content.</li>
                <li>Attempt to gain unauthorized access to the Service or its related systems.</li>
                <li>Interfere with or disrupt the Service or servers connected to the Service.</li>
                <li>Reverse engineer or attempt to extract the source code of the Service.</li>
              </ul>
              
              <h5>6. Content and Intellectual Property</h5>
              <p>6.1 <strong>Service Content.</strong> All Content provided by QuizCraft AI, including but not limited to the website design, logo, and software, is owned by or licensed to QuizCraft AI and is protected by copyright, trademark, and other intellectual property laws.</p>
              <p>6.2 <strong>User Content.</strong> You retain ownership of any User Content you create, upload, or generate using the Service. By creating User Content through the Service, you grant us a worldwide, non-exclusive, royalty-free license to use, copy, modify, and display your User Content in connection with providing and improving the Service.</p>
              <p>6.3 <strong>Educational Standards Alignment.</strong> While we make efforts to align our Content with various educational standards, we do not guarantee complete compliance with all standards or requirements for every educational context.</p>
              
              <h5>7. User Content Guidelines</h5>
              <p>You are solely responsible for your User Content. We reserve the right, but not the obligation, to review and remove any User Content that violates these Terms or that we find objectionable for any reason, without prior notice to you.</p>
              
              <h5>8. Privacy</h5>
              <p>Your privacy is important to us. Our Privacy Policy explains how we collect, use, and protect your personal information. By using the Service, you agree to the collection and use of information as set forth in our Privacy Policy.</p>
              
              <h5>9. Third-Party Links and Services</h5>
              <p>The Service may contain links to third-party websites or services. We are not responsible for the content or practices of these third-party sites and do not endorse them. Your use of third-party sites is subject to their terms and policies.</p>
              
              <h5>10. Limitation of Liability</h5>
              <p>To the maximum extent permitted by law, QuizCraft AI shall not be liable for any indirect, incidental, special, consequential, or punitive damages, including loss of profits, data, or goodwill, arising out of or in connection with your access to or use of the Service.</p>
              
              <h5>11. Disclaimer of Warranties</h5>
              <p>The Service is provided on an "as is" and "as available" basis, without warranties of any kind, either express or implied. We do not warrant that the Service will be uninterrupted, error-free, or secure.</p>
              
              <h5>12. Indemnification</h5>
              <p>You agree to indemnify and hold harmless QuizCraft AI and its officers, directors, employees, and agents from any claims, liabilities, damages, losses, and expenses (including legal fees) arising from your use of the Service or violation of these Terms.</p>
              
              <h5>13. Termination</h5>
              <p>We reserve the right to suspend or terminate your access to the Service at any time for any reason, including violation of these Terms. Upon termination, your right to use the Service will immediately cease.</p>
              
              <h5>14. Changes to Terms</h5>
              <p>We may modify these Terms at any time by posting the revised Terms on the Service. Your continued use of the Service after the posting of revised Terms constitutes your acceptance of the changes.</p>
              
              <h5>15. Governing Law</h5>
              <p>These Terms shall be governed by the laws of the State of California, without regard to its conflict of law provisions. Any disputes arising under these Terms that cannot be resolved through negotiation shall be subject to the exclusive jurisdiction of the courts located in San Francisco County, California.</p>
              
              <h5>16. Contact Information</h5>
              <p>If you have any questions about these Terms, please contact us at legal@quizcraftai.com.</p>
              
              <h5>17. Entire Agreement</h5>
              <p>These Terms, together with our Privacy Policy and any other legal notices published by us on the Service, constitute the entire agreement between you and QuizCraft AI concerning the Service.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Privacy Policy Modal -->
      <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="privacyModalLabel">Privacy Policy</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <h4>QuizCraft AI Privacy Policy</h4>
              <p>Last Updated: February 15, 2025</p>
              
              <h5>1. Introduction</h5>
              <p>At QuizCraft AI, we take your privacy seriously. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our Service. Please read this Privacy Policy carefully. If you do not agree with the terms of this Privacy Policy, please do not access the Service.</p>
              
              <h5>2. Information We Collect</h5>
              <p>We collect several types of information from and about users of our Service, including:</p>
              <ul>
                <li><strong>Personal Information:</strong> Name, email address, payment information, and other identifiers.</li>
                <li><strong>Usage Data:</strong> Information about how you interact with our Service, including generated content, preferences, and settings.</li>
                <li><strong>Device Information:</strong> IP address, browser type, operating system, and other technical information.</li>
                <li><strong>Location Data:</strong> General location information based on your IP address.</li>
              </ul>
              
              <h5>3. How We Use Your Information</h5>
              <p>We use the information we collect to:</p>
              <ul>
                <li>Provide and maintain our Service</li>
                <li>Process your payments and manage your account</li>
                <li>Improve and personalize your experience</li>
                <li>Communicate with you about updates and changes</li>
                <li>Detect and prevent fraud and abuse</li>
                <li>Comply with legal obligations</li>
              </ul>
              
              <h5>4. Information Sharing and Disclosure</h5>
              <p>We may share your information with:</p>
              <ul>
                <li>Service providers who assist in operating our Service</li>
                <li>Payment processors for handling transactions</li>
                <li>Law enforcement when required by law</li>
                <li>Other parties with your consent</li>
              </ul>
              
              <h5>5. Data Security</h5>
              <p>We implement appropriate technical and organizational measures to protect your personal information. However, no method of transmission over the Internet is 100% secure, and we cannot guarantee absolute security.</p>
              
              <h5>6. Your Rights and Choices</h5>
              <p>You have certain rights regarding your personal information:</p>
              <ul>
                <li>Access and update your information</li>
                <li>Request deletion of your information</li>
                <li>Opt-out of marketing communications</li>
                <li>Object to certain processing activities</li>
              </ul>
              
              <h5>7. Children's Privacy</h5>
              <p>Our Service is not intended for children under 13. We do not knowingly collect personal information from children under 13. If we learn we have collected personal information from a child under 13, we will delete that information.</p>
              
              <h5>8. International Data Transfers</h5>
              <p>Your information may be transferred to and processed in countries other than your own. We ensure appropriate safeguards are in place for such transfers.</p>
              
              <h5>9. Changes to This Privacy Policy</h5>
              <p>We may update this Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page and updating the "Last Updated" date.</p>
              
              <h5>10. Contact Us</h5>
              <p>If you have any questions about this Privacy Policy, please contact us at privacy@quizcraftai.com.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Cookie Policy Modal -->
      <div class="modal fade" id="cookieModal" tabindex="-1" aria-labelledby="cookieModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="cookieModalLabel">Cookie Policy</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <h4>QuizCraft AI Cookie Policy</h4>
              <p>Last Updated: February 15, 2025</p>
              
              <h5>1. What Are Cookies?</h5>
              <p>Cookies are small text files that are placed on your computer or mobile device when you visit a website. They are widely used to make websites work more efficiently and provide useful information to website owners.</p>
              
              <h5>2. How We Use Cookies</h5>
              <p>We use cookies for the following purposes:</p>
              <ul>
                <li><strong>Essential Cookies:</strong> Required for the website to function properly</li>
                <li><strong>Authentication Cookies:</strong> Help us identify you when you log in</li>
                <li><strong>Preference Cookies:</strong> Remember your settings and preferences</li>
                <li><strong>Analytics Cookies:</strong> Help us understand how visitors use our website</li>
                <li><strong>Marketing Cookies:</strong> Used to deliver relevant advertisements</li>
              </ul>
              
              <h5>3. Types of Cookies We Use</h5>
              <p>We use the following types of cookies:</p>
              <ul>
                <li><strong>Session Cookies:</strong> Temporary cookies that expire when you close your browser</li>
                <li><strong>Persistent Cookies:</strong> Remain on your device for a set period of time</li>
                <li><strong>First-party Cookies:</strong> Set by our website</li>
                <li><strong>Third-party Cookies:</strong> Set by other websites that provide content on our pages</li>
              </ul>
              
              <h5>4. Cookie Management</h5>
              <p>You can control and/or delete cookies as you wish. You can delete all cookies that are already on your computer and you can set most browsers to prevent them from being placed. However, if you do this, you may have to manually adjust some preferences every time you visit our site and some services and functionalities may not work.</p>
              
              <h5>5. Specific Cookies We Use</h5>
              <p>Here are the specific cookies we use on our website:</p>
              <ul>
                <li><strong>Authentication:</strong> auth_token, user_session</li>
                <li><strong>Preferences:</strong> language, theme, settings</li>
                <li><strong>Analytics:</strong> _ga, _gid, _gat</li>
                <li><strong>Marketing:</strong> _fbp, _gcl_au</li>
              </ul>
              
              <h5>6. Third-Party Cookies</h5>
              <p>We use services from third parties that may set cookies on your device:</p>
              <ul>
                <li>Google Analytics for website analytics</li>
                <li>Facebook Pixel for advertising</li>
                <li>Stripe for payment processing</li>
              </ul>
              
              <h5>7. Cookie Consent</h5>
              <p>When you first visit our website, we will ask for your consent to set cookies on your device. You can change your cookie preferences at any time through your browser settings or by contacting us.</p>
              
              <h5>8. Updates to This Policy</h5>
              <p>We may update this Cookie Policy from time to time. We will notify you of any changes by posting the new Cookie Policy on this page and updating the "Last Updated" date.</p>
              
              <h5>9. Contact Us</h5>
              <p>If you have any questions about our use of cookies, please contact us at privacy@quizcraftai.com.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Authentication Modal -->
      <div
        class="modal fade"
        id="authModal"
        tabindex="-1"
        aria-labelledby="authModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="authModalLabel">
                Welcome to QuizCraft AI
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div class="auth-tabs">
                <div
                  class="auth-tab active"
                  id="login-tab"
                  data-tab="login-form"
                >
                  Login
                </div>
                <div
                  class="auth-tab"
                  id="register-tab"
                  data-tab="register-form"
                >
                  Register
                </div>
              </div>

              <!-- Login Form -->
              <div id="login-form">
                <!-- <div class="mb-4">
                  <button class="social-login-btn google-btn">
                    <i class="fab fa-google"></i> Continue with Google
                  </button>
                  <button class="social-login-btn facebook-btn">
                    <i class="fab fa-facebook-f"></i> Continue with Facebook
                  </button>
                </div>
                <div class="text-center mb-4">
                  <span class="text-muted">or login with email</span>
                </div> -->
                <form id="login-form-element">
                  <div class="mb-3">
                    <label for="login-email" class="form-label"
                      >Email Address</label
                    >
                    <input
                      type="email"
                      class="form-control"
                      id="login-email"
                      required
                      oninvalid="this.setCustomValidity('Please enter your email address')"
                      oninput="this.setCustomValidity('')"
                      placeholder="Please use English characters"
                    />
                  </div>
                  <div class="mb-3">
                    <label for="login-password" class="form-label"
                      >Password</label
                    >
                    <input
                      type="password"
                      class="form-control"
                      id="login-password"
                      required
                      oninvalid="this.setCustomValidity('Please enter your password')"
                      oninput="this.setCustomValidity('')"
                      placeholder="Please use English characters"
                    />
                  </div>
                  <div class="mb-3 form-check">
                    <input
                      type="checkbox"
                      class="form-check-input"
                      id="remember-me"
                    />
                    <label class="form-check-label" for="remember-me"
                      >Remember me</label
                    >
                    <a href="#" class="float-end" id="forgot-password"
                      >Forgot password?</a
                    >
                  </div>
                  <div class="mb-3 form-check">
                    <input
                      type="checkbox"
                      class="form-check-input"
                      id="login-agree-terms"
                      required
                      oninvalid="this.setCustomValidity('Please accept the Terms of Service and Privacy Policy')"
                      oninput="this.setCustomValidity('')"
                    />
                    <label class="form-check-label" for="login-agree-terms">
                      I agree to the
                      <a href="#" id="login-terms-link" onclick="openTermsModal(event)">Terms of Service</a> and
                      <a href="#" id="login-privacy-link" onclick="openPrivacyModal(event)">Privacy Policy</a>
                    </label>
                  </div>
                  <button
                    type="submit"
                    class="btn btn-primary w-100"
                    id="login-submit"
                  >
                    Login
                  </button>
                </form>
              </div>

              <!-- Register Form -->
              <div id="register-form" style="display: none">
                <!-- <div class="mb-4">
                  <button class="social-login-btn google-btn">
                    <i class="fab fa-google"></i> Continue with Google
                  </button>
                  <button class="social-login-btn facebook-btn">
                    <i class="fab fa-facebook-f"></i> Continue with Facebook
                  </button>
                </div>
                <div class="text-center mb-4">
                  <span class="text-muted">or register with email</span>
                </div> -->
                <form id="register-form-element">
                  <div class="mb-3">
                    <label for="register-name" class="form-label"
                      >Full Name</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="register-name"
                      required
                      oninvalid="this.setCustomValidity('Please enter your full name')"
                      oninput="this.setCustomValidity('')"
                    />
                    <div class="invalid-feedback" id="register-name-feedback">
                      Please enter your full name.
                    </div>
                  </div>
                  <div class="mb-3">
                    <label for="register-email" class="form-label"
                      >Email Address</label
                    >
                    <input
                      type="email"
                      class="form-control"
                      id="register-email"
                      required
                      oninvalid="this.setCustomValidity('Please enter your email address')"
                      oninput="this.setCustomValidity('')"
                    />
                    <div class="invalid-feedback" id="register-email-feedback">
                      Please enter a valid email address.
                    </div>
                  </div>
                  <div class="mb-3">
                    <label for="register-password" class="form-label"
                      >Password</label
                    >
                    <input
                      type="password"
                      class="form-control"
                      id="register-password"
                      required
                      oninvalid="this.setCustomValidity('Please enter a password')"
                      oninput="this.setCustomValidity('')"
                    />
                    <div class="progress mt-2" style="height: 5px">
                      <div
                        class="progress-bar bg-danger"
                        role="progressbar"
                        style="width: 0%"
                        id="register-password-strength"
                      ></div>
                    </div>
                    <small class="text-muted" id="register-password-feedback"
                      >Password strength will be shown here</small
                    >
                  </div>
                  <div class="mb-3">
                    <label for="register-confirm-password" class="form-label"
                      >Confirm Password</label
                    >
                    <input
                      type="password"
                      class="form-control"
                      id="register-confirm-password"
                      required
                      oninvalid="this.setCustomValidity('Please confirm your password')"
                      oninput="this.setCustomValidity('')"
                    />
                    <div class="invalid-feedback" id="register-confirm-feedback">
                      Passwords do not match.
                    </div>
                  </div>
                  <div class="mb-3 form-check">
                    <input
                      type="checkbox"
                      class="form-check-input"
                      id="agree-terms"
                      required
                      oninvalid="this.setCustomValidity('Please accept the Terms of Service and Privacy Policy')"
                      oninput="this.setCustomValidity('')"
                    />
                    <label class="form-check-label" for="agree-terms">
                      I agree to the
                      <a href="#" id="register-terms-link" onclick="openTermsModal(event)">Terms of Service</a> and
                      <a href="#" id="register-privacy-link" onclick="openPrivacyModal(event)">Privacy Policy</a>
                    </label>
                  </div>
                  <div class="alert alert-danger d-none" role="alert" id="register-error-message">
                  </div>
                  <button
                    type="submit"
                    class="btn btn-primary w-100"
                    id="register-submit"
                  >
                    Register
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Modal -->
      <div
        class="modal fade"
        id="paymentModal"
        tabindex="-1"
        aria-labelledby="paymentModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="paymentModalLabel">
                Complete Your Purchase
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <div class="payment-steps">
                <div class="payment-step active" id="step-plan">
                  <div class="step-icon">1</div>
                  <div class="step-label">Plan</div>
                </div>
                <div class="payment-step" id="step-payment">
                  <div class="step-icon">2</div>
                  <div class="step-label">Payment</div>
                </div>
                <div class="payment-step" id="step-confirm">
                  <div class="step-icon">3</div>
                  <div class="step-label">Confirm</div>
                </div>
              </div>

              <!-- Step 1: Plan Selection -->
              <div id="plan-step" class="payment-step-content">
                <h4 class="mb-4">Confirm Your Plan</h4>
                <div class="card mb-4">
                  <div class="card-body">
                    <div
                      class="d-flex justify-content-between align-items-center"
                    >
                      <div>
                        <h5 class="card-title" id="selected-plan-name">
                          Premium Plan
                        </h5>
                        <p class="card-text mb-0" id="selected-plan-desc">
                          30 generations, all formats, premium features
                        </p>
                      </div>
                      <div class="text-end">
                        <h3 class="mb-0 text-primary" id="selected-plan-price">
                          $9.99
                        </h3>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="mb-4">
                  <h5>What's included:</h5>
                  <ul class="list-group" id="plan-features">
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-check text-success me-2"></i> 30 quiz
                      generations
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-check text-success me-2"></i> Access to
                      all question types
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-check text-success me-2"></i> PDF, Word,
                      and Text downloads
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-check text-success me-2"></i> Save to
                      favorites feature
                    </li>
                  </ul>
                </div>
                <div class="d-flex justify-content-between">
                  <button
                    class="btn btn-outline-secondary"
                    data-bs-dismiss="modal"
                  >
                    Cancel
                  </button>
                  <button class="btn btn-primary" id="proceed-to-payment">
                    Proceed to Payment
                  </button>
                </div>
              </div>

              <!-- Step 2: Payment Information -->
              <div
                id="payment-step"
                class="payment-step-content"
                style="display: none"
              >
                <h4 class="mb-4">Payment Information</h4>
                <div class="payment-form-container">
                  <form id="payment-form">
                    <div class="mb-3">
                      <label class="form-label">Payment Method</label>
                      <div class="d-flex mb-3">
                        <div class="form-check me-4">
                          <input
                            class="form-check-input"
                            type="radio"
                            name="payment-method"
                            id="payment-card"
                            checked
                          />
                          <label class="form-check-label" for="payment-card">
                            Credit Card
                          </label>
                        </div>
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="radio"
                            name="payment-method"
                            id="payment-paypal"
                          />
                          <label class="form-check-label" for="payment-paypal">
                            PayPal
                          </label>
                        </div>
                      </div>
                    </div>

                    <!-- Credit Card Form -->
                    <div id="card-payment-form">
                      <div class="mb-3">
                        <label for="card-name" class="form-label"
                          >Name on Card</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="card-name"
                          placeholder="John Doe"
                          required
                        />
                      </div>
                      <div class="mb-3">
                        <label for="card-number" class="form-label"
                          >Card Number</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="card-number"
                          placeholder="1234 5678 9012 3456"
                          required
                        />
                      </div>
                      <div class="row">
                        <div class="col-md-6 mb-3">
                          <label for="card-expiry" class="form-label"
                            >Expiration Date</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="card-expiry"
                            placeholder="MM/YY"
                            required
                          />
                        </div>
                        <div class="col-md-6 mb-3">
                          <label for="card-cvv" class="form-label"
                            >Security Code (CVV)</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="card-cvv"
                            placeholder="123"
                            required
                          />
                        </div>
                      </div>
                    </div>

                    <!-- PayPal Form (will be hidden by default) -->
                    <div id="paypal-payment-form" style="display: none">
                      <div class="text-center py-4">
                        <img
                          src="https://www.paypalobjects.com/webstatic/mktg/logo/pp_cc_mark_111x69.jpg"
                          alt="PayPal"
                          height="69"
                        />
                        <p class="mt-3">
                          You will be redirected to PayPal to complete your
                          payment.
                        </p>
                      </div>
                    </div>

                    <div class="mb-3">
                      <label for="billing-email" class="form-label"
                        >Billing Email</label
                      >
                      <input
                        type="email"
                        class="form-control"
                        id="billing-email"
                        placeholder="your@email.com"
                        required
                      />
                    </div>
                    <div class="d-flex justify-content-between">
                      <button
                        type="button"
                        class="btn btn-outline-secondary"
                        id="back-to-plan"
                      >
                        Back
                      </button>
                      <button
                        type="submit"
                        class="btn btn-primary"
                        id="process-payment"
                      >
                        Process Payment
                      </button>
                    </div>
                  </form>
                </div>
              </div>

              <!-- Step 3: Confirmation -->
              <div
                id="confirm-step"
                class="payment-step-content"
                style="display: none"
              >
                <div class="text-center py-4">
                  <i
                    class="fas fa-check-circle text-success"
                    style="font-size: 4rem"
                  ></i>
                  <h4 class="mt-4">Payment Successful!</h4>
                  <p class="mb-4">
                    Thank you for your purchase. Your account has been updated
                    with the new credits.
                  </p>
                  <div class="card mb-4 mx-auto" style="max-width: 400px">
                    <div class="card-body">
                      <h5 class="card-title">Order Summary</h5>
                      <div class="d-flex justify-content-between mb-2">
                        <span>Plan:</span>
                        <span id="summary-plan">Premium Plan</span>
                      </div>
                      <div class="d-flex justify-content-between mb-2">
                        <span>Amount:</span>
                        <span id="summary-amount">$9.99</span>
                      </div>
                      <div class="d-flex justify-content-between mb-2">
                        <span>Date:</span>
                        <span id="summary-date">August 15, 2023</span>
                      </div>
                      <div class="d-flex justify-content-between mb-2">
                        <span>Order ID:</span>
                        <span id="summary-order-id">ORD-12345678</span>
                      </div>
                    </div>
                  </div>
                  <p>A receipt has been sent to your email.</p>
                  <div class="mt-4">
                    <button class="btn btn-primary" id="go-to-generator">
                      Start Creating Quizzes
                    </button>
                    <button
                      class="btn btn-outline-secondary ms-2"
                      data-bs-dismiss="modal"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Contact Modal -->
      <div
        class="modal fade"
        id="contactModal"
        tabindex="-1"
        aria-labelledby="contactModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="contactModalLabel">
                Contact Support
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form id="contact-form">
                <div class="mb-3">
                  <label for="contact-name" class="form-label">Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="contact-name"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="contact-email" class="form-label"
                    >Email Address</label
                  >
                  <input
                    type="email"
                    class="form-control"
                    id="contact-email"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="contact-subject" class="form-label"
                    >Subject</label
                  >
                  <select class="form-select" id="contact-subject" required>
                    <option value="" selected disabled>Select a subject</option>
                    <option value="general">General Inquiry</option>
                    <option value="support">Technical Support</option>
                    <option value="billing">Billing Question</option>
                    <option value="feature">Feature Request</option>
                    <option value="enterprise">Enterprise Pricing</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="contact-message" class="form-label"
                    >Message</label
                  >
                  <textarea
                    class="form-control"
                    id="contact-message"
                    rows="5"
                    required
                  ></textarea>
                </div>
                <button
                  type="submit"
                  class="btn btn-primary w-100"
                  id="send-message"
                >
                  Send Message
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Reset Password Modal -->
      <div
        class="modal fade"
        id="resetPasswordModal"
        tabindex="-1"
        aria-labelledby="resetPasswordModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="resetPasswordModalLabel">
                Reset Password
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form id="reset-password-form">
                <div class="mb-3">
                  <label for="reset-email" class="form-label">Email Address</label>
                  <input
                    type="email"
                    class="form-control"
                    id="reset-email"
                    required
                    oninvalid="this.setCustomValidity('Please enter your email address')"
                    oninput="this.setCustomValidity('')"
                  />
                </div>
                
                <div class="mb-3 verification-section">
                  <label for="verification-code" class="form-label">Verification Code</label>
                  <div class="d-flex">
                    <input
                      type="text"
                      class="form-control"
                      id="verification-code"
                      required
                      pattern="[0-9]{4,6}"
                      oninvalid="this.setCustomValidity('Please enter the 4-6 digit verification code')"
                      oninput="this.setCustomValidity('')"
                    />
                    <button type="button" class="btn btn-secondary ms-2" id="send-code-btn">
                      Get Code
                    </button>
                  </div>
                  <small class="text-muted" id="verification-feedback">
                    We'll send a verification code to your email
                  </small>
                </div>
                
                <div class="mb-3 password-section">
                  <label for="new-password" class="form-label">New Password</label>
                  <input
                    type="password"
                    class="form-control"
                    id="new-password"
                    required
                    oninvalid="this.setCustomValidity('Please enter your new password')"
                    oninput="this.setCustomValidity('')"
                  />
                  <div class="progress mt-2" style="height: 5px">
                    <div
                      class="progress-bar bg-danger"
                      role="progressbar"
                      style="width: 0%"
                      id="new-password-strength"
                    ></div>
                  </div>
                  <small class="text-muted" id="new-password-feedback">
                    Password strength will be shown here
                  </small>
                </div>
                
                <div class="mb-3 password-section">
                  <label for="confirm-new-password" class="form-label">Confirm New Password</label>
                  <input
                    type="password"
                    class="form-control"
                    id="confirm-new-password"
                    required
                    oninvalid="this.setCustomValidity('Please confirm your new password')"
                    oninput="this.setCustomValidity('')"
                  />
                </div>
                
                <div class="d-grid">
                  <button type="submit" class="btn btn-primary" id="reset-password-submit">
                    Reset Password
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Notification Element -->
      <div class="notification" id="notification">
        <div class="notification-header">
          <h6 class="notification-title" id="notification-title">Success</h6>
          <button class="notification-close" id="notification-close">×</button>
        </div>
        <p class="notification-message" id="notification-message">
          Action completed successfully.
        </p>
      </div>

      <!-- Bootstrap JS -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
      <!-- Custom JS -->
      <script src="https://cdn.jsdelivr.net/npm/js-md5@0.8.3/src/md5.min.js"></script>
      <script>
        // ===== GLOBAL VARIABLES =====
        let isLoggedIn = false;
        let currentUser = null;
        let currentPlan = null;
        let remainingGenerations = 0;
        let showingAnswers = false;
        let generatedQuestions = [];

        // 历史记录全局变量
        let allHistoryItems = [];
        let currentHistoryPage = 1;
        let totalHistoryPages = 1;
        let totalHistoryItems = 0;

        // 全局收藏列表变量
        let allFavoriteItems = [];
        let currentFavoritePage = 1;
        let totalFavoritePages = 1;
        let totalFavoriteItems = 0;

        // ===== UTILITY FUNCTIONS =====
        function showNotification(type, title, message, duration = 3000) {
          const notification = document.getElementById("notification");
          const notificationTitle =
            document.getElementById("notification-title");
          const notificationMessage = document.getElementById(
            "notification-message"
          );

          notification.className = "notification";
          notification.classList.add(`notification-${type}`);
          notification.classList.add("show");

          notificationTitle.textContent = title;
          notificationMessage.textContent = message;

          setTimeout(() => {
            notification.classList.remove("show");
          }, duration);
        }

        function formatDate(date = new Date()) {
          const options = { year: "numeric", month: "long", day: "numeric" };
          return date.toLocaleDateString("en-US", options);
        }

        function generateRandomId(length = 8) {
          const chars =
            "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
          let result = "";
          for (let i = 0; i < length; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
          }
          return result;
        }

        // ===== MOCK DATABASE =====
        const mockUsers = [
          {
            id: "user1",
            name: "John Doe",
            email: "demo@example.com",
            password: "password123",
            role: "teacher",
            plan: "premium",
            remainingGenerations: 18,
            totalGenerations: 30,
            createdAt: "2023-08-05T10:30:00Z",
            avatar: "https://i.pravatar.cc/150?img=12",
          },
        ];

        const mockPlans = {
          free: {
            name: "Free Trial",
            price: 0,
            generations: 1,
            features: ["All question types", "PDF download"],
          },
          basic: {
            name: "Basic",
            price: 0.99,
            generations: 2,
            features: ["All question types", "PDF and Word downloads"],
          },
          standard: {
            name: "Standard",
            price: 4.99,
            generations: 10,
            features: ["All question types", "All download formats"],
          },
          premium: {
            name: "Premium",
            price: 9.99,
            generations: 30,
            features: [
              "All question types",
              "All download formats",
              "Save to favorites",
            ],
          },
          monthly: {
            name: "Monthly",
            price: 10.99,
            generations: 50,
            features: [
              "All question types",
              "All download formats",
              "Save to favorites",
              "Priority support",
            ],
            recurring: true,
          },
          annual: {
            name: "Annual",
            price: 99.99,
            generations: 1000,
            features: [
              "All question types",
              "All download formats",
              "Save to favorites",
              "Priority support",
              "Bulk generation",
            ],
            recurring: true,
          },
        };

        const mockQuestionTemplates = {
          "math-arithmetic": {
            easy: [
              {
                type: "multiple_choice",
                text: "What is 25 + 18?",
                options: ["43", "42", "44", "45"],
                answer: "43",
                explanation: "25 + 18 = 43",
              },
              {
                type: "fill_blank",
                text: "Fill in the missing number: 5, 10, 15, ___, 25",
                answer: "20",
                explanation: "The pattern increases by 5 each time",
              },
              {
                type: "true_false",
                text: "15 + 17 = 32",
                answer: "True",
                explanation: "15 + 17 = 32",
              },
              {
                type: "multiple_choice",
                text: "What is 7 × 6?",
                options: ["42", "41", "43", "46"],
                answer: "42",
                explanation: "7 × 6 = 42",
              },
              {
                type: "word_problem",
                text: "Sarah has 24 cookies. She gives 6 cookies to her friend. How many cookies does Sarah have left?",
                answer: "18",
                explanation: "24 - 6 = 18",
              },
            ],
            medium: [
              {
                type: "multiple_choice",
                text: "What is 125 + 237?",
                options: ["362", "352", "372", "342"],
                answer: "362",
                explanation: "125 + 237 = 362",
              },
              {
                type: "fill_blank",
                text: "Fill in the missing number: 4, 8, 16, ___, 64",
                answer: "32",
                explanation: "The pattern multiplies by 2 each time",
              },
              {
                type: "word_problem",
                text: "A store sells apples for $0.50 each and oranges for $0.75 each. If I buy 6 apples and 4 oranges, how much will I spend?",
                answer: "$6.00",
                explanation:
                  "6 apples at $0.50 each = $3.00, 4 oranges at $0.75 each = $3.00, Total = $6.00",
              },
            ],
            hard: [
              {
                type: "multiple_choice",
                text: "What is 15% of 840?",
                options: ["126", "124", "128", "130"],
                answer: "126",
                explanation: "15% of 840 = 0.15 × 840 = 126",
              },
              {
                type: "word_problem",
                text: "A train travels at 60 miles per hour. How far will it travel in 3.5 hours?",
                answer: "210 miles",
                explanation:
                  "Distance = Speed × Time = 60 miles/hour × 3.5 hours = 210 miles",
              },
            ],
          },
          "math-algebra": {
            easy: [
              {
                type: "multiple_choice",
                text: "Solve for x: x + 5 = 12",
                options: ["7", "8", "6", "5"],
                answer: "7",
                explanation: "x + 5 = 12, so x = 12 - 5 = 7",
              },
              {
                type: "fill_blank",
                text: "If 3x = 15, then x = ___",
                answer: "5",
                explanation: "3x = 15, so x = 15 ÷ 3 = 5",
              },
            ],
            medium: [
              {
                type: "multiple_choice",
                text: "Solve for x: 2x - 7 = 9",
                options: ["8", "7", "9", "6"],
                answer: "8",
                explanation: "2x - 7 = 9, so 2x = 16, and x = 8",
              },
              {
                type: "fill_blank",
                text: "Solve for x: 3(x + 2) = 24, x = ___",
                answer: "6",
                explanation: "3(x + 2) = 24, so x + 2 = 8, and x = 6",
              },
            ],
            hard: [
              {
                type: "multiple_choice",
                text: "Solve for x: 2(x + 3) - 5 = 3x - 7",
                options: ["2", "3", "4", "1"],
                answer: "2",
                explanation:
                  "2x + 6 - 5 = 3x - 7, so 2x + 1 = 3x - 7, so 1 + 7 = 3x - 2x, so 8 = x",
              },
              {
                type: "word_problem",
                text: "The sum of three consecutive integers is 51. What is the smallest of these integers?",
                answer: "16",
                explanation:
                  "Let the integers be x, x+1, and x+2. Then x + (x+1) + (x+2) = 51, so 3x + 3 = 51, so 3x = 48, and x = 16.",
              },
            ],
          },
          "science-general": {
            easy: [
              {
                type: "multiple_choice",
                text: "Which of the following is NOT a state of matter?",
                options: ["Energy", "Solid", "Liquid", "Gas"],
                answer: "Energy",
                explanation:
                  "The three main states of matter are solid, liquid, and gas. Energy is not a state of matter.",
              },
              {
                type: "true_false",
                text: "Plants make their own food through a process called photosynthesis.",
                answer: "True",
                explanation:
                  "Plants use sunlight, water, and carbon dioxide to create glucose (sugar) through photosynthesis.",
              },
            ],
            medium: [
              {
                type: "multiple_choice",
                text: "What is the main function of the mitochondria in a cell?",
                options: [
                  "Energy production",
                  "Protein synthesis",
                  "Cell division",
                  "Waste removal",
                ],
                answer: "Energy production",
                explanation:
                  'Mitochondria are known as the "powerhouses" of the cell because they produce ATP, the cell\'s main energy currency.',
              },
              {
                type: "short_answer",
                text: "Explain the difference between a physical and chemical change.",
                answer:
                  "A physical change alters the form of a substance but not its chemical composition, while a chemical change creates new substances with different properties.",
                explanation:
                  "Examples of physical changes include changes in state, shape, or size. Chemical changes involve chemical reactions that form new substances.",
              },
            ],
            hard: [
              {
                type: "multiple_choice",
                text: "Which of the following best explains natural selection?",
                options: [
                  "Organisms with advantageous traits are more likely to survive and reproduce",
                  "Organisms can change their traits during their lifetime to better suit their environment",
                  "Species always evolve toward greater complexity",
                  "All mutations are beneficial to a species",
                ],
                answer:
                  "Organisms with advantageous traits are more likely to survive and reproduce",
                explanation:
                  "Natural selection is the process where organisms with traits better suited to their environment tend to survive and produce more offspring, passing those traits to future generations.",
              },
              {
                type: "short_answer",
                text: "Explain how an electromagnetic wave differs from a mechanical wave.",
                answer:
                  "Electromagnetic waves can travel through vacuum and don't require a medium, while mechanical waves require a medium to travel through. Electromagnetic waves consist of oscillating electric and magnetic fields.",
                explanation:
                  "Examples of electromagnetic waves include light, radio waves, and X-rays. Examples of mechanical waves include sound waves and ocean waves.",
              },
            ],
          },
        };

        // ===== INITIALIZATION =====
        document.addEventListener("DOMContentLoaded", function () {
          // Initialize UI
          setupEventListeners();
          handleScroll();
          
          // 先检查登录状态，确保所有依赖登录的功能都在登录状态验证之后执行
          checkLoginStatus();

          // 初始化页面路由和状态
          const initialHash = window.location.hash.substring(1) || "home";
          if (initialHash === "home" || initialHash === "pricing") {
            // 在页面最初加载时就隐藏How It Works部分
            const howItWorksSection = document.getElementById("how-it-works-section");
            if (howItWorksSection) {
              howItWorksSection.classList.remove("active");
              howItWorksSection.style.display = "none"; // 确保完全隐藏
            }
          }

          // 如果初始化页面是dashboard相关页面，确保登录状态检查完成后再加载
          if (initialHash === "dashboard") {
            if (isLoggedIn) {
              setupRouting();
              // 默认显示dashboard overview标签
              document.querySelector('.nav-link[data-tab="dashboard-overview"]').click();
              // 加载Recent Activity数据
              updateRecentActivity();
            } else {
              // 如果未登录但尝试访问dashboard，重定向到首页
              window.location.hash = "home";
              setupRouting();
            }
          } else {
            // 设置路由
            setupRouting();
          }
          
          // 手动添加Terms和Privacy点击事件
          document.getElementById("terms-link").addEventListener("click", openTermsModal);
          document.getElementById("privacy-link").addEventListener("click", openPrivacyModal);
          
          // 确保登录表单中的条款链接也正常工作
          const loginTermsLink = document.getElementById("login-terms-link");
          if (loginTermsLink) {
            loginTermsLink.addEventListener("click", openTermsModal);
          }
          
          const loginPrivacyLink = document.getElementById("login-privacy-link");
          if (loginPrivacyLink) {
            loginPrivacyLink.addEventListener("click", openPrivacyModal);
          }
        });

        // ===== EVENT LISTENERS =====
        function setupEventListeners() {
          // Navbar scroll effect
          window.addEventListener("scroll", handleScroll);

          // Auth related events
          document
            .getElementById("login-tab")
            .addEventListener("click", switchAuthTab);
          document
            .getElementById("register-tab")
            .addEventListener("click", switchAuthTab);
          document
            .getElementById("login-form-element")
            .addEventListener("submit", handleLogin);
          document
            .getElementById("register-form-element")
            .addEventListener("submit", handleRegister);
          document
            .getElementById("logout-button")
            .addEventListener("click", handleLogout);

          // 添加中文输入检测
          const inputFields = document.querySelectorAll('input[type="email"], input[type="password"], input[type="text"]');
          inputFields.forEach(field => {
            field.addEventListener('input', function() {
              checkChineseInput(this);
            });
          });

          // Password strength meter
          document
            .getElementById("register-password")
            .addEventListener("input", updatePasswordStrength);
          document
            .getElementById("new-password")
            .addEventListener("input", updatePasswordStrength);

          // Generation form
          document
            .getElementById("generator-form")
            .addEventListener("submit", handleGenerate);
          document
            .getElementById("toggle-answers")
            .addEventListener("click", toggleAnswers);
            
          // Add event listeners for question type checkboxes and comprehensive test
          const questionTypeCheckboxes = document.querySelectorAll('.question-type-checkbox');
          const comprehensiveTestCheckbox = document.getElementById('comprehensive-test');
          const questionsCountInput = document.getElementById('questions-count');
          
          // Add event listeners to all question type checkboxes
          questionTypeCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
              // If any question type is checked and comprehensive test is also checked
              if (this.checked && comprehensiveTestCheckbox.checked) {
                // Uncheck comprehensive test
                comprehensiveTestCheckbox.checked = false;
                // 恢复问题数量输入框
                questionsCountInput.disabled = false;
              }
            });
          });
          
          // Add event listener to comprehensive test checkbox
          comprehensiveTestCheckbox.addEventListener('change', function() {
            // If comprehensive test is checked
            if (this.checked) {
              // Uncheck all question type checkboxes
              questionTypeCheckboxes.forEach(checkbox => {
                checkbox.checked = false;
              });
              // 设置问题数量为1并禁用输入框
              questionsCountInput.value = 1;
              questionsCountInput.disabled = true;
            } else {
              // 恢复问题数量输入框
              questionsCountInput.disabled = false;
            }
          });

          // Dashboard tabs
          const dashboardLinks = document.querySelectorAll(
            ".dashboard-sidebar .nav-link"
          );
          dashboardLinks.forEach((link) => {
            link.addEventListener("click", switchDashboardTab);
          });

          // Try-free buttons
          document
            .getElementById("try-free-button")
            .addEventListener("click", goToGenerator);
          document
            .getElementById("try-free-pricing")
            .addEventListener("click", goToGenerator);
          document
            .getElementById("try-now-button")
            .addEventListener("click", goToGenerator);
          document
            .getElementById("get-started-button")
            .addEventListener("click", goToGenerator);
          document
            .getElementById("create-new-quiz")
            .addEventListener("click", goToGenerator);

          // Payment related events
          const buyButtons = document.querySelectorAll(".buy-btn");
          buyButtons.forEach((button) => {
            button.addEventListener("click", handleBuyClick);
          });
          document
            .getElementById("proceed-to-payment")
            .addEventListener("click", proceedToPayment);
          document
            .getElementById("back-to-plan")
            .addEventListener("click", backToPlan);
          document
            .getElementById("payment-form")
            .addEventListener("submit", processPayment);
          document
            .getElementById("payment-card")
            .addEventListener("change", togglePaymentForm);
          document
            .getElementById("payment-paypal")
            .addEventListener("change", togglePaymentForm);
          document
            .getElementById("go-to-generator")
            .addEventListener("click", closeModalAndGoToGenerator);

          // Contact form
          document
            .getElementById("contact-form")
            .addEventListener("submit", handleContactSubmit);

          // Notification close button
          document
            .getElementById("notification-close")
            .addEventListener("click", function () {
              document.getElementById("notification").classList.remove("show");
            });

          // Profile form
          document
            .getElementById("profile-form")
            .addEventListener("submit", handleProfileUpdate);
          document
            .getElementById("password-form")
            .addEventListener("submit", handlePasswordUpdate);
          document
            .getElementById("preferences-form")
            .addEventListener("submit", handlePreferencesUpdate);
          document
            .getElementById("upgrade-btn")
            .addEventListener("click", function () {
              navigateTo("pricing");
            });
          document
            .getElementById("view-plans-btn")
            .addEventListener("click", function () {
              navigateTo("pricing");
            });
            
          // Terms of Service link
          document
            .getElementById("terms-link")
            .addEventListener("click", openTermsModal);
            
          // Privacy Policy link
          document
            .getElementById("privacy-link")
            .addEventListener("click", openPrivacyModal);
            
          // 移除对不存在的cookie-link元素的引用
          // document
          //   .getElementById("cookie-link")
          //   .addEventListener("click", openCookieModal);
        }

        // ===== UI HANDLERS =====
        function handleScroll() {
          const navbar = document.querySelector(".navbar");
          if (window.scrollY > 50) {
            navbar.classList.add("scrolled");
          } else {
            navbar.classList.remove("scrolled");
          }
        }

        function handleContactSubmit(e) {
          e.preventDefault();
          
          // Get form values
          const name = document.getElementById("contact-name").value.trim();
          const email = document.getElementById("contact-email").value.trim();
          const message = document.getElementById("contact-message").value.trim();
          
          // Basic validation
          if (!name || !email || !message) {
            showNotification(
              "error",
              "Form Error",
              "Please fill in all fields."
            );
            return;
          }
          
          if (!isValidEmail(email)) {
            showNotification(
              "error",
              "Form Error",
              "Please enter a valid email address."
            );
            return;
          }
          
          // Simulate sending the contact form
          showNotification(
            "success",
            "Message Sent",
            "Thank you for your message. We'll get back to you soon!"
          );
          
          // Reset the form
          document.getElementById("contact-form").reset();
        }

        function switchAuthTab(e) {
          const authTabs = document.querySelectorAll(".auth-tab");
          authTabs.forEach((tab) => tab.classList.remove("active"));

          e.target.classList.add("active");
          const tabId = e.target.getAttribute("data-tab");

          if (tabId === "login-form") {
            document.getElementById("login-form").style.display = "block";
            document.getElementById("register-form").style.display = "none";
          } else {
            document.getElementById("login-form").style.display = "none";
            document.getElementById("register-form").style.display = "block";
          }
        }

        function switchDashboardTab(e) {
          e.preventDefault();

          const tabLinks = document.querySelectorAll(
            ".dashboard-sidebar .nav-link"
          );
          tabLinks.forEach((link) => link.classList.remove("active"));

          e.target.classList.add("active");
          const tabId = e.target.getAttribute("data-tab");

          const tabs = document.querySelectorAll(".dashboard-tab");
          tabs.forEach((tab) => (tab.style.display = "none"));

          document.getElementById(tabId).style.display = "block";
          
          // 如果切换到Dashboard概览，加载Recent Activity
          if (tabId === "dashboard-overview") {
            // 加载最近活动数据
            updateRecentActivity();
          }
          
          // 如果切换到历史记录标签页，加载历史记录数据
          if (tabId === "generation-history") {
            // 默认加载第一页数据
            fetchQuizHistory(1);
          }
          
          // 如果切换到收藏标签页，加载收藏数据
          if (tabId === "favorites") {
            // 默认加载第一页数据
            fetchFavorites(1);
          }
        }

        function updatePasswordStrength(e) {
          const password = e.target.value;
          const strength = calculatePasswordStrength(password);
          let progressBar, feedback;

          if (e.target.id === "register-password") {
            progressBar = document.getElementById("register-password-strength");
            feedback = document.getElementById("register-password-feedback");
          } else {
            progressBar = document.getElementById("password-strength");
            feedback = document.getElementById("password-feedback");
          }

          // Update progress bar
          progressBar.style.width = `${strength.score * 25}%`;

          // Set appropriate color
          progressBar.className = "progress-bar";
          if (strength.score <= 1) {
            progressBar.classList.add("bg-danger");
          } else if (strength.score <= 2) {
            progressBar.classList.add("bg-warning");
          } else if (strength.score <= 3) {
            progressBar.classList.add("bg-info");
          } else {
            progressBar.classList.add("bg-success");
          }

          // Update feedback text
          feedback.textContent = strength.feedback;
        }

        function calculatePasswordStrength(password) {
          // Simple password strength algorithm
          let score = 0;
          let feedback = "Password is too weak";

          if (password.length >= 8) score++;
          if (password.match(/[A-Z]/)) score++;
          if (password.match(/[0-9]/)) score++;
          if (password.match(/[^A-Za-z0-9]/)) score++;

          if (score === 1) feedback = "Password is weak";
          else if (score === 2) feedback = "Password is moderate";
          else if (score === 3) feedback = "Password is strong";
          else if (score === 4) feedback = "Password is very strong";

          return { score, feedback };
        }

        function toggleAnswers() {
          const answersButton = document.getElementById("toggle-answers");
          const answerElements = document.querySelectorAll(".question-answer");

          showingAnswers = !showingAnswers;

          if (showingAnswers) {
            answersButton.innerHTML =
              '<i class="fas fa-eye-slash me-1"></i> Hide Answers';
            answerElements.forEach((el) => (el.style.display = "block"));
          } else {
            answersButton.innerHTML =
              '<i class="fas fa-eye me-1"></i> Show Answers';
            answerElements.forEach((el) => (el.style.display = "none"));
          }
        }

        function togglePaymentForm() {
          const cardForm = document.getElementById("card-payment-form");
          const paypalForm = document.getElementById("paypal-payment-form");

          if (document.getElementById("payment-card").checked) {
            cardForm.style.display = "block";
            paypalForm.style.display = "none";
          } else {
            cardForm.style.display = "none";
            paypalForm.style.display = "block";
          }
        }

        // ===== AUTH FUNCTIONS =====
        function checkLoginStatus() {
          // 检查localStorage和sessionStorage中的用户信息和令牌
          const savedUser = localStorage.getItem("currentUser") || sessionStorage.getItem("currentUser");
          const accessToken = localStorage.getItem("accessToken") || sessionStorage.getItem("accessToken");
          
          if (savedUser && accessToken) {
            // 解析用户数据
            try {
              currentUser = JSON.parse(savedUser);
              isLoggedIn = true;
              
              // 更新UI显示已登录状态
              updateUIForLoggedInUser();
              
              // 验证令牌有效性（可选，如果需要立即验证令牌）
              validateToken();
            } catch (e) {
              console.error("Error parsing user data:", e);
              // 数据解析错误，清除存储并保持未登录状态
              localStorage.removeItem("currentUser");
              sessionStorage.removeItem("currentUser");
              localStorage.removeItem("accessToken");
              sessionStorage.removeItem("accessToken");
            }
          } else {
            // 令牌或用户数据不完整，清除存储
            if (savedUser || accessToken) {
              localStorage.removeItem("currentUser");
              sessionStorage.removeItem("currentUser");
              localStorage.removeItem("accessToken");
              sessionStorage.removeItem("accessToken");
            }
            isLoggedIn = false;
          }
        }

        function validateToken() {
          // 获取访问令牌
          const accessToken = localStorage.getItem("accessToken") || sessionStorage.getItem("accessToken");
          
          if (!accessToken) return;
          
          // 调用验证API，例如获取用户信息或执行简单验证
          fetch('http://web.practicesnow.com/api/v1/auth/validate', {
            method: 'GET',
            headers: {
              'Accept': 'application/json',
              'Authorization': `Bearer ${accessToken}`
            }
          })
          .then(response => {
            if (response.status === 401) {
              // 令牌无效，尝试刷新
              const refreshToken = localStorage.getItem("refreshToken") || sessionStorage.getItem("refreshToken");
              if (refreshToken) {
                refreshTokenAndRetry();
              } else {
                // 无法刷新，需要重新登录
                handleSessionExpired();
              }
            }
          })
          .catch(error => {
            console.warn("Token validation failed:", error);
            // 仅记录错误，不强制登出，避免网络问题导致误登出
          });
        }

        function updateUIForLoggedInUser() {
          // 确保用户确实已登录
          if (!isLoggedIn || !currentUser) {
            console.error("Attempted to update UI for logged in user, but user is not logged in");
            return;
          }

          // Update navigation
          document.getElementById("auth-buttons").style.display = "none";
          document.getElementById("user-info").style.display = "flex";

          // 确保在移动视图中也隐藏登录按钮
          try {
            const loginButton = document.getElementById("login-button");
            const registerButton = document.getElementById("register-button");
            if (loginButton) loginButton.style.display = "none";
            if (registerButton) registerButton.style.display = "none";
          } catch (e) {
            console.error("Error hiding login/register buttons:", e);
          }

          // Update user info in navbar
          document.getElementById("navbar-username").textContent = currentUser.name;
          
          // 检查和显示用户积分
          // 格式化积分显示，确保不会换行
          const creditsSpan = document.getElementById("navbar-credits");
          creditsSpan.textContent = `${currentUser.remainingGenerations || 5} credits`;
          creditsSpan.style.whiteSpace = "nowrap"; // 防止换行

          // Update dashboard info
          document.getElementById("sidebar-username").textContent = currentUser.name;
          document.getElementById("sidebar-plan").textContent = 
            `${currentUser.plan ? mockPlans[currentUser.plan]?.name || "Free" : "Free"} Plan`;
          
          // 更新剩余生成次数
          const remainingGens = currentUser.remainingGenerations || 5;
          const totalGens = currentUser.totalGenerations || 10;
          document.getElementById("remaining-generations").textContent = remainingGens;
          document.getElementById("total-generations").textContent = totalGens;

          // Update progress bar
          const progressPercent = (remainingGens / totalGens) * 100;
          document.querySelector(".progress-bar").style.width = `${progressPercent}%`;
        }

        function handleLogin(e) {
          e.preventDefault();

          // 获取表单和错误信息元素
          const loginForm = document.getElementById("login-form-element");
          
          // 获取输入值
          const email = document.getElementById("login-email").value.trim();
          const password = document.getElementById("login-password").value;
          const rememberMe = document.getElementById("remember-me").checked;
          
          // 检查是否同意条款
          const agreeTerms = document.getElementById("login-agree-terms").checked;
          if (!agreeTerms) {
            // 创建错误提示（如果不存在）
            let errorMessageElement = loginForm.querySelector(".alert");
            if (!errorMessageElement) {
              errorMessageElement = document.createElement("div");
              errorMessageElement.className = "alert alert-danger mt-3";
              errorMessageElement.setAttribute("role", "alert");
              const submitButton = document.getElementById("login-submit");
              loginForm.insertBefore(errorMessageElement, submitButton.parentNode);
            } else {
              errorMessageElement.classList.remove("d-none");
            }
            
            // 设置错误信息
            errorMessageElement.textContent = "Please agree to our Terms of Service and Privacy Policy to continue.";
            
            // 显示通知
            showNotification(
              "error",
              "Login Failed",
              "Please agree to our Terms of Service and Privacy Policy to continue."
            );
            return;
          }
          
          // 基本验证
          if (!email || !password) {
            showNotification(
              "error",
              "Login Failed",
              "Please enter both email and password."
            );
            return;
          }

          // 提醒使用英文
          if (/[\u4e00-\u9fa5]/.test(email) || /[\u4e00-\u9fa5]/.test(password)) {
            showNotification(
              "warning", 
              "Language Notice", 
              "Please use English characters for login credentials."
            );
            return;
          }
          
          // 使用MD5加密密码
          const md5Password = md5(password);
          
          // 准备API请求数据
          const loginData = {
            email: email,
            password: md5Password
          };

          // 更新提交按钮状态
          const loginSubmitButton = document.getElementById("login-submit");
          const originalButtonText = loginSubmitButton.textContent;
          loginSubmitButton.disabled = true;
          loginSubmitButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Logging in...';

          // 调用登录API
          fetch('http://web.practicesnow.com/api/v1/auth/login', {
            method: 'POST',
            credentials: 'omit',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify(loginData)
          })
          .then(response => {
            console.log('login--response',response)
            // 显式检查HTTP响应状态码是否在200-299之间
            const isSuccess = response.status >= 200 && response.status < 300;
            // 解析JSON响应
            return response.json().then(data => {
              // 返回包含响应状态和数据的对象
              return { isSuccess, data, status: response.status };
            });
          })
          .then(result => {
            console.log('login--result',result)
            if (result.isSuccess) {
              // 登录成功，处理API返回的数据
              const responseData = result.data;
              
              // 检查API返回是否成功
              if (responseData.ok !== 1) {
                throw new Error(responseData.message || "登录失败");
              }
              
              // 获取API返回的数据
              const data = responseData.data;
              const userData = data.user;
              
              // 创建用户对象
              const user = {
                id: userData.id,
                name: userData.name,
                email: userData.email,
                plan: "free", // 默认plan，可根据API返回调整
                remainingGenerations: 5, // 默认值，可根据API返回调整
                totalGenerations: 10, // 默认值，可根据API返回调整
                createdAt: userData.created_at,
                lastLoginAt: userData.last_login_at,
                avatar: userData.avatar_url || `https://i.pravatar.cc/150?img=${Math.floor(Math.random() * 70)}`,
                // 存储认证相关信息
                auth: {
                  accessToken: data.access_token,
                  refreshToken: data.refresh_token,
                  tokenType: data.token_type
                }
              };

              // 设置当前用户和登录状态
              currentUser = { ...user };
              isLoggedIn = true;

              // 根据记住我选项存储用户信息
              if (rememberMe) {
                // 永久存储（或者直到用户清除）
                localStorage.setItem("currentUser", JSON.stringify(currentUser));
                // 单独存储token，方便后续API调用使用
                localStorage.setItem("accessToken", data.access_token);
                localStorage.setItem("refreshToken", data.refresh_token);
                localStorage.setItem("tokenType", data.token_type);
              } else {
                // 会话存储（浏览器关闭后清除）
                sessionStorage.setItem("currentUser", JSON.stringify(currentUser));
                // 单独存储token，方便后续API调用使用
                sessionStorage.setItem("accessToken", data.access_token);
                sessionStorage.setItem("refreshToken", data.refresh_token);
                sessionStorage.setItem("tokenType", data.token_type);
              }

              // 关闭登录模态框
              const authModal = bootstrap.Modal.getInstance(
                document.getElementById("authModal")
              );
              authModal.hide();

              // 更新UI
              updateUIForLoggedInUser();

              // 显示成功通知
              showNotification(
                "success",
                "Login Successful",
                "Welcome back, " + currentUser.name + "!"
              );
              
              // 登录成功后导航到generator页面
              setTimeout(() => {
                navigateTo('generator');
              }, 1000);
            } else {
              // 登录失败，抛出错误
              throw new Error(result.data.error || `登录失败，状态码: ${result.status}`);
            }
          })
          .catch(error => {
            // 登录失败 - 显示错误消息
            console.error("Login error:", error);
            
            // 创建错误提示（如果不存在）
            let errorMessageElement = loginForm.querySelector(".alert");
            if (!errorMessageElement) {
              errorMessageElement = document.createElement("div");
              errorMessageElement.className = "alert alert-danger mt-3";
              errorMessageElement.setAttribute("role", "alert");
              loginForm.insertBefore(errorMessageElement, loginSubmitButton.parentNode);
            } else {
              errorMessageElement.classList.remove("d-none");
            }
            
            // 设置错误信息
            errorMessageElement.textContent = error.message || "邮箱或密码不正确，请重试。";
            
            // 显示通知
            showNotification(
              "error",
              "登录失败",
              error.message || "邮箱或密码不正确，请重试。"
            );
          })
          .finally(() => {
            // 重置登录按钮状态
            loginSubmitButton.disabled = false;
            loginSubmitButton.innerHTML = originalButtonText;
          });
        }

        async function handleRegister(e) {
          e.preventDefault();

          // 获取表单和错误信息元素
          const registerForm = document.getElementById("register-form-element");
          const errorMessageElement = document.getElementById("register-error-message");
          
          // 隐藏之前的错误消息
          errorMessageElement.classList.add("d-none");
          
          // 重置表单验证状态
          resetFormValidation(registerForm);

          const name = document.getElementById("register-name").value.trim();
          const email = document.getElementById("register-email").value.trim();
          const password = document.getElementById("register-password").value;
          const confirmPassword = document.getElementById(
            "register-confirm-password"
          ).value;

          // 增强的客户端表单验证
          let isValid = true;
          
          // 验证姓名
          if (!name) {
            showInputError("register-name", "Please enter your name");
            isValid = false;
          }
          
          // 验证邮箱
          if (!email || !isValidEmail(email)) {
            showInputError("register-email", "Please enter a valid email address");
            isValid = false;
          }
          
          // 验证密码
          if (!password || password.length < 8) {
            showInputError("register-password", "Password must be at least 8 characters long");
            isValid = false;
          }
          
          // 验证确认密码
          if (password !== confirmPassword) {
            showInputError("register-confirm-password", "Passwords do not match");
            isValid = false;
          }
          
          // 如果验证失败，停止提交
          if (!isValid) {
            return;
          }

          // 使用MD5加密密码
          const md5Password = md5(password);
          const md5ConfirmPassword = md5(confirmPassword);

          // Prepare data for API
          const userData = {
            email: email,
            password: md5Password,
            password_confirm: md5ConfirmPassword,
            name: name
          };

          // Show loading notification or disable button
          const registerSubmitButton = document.getElementById("register-submit");
          const originalButtonText = registerSubmitButton.textContent;
          registerSubmitButton.disabled = true;
          registerSubmitButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Registering...';

          // Call API
          fetch('http://web.practicesnow.com/api/v1/auth/register', {
            method: 'POST',
            credentials: 'omit',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json',
            },
            body: JSON.stringify(userData),
          })
          .then(response => {
            // 显式检查HTTP响应状态码是否在200-299之间
            const isSuccess = response.status >= 200 && response.status < 300;
            // 解析JSON响应
            return response.json().then(data => {
              // 返回包含响应状态和数据的对象
              return { isSuccess, data, status: response.status };
            });
          })
          .then(result => {
            if (result.isSuccess) {
              // 注册成功
              const data = result.data;
              
              // 注册成功后，关闭当前模态框
              const authModal = bootstrap.Modal.getInstance(
                document.getElementById("authModal")
              );
              authModal.hide();
              
              // 显示成功通知
              showNotification(
                "success",
                "Registration Successful",
                "Please login with your new account."
              );
              
              // 短暂延迟后重新打开登录模态框并自动填充邮箱
              setTimeout(() => {
                // 打开登录模态框
                const loginModal = new bootstrap.Modal(document.getElementById("authModal"));
                loginModal.show();
                
                // 切换到登录标签
                document.getElementById("login-tab").click();
                
                // 自动填充邮箱
                document.getElementById("login-email").value = email;
                
                // 聚焦密码输入框
                document.getElementById("login-password").focus();
              }, 1000);
            } else {
              // 注册失败，抛出错误
              throw new Error(result.data.error || `Registration failed, status code: ${result.status}`);
            }
          })
          .catch(error => {
            // Registration failed - 显示错误信息
            console.error("Registration error:", error);
            
            // 在表单中显示错误信息
            errorMessageElement.textContent = error.message || "An error occurred during registration, please try again.";
            errorMessageElement.classList.remove("d-none");
            
            // 如果是邮箱已存在错误，聚焦到邮箱输入框
            if (error.message && error.message.includes("邮箱已存在")) {
              showInputError("register-email", "Email already exists");
            }
            
            // 显示通知
            showNotification(
              "error",
              "Registration Failed",
              error.message || "An error occurred during registration, please try again."
            );
          })
          .finally(() => {
            // Re-enable button regardless of outcome
            registerSubmitButton.disabled = false;
            registerSubmitButton.innerHTML = originalButtonText;
          });
        }

        // 辅助函数：验证邮箱格式
        function isValidEmail(email) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return emailRegex.test(email);
        }

        // 辅助函数：显示输入错误
        function showInputError(elementId, message) {
          const element = document.getElementById(elementId);
          if (element) {
            element.classList.add("is-invalid");
            
            // 查找相关的反馈元素并设置消息
            const feedbackElement = document.getElementById(`${elementId}-feedback`);
            if (feedbackElement) {
              feedbackElement.textContent = message;
            }
          }
        }

        // 辅助函数：重置表单验证状态
        function resetFormValidation(form) {
          // 移除所有输入字段的错误状态
          const inputs = form.querySelectorAll("input");
          inputs.forEach(input => {
            input.classList.remove("is-invalid");
          });
        }

        function handleLogout(e) {
          e.preventDefault();

          // 更新登出按钮状态
          const logoutButton = document.getElementById("logout-button");
          const originalButtonText = logoutButton.textContent;
          logoutButton.disabled = true;
          logoutButton.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Logging out...';
          
          // 调用登出API
          fetch('http://web.practicesnow.com/api/v1/auth/logout', {
            method: 'POST',
            credentials: 'omit',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json',
              'Authorization': `Bearer ${localStorage.getItem("accessToken") || sessionStorage.getItem("accessToken") || ""}`
            },
            body: JSON.stringify({})
          })
          .then(response => {
            // 无论API返回什么结果，都进行本地登出处理
            console.log("Logout API response:", response);
            return { success: true };
          })
          .catch(error => {
            // 即使API调用失败，也进行本地登出处理
            console.error("Logout API error:", error);
            return { success: true };
          })
          .finally(() => {
            // 本地登出处理
            
            // 清除会话
            isLoggedIn = false;
            currentUser = null;
            
            // 清除LocalStorage中的所有存储
            localStorage.removeItem("currentUser");
            localStorage.removeItem("accessToken");
            localStorage.removeItem("refreshToken");
            localStorage.removeItem("tokenType");
            
            // 清除SessionStorage中的所有存储
            sessionStorage.removeItem("currentUser");
            sessionStorage.removeItem("accessToken");
            sessionStorage.removeItem("refreshToken");
            sessionStorage.removeItem("tokenType");

            // 更新UI - 显示登录/注册按钮区域
            document.getElementById("auth-buttons").style.display = "flex";
            document.getElementById("user-info").style.display = "none";
            
            // 单独确保登录和注册按钮可见
            try {
              const loginButton = document.getElementById("login-button");
              const registerButton = document.getElementById("register-button");
              if (loginButton) loginButton.style.display = "inline-block";
              if (registerButton) registerButton.style.display = "inline-block";
            } catch (e) {
              console.error("Error showing login/register buttons:", e);
            }

            // 重置登出按钮状态
            logoutButton.disabled = false;
            logoutButton.textContent = originalButtonText;

            // 导航到首页
            navigateTo("home");

            // 显示通知
            showNotification(
              "info",
              "Logged Out",
              "You have been successfully logged out."
            );
          });
        }

        // ===== GENERATOR FUNCTIONS =====
        function handleGenerate(e) {
          e.preventDefault();

          // Check if user has remaining generations
          if (isLoggedIn && currentUser.remainingGenerations <= 0) {
            showNotification(
              "warning",
              "No Credits Remaining",
              "Please purchase more generation credits to continue."
            );

            // Open pricing page
            navigateTo("pricing");
            return;
          }

          // Get form values
          const gradeSelect = document.getElementById("grade-select");
          const grade = gradeSelect.options[gradeSelect.selectedIndex].text;
          
          const subjectSelect = document.getElementById("subject-select");
          const subjectValue = subjectSelect.value;
          const subjectText = subjectSelect.options[subjectSelect.selectedIndex].text;
          
          // 提取主题分类，例如从"math-arithmetic"提取为"Mathematics Arithmetic"
          let formattedSubject = "";
          if (subjectValue.includes("math")) {
            formattedSubject = "Mathematics " + subjectText;
          } else if (subjectValue.includes("science")) {
            formattedSubject = "Science " + subjectText;
          } else if (subjectValue.includes("ela")) {
            formattedSubject = "English " + subjectText;
          } else if (subjectValue.includes("social")) {
            formattedSubject = "Social Studies " + subjectText;
          } else if (subjectValue.includes("language")) {
            formattedSubject = "Language " + subjectText;
          }

          const difficulty = getDifficultyLevel();
          const isComprehensive = document.getElementById("comprehensive-test").checked;
          
          // 确定问题数量
          let numberOfQuestions = parseInt(document.getElementById("questions-count").value, 10);
          
          // 如果是综合测试，强制设置为1
          if (isComprehensive) {
            numberOfQuestions = 1;
          } else {
            // 限制普通测试最大问题数为100
            numberOfQuestions = Math.min(numberOfQuestions, 100);
          }

          // Get selected question types
          const selectedTypes = [];
          document
            .querySelectorAll('.question-type-checkbox:checked')
            .forEach((checkbox) => {
              // 将值首字母大写并添加到数组中
              const typeValue = checkbox.value;
              let formattedType = "";
              
              if (typeValue === "multiple_choice") {
                formattedType = "Multiple Choice";
              } else if (typeValue === "true_false") {
                formattedType = "True/False";
              } else if (typeValue === "fill_blank") {
                formattedType = "Fill in the Blank";
              } else if (typeValue === "short_answer") {
                formattedType = "Short Answer";
              } else if (typeValue === "word_problem") {
                formattedType = "Word Problems";
              }
              
              selectedTypes.push(formattedType);
            });

          // Validate form
          if (!grade || !subjectValue) {
            showNotification(
              "error",
              "Validation Error",
              "Please select a grade level and subject."
            );
            return;
          }

          if (!isComprehensive && selectedTypes.length === 0) {
            showNotification(
              "error",
              "Validation Error",
              "Please select at least one question type or choose 'Make comprehensive test'."
            );
            return;
          }

          // 检查用户是否登录
          if (!isLoggedIn) {
            showNotification(
              "warning",
              "Login Required",
              "Please log in to generate quizzes."
            );
            
            // 打开登录模态框
            const authModal = new bootstrap.Modal(document.getElementById("authModal"));
            authModal.show();
            return;
          }

          // 准备API请求数据
          let requestData = {
            grade_level: grade,
            subject: formattedSubject,
            difficulty_level: difficulty,
            number_of_questions: numberOfQuestions,
            make_comprehensive_test: isComprehensive
          };
          
          // 只有在非综合测试模式下才添加问题类型
          if (!isComprehensive) {
            requestData.question_types = selectedTypes;
          }

          console.log("API Request Data:", requestData);

          // Show loading indicator
          document.getElementById("loading-indicator").style.display = "flex";
          document.getElementById("preview-placeholder").style.display = "none";
          document.getElementById("preview-content").style.display = "none";

          // 获取 accessToken
          const accessToken = localStorage.getItem("accessToken") || sessionStorage.getItem("accessToken") || "";

          // 调用API生成测验
          fetch('http://web.practicesnow.com/api/v1/quiz/generate', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json',
              'Authorization': `Bearer ${accessToken}`
            },
            body: JSON.stringify(requestData)
          })
          .then(response => {
            console.log("API Response:", response);
            const isSuccess = response.status >= 200 && response.status < 300;
            return response.json().then(data => {
              return { isSuccess, data, status: response.status };
            });
          })
          .then(result => {
            console.log("API Result:", result);
            if (result.isSuccess && result.data.ok === 1) {
              // 生成成功
              const responseData = result.data.data;
              
              // 更新预览标题
              document.getElementById(
                "preview-title"
              ).textContent = `${grade} ${formattedSubject} Quiz`;
              document.getElementById("preview-date").textContent = formatDate();
              
              // 渲染问题和答案内容
              displayQuizContent(responseData);
              
              // 隐藏加载指示器并显示预览
              document.getElementById("loading-indicator").style.display = "none";
              document.getElementById("preview-content").style.display = "block";
              
              // 重置答案显示状态
              showingAnswers = false;
              document.getElementById("toggle-answers").innerHTML =
                '<i class="fas fa-eye me-1"></i> Show Answers';
              
              // 减少用户的剩余生成次数
              if (isLoggedIn && currentUser.plan !== "free") {
                currentUser.remainingGenerations--;
                if (localStorage.getItem("currentUser")) {
                  localStorage.setItem("currentUser", JSON.stringify(currentUser));
                } else if (sessionStorage.getItem("currentUser")) {
                  sessionStorage.setItem("currentUser", JSON.stringify(currentUser));
                }
                updateUIForLoggedInUser();
                
                // 显示通知
                showNotification(
                  "success",
                  "Quiz Generated",
                  `Quiz generated successfully. You have ${currentUser.remainingGenerations} generations remaining.`
                );
              } else {
                showNotification(
                  "success",
                  "Quiz Generated",
                  "Quiz generated successfully."
                );
              }
            } else {
              // 处理API错误
              throw new Error(result.data.message || "Failed to generate quiz. Please try again.");
            }
          })
          .catch(error => {
            console.error("Quiz generation error:", error);
            
            // 隐藏加载指示器并显示占位符
            document.getElementById("loading-indicator").style.display = "none";
            document.getElementById("preview-placeholder").style.display = "flex";
            
            // 显示错误通知
            showNotification(
              "error",
              "Generation Failed",
              error.message || "Failed to generate quiz. Please try again."
            );
          });
        }

        // 显示API生成的问题和答案
        function displayQuizContent(data) {
          const container = document.getElementById("questions-container");
          container.innerHTML = "";
          
          // 创建问题容器
          const questionsDiv = document.createElement("div");
          questionsDiv.className = "generated-questions";
          questionsDiv.innerHTML = data.question;
          
          // 创建答案容器（默认隐藏）
          const answersDiv = document.createElement("div");
          answersDiv.className = "question-answer";
          answersDiv.style.display = "none";
          answersDiv.innerHTML = data.answer;
          
          // 添加到容器
          container.appendChild(questionsDiv);
          container.appendChild(answersDiv);
        }

        function getDifficultyLevel() {
          const sliderValue =
            document.getElementById("difficulty-slider").value;
          if (sliderValue == 1) return "easy";
          if (sliderValue == 2) return "medium";
          return "hard";
        }

        function getSubjectName(subjectValue) {
          const subjectSelect = document.getElementById("subject-select");
          const option = Array.from(subjectSelect.options).find(
            (opt) => opt.value === subjectValue
          );
          return option ? option.textContent : "Subject";
        }

        function generateQuestions(subject, difficulty, count, selectedTypes) {
          const questions = [];
          const availableTemplates = mockQuestionTemplates[subject]
            ? mockQuestionTemplates[subject][difficulty]
            : [];

          // If we don't have templates for this specific subject+difficulty, use general ones
          let templates =
            availableTemplates ||
            mockQuestionTemplates["math-arithmetic"][difficulty] ||
            mockQuestionTemplates["science-general"][difficulty];

          // Filter templates by selected question types
          templates = templates.filter((template) =>
            selectedTypes.includes(template.type)
          );

          // Generate the questions
          for (let i = 0; i < count; i++) {
            // Pick a random template from available ones
            const templateIndex = Math.floor(Math.random() * templates.length);
            const template = templates[templateIndex];

            // Add to questions list with a unique ID
            questions.push({
              id: generateRandomId(),
              ...template,
            });
          }

          return questions;
        }

        function renderQuestions(questions) {
          const container = document.getElementById("questions-container");
          container.innerHTML = "";

          questions.forEach((question, index) => {
            const questionElement = document.createElement("div");
            questionElement.className = "question-item";

            // Create question text
            const questionText = document.createElement("div");
            questionText.className = "question-text";
            questionText.textContent = `${index + 1}. ${question.text}`;

            // Create options if this is a multiple choice question
            let optionsElement = "";
            if (question.type === "multiple_choice" && question.options) {
              optionsElement = document.createElement("div");
              optionsElement.className = "question-options";

              question.options.forEach((option, optIndex) => {
                const optionElement = document.createElement("div");
                optionElement.className = "question-option";

                // Use letters for options (A, B, C, etc.)
                const optionLetter = String.fromCharCode(65 + optIndex);
                optionElement.textContent = `${optionLetter}. ${option}`;

                optionsElement.appendChild(optionElement);
              });
            }

            // Create answer element (hidden by default)
            const answerElement = document.createElement("div");
            answerElement.className = "question-answer";
            answerElement.style.display = "none";

            answerElement.innerHTML = `<strong>Answer:</strong> ${question.answer}`;
            if (question.explanation) {
              answerElement.innerHTML += `<br><strong>Explanation:</strong> ${question.explanation}`;
            }

            // Append all elements
            questionElement.appendChild(questionText);
            if (optionsElement) questionElement.appendChild(optionsElement);
            questionElement.appendChild(answerElement);

            container.appendChild(questionElement);
          });
        }

        // ===== PAYMENT FUNCTIONS =====
        function handleBuyClick(e) {
          const planId = e.target.getAttribute("data-plan");
          currentPlan = mockPlans[planId];

          // Check if user is logged in
          if (!isLoggedIn) {
            // Show login modal
            const authModal = new bootstrap.Modal(
              document.getElementById("authModal")
            );
            authModal.show();

            // Set login tab as active
            document.getElementById("login-tab").click();

            // Show notification
            showNotification(
              "info",
              "Login Required",
              "Please log in before purchasing a plan."
            );
            return;
          }

          // Update payment modal with plan details
          document.getElementById("selected-plan-name").textContent =
            currentPlan.name + " Plan";
          document.getElementById(
            "selected-plan-desc"
          ).textContent = `${currentPlan.generations} generations, all formats, premium features`;
          document.getElementById(
            "selected-plan-price"
          ).textContent = `$${currentPlan.price.toFixed(2)}`;

          // Update features list
          const featuresList = document.getElementById("plan-features");
          featuresList.innerHTML = "";

          // Add generations feature
          const generationsItem = document.createElement("li");
          generationsItem.className =
            "list-group-item d-flex align-items-center";
          generationsItem.innerHTML = `<i class="fas fa-check text-success me-2"></i> ${currentPlan.generations} quiz generations`;
          featuresList.appendChild(generationsItem);

          // Add other features
          currentPlan.features.forEach((feature) => {
            const featureItem = document.createElement("li");
            featureItem.className = "list-group-item d-flex align-items-center";
            featureItem.innerHTML = `<i class="fas fa-check text-success me-2"></i> ${feature}`;
            featuresList.appendChild(featureItem);
          });

          // Show payment modal
          const paymentModal = new bootstrap.Modal(
            document.getElementById("paymentModal")
          );
          paymentModal.show();

          // Reset payment steps to first step
          resetPaymentSteps();
        }

        function resetPaymentSteps() {
          // Reset step indicators
          document
            .querySelectorAll(".payment-step")
            .forEach((step) => step.classList.remove("active", "completed"));
          document.getElementById("step-plan").classList.add("active");

          // Show only the first step content
          document.getElementById("plan-step").style.display = "block";
          document.getElementById("payment-step").style.display = "none";
          document.getElementById("confirm-step").style.display = "none";
        }

        function proceedToPayment() {
          // Update step indicators
          document.getElementById("step-plan").classList.remove("active");
          document.getElementById("step-plan").classList.add("completed");
          document.getElementById("step-payment").classList.add("active");

          // Switch content
          document.getElementById("plan-step").style.display = "none";
          document.getElementById("payment-step").style.display = "block";
        }

        function backToPlan() {
          // Update step indicators
          document.getElementById("step-payment").classList.remove("active");
          document.getElementById("step-plan").classList.remove("completed");
          document.getElementById("step-plan").classList.add("active");

          // Switch content
          document.getElementById("payment-step").style.display = "none";
          document.getElementById("plan-step").style.display = "block";
        }

        function processPayment(e) {
          e.preventDefault();

          // Update step indicators
          document.getElementById("step-payment").classList.remove("active");
          document.getElementById("step-payment").classList.add("completed");
          document.getElementById("step-confirm").classList.add("active");

          // Switch content
          document.getElementById("payment-step").style.display = "none";
          document.getElementById("confirm-step").style.display = "block";

          // Update confirmation details
          document.getElementById("summary-plan").textContent =
            currentPlan.name + " Plan";
          document.getElementById("summary-amount").textContent =
            "$" + currentPlan.price.toFixed(2);
          document.getElementById("summary-date").textContent = formatDate();
          document.getElementById("summary-order-id").textContent =
            "ORD-" + generateRandomId(8);

          // Update user's plan and remaining generations
          currentUser.plan = currentPlan.name.toLowerCase();
          currentUser.totalGenerations = currentPlan.generations;
          currentUser.remainingGenerations = currentPlan.generations;

          // Save to localStorage
          localStorage.setItem("currentUser", JSON.stringify(currentUser));

          // Update UI
          updateUIForLoggedInUser();
        }

        function closeModalAndGoToGenerator() {
          // Close payment modal
          const paymentModal = bootstrap.Modal.getInstance(
            document.getElementById("paymentModal")
          );
          paymentModal.hide();

          // Navigate to generator
          goToGenerator();
        }

        // ===== NAVIGATION FUNCTIONS =====
        function setupRouting() {
          // Set up click handlers for all navigation links
          document.querySelectorAll("a[data-section]").forEach((link) => {
            link.addEventListener("click", function (e) {
              e.preventDefault();
              const section = this.getAttribute("data-section");
              navigateTo(section);
            });
          });

          // Handle "Learn More" button click event
          document.querySelector(".hero-buttons a[href='#how-it-works']").addEventListener("click", function(e) {
            e.preventDefault();
            
            // Hide all sections
            document.querySelectorAll(".content-section").forEach((section) => {
              section.classList.remove("active");
              section.style.display = "none"; // Ensure completely hidden
            });
            
            // Show How It Works section
            const howItWorksSection = document.getElementById("how-it-works-section");
            if (howItWorksSection) {
              howItWorksSection.classList.add("active");
              howItWorksSection.style.display = "block"; // Ensure visible
            }
            
            // Update URL
            window.location.hash = "how-it-works";
            
            // Update active navigation links
            document.querySelectorAll(".nav-link").forEach((link) => {
              link.classList.remove("active");
            });
            const howItWorksLink = document.querySelector(
              '.nav-link[data-section="how-it-works"]'
            );
            if (howItWorksLink) {
              howItWorksLink.classList.add("active");
            }
            
            // Scroll to top
            window.scrollTo(0, 0);
          });

          // Set initial page display
          const initialHash = window.location.hash.substring(1) || "home";
          
          // Hide all sections
          document.querySelectorAll(".content-section").forEach((section) => {
            section.classList.remove("active");
          });
          
          // If initial page is home or pricing, don't show how-it-works section
          if (initialHash === "home" || initialHash === "pricing") {
            // Show requested section
            const targetSection = document.getElementById(`${initialHash}-section`);
            if (targetSection) {
              targetSection.classList.add("active");
            }
            
            // Ensure How It Works is not displayed
            const howItWorksSection = document.getElementById("how-it-works-section");
            if (howItWorksSection) {
              howItWorksSection.classList.remove("active");
            }
          } else {
            // For other pages, display normally
            const targetSection = document.getElementById(`${initialHash}-section`);
            if (targetSection) {
              targetSection.classList.add("active");
            }
          }
          
          // Update active navigation links
          document.querySelectorAll(".nav-link").forEach((link) => {
            link.classList.remove("active");
          });
          const activeLink = document.querySelector(
            `.nav-link[data-section="${initialHash}"]`
          );
          if (activeLink) activeLink.classList.add("active");

          // Update hash-based routing
          window.addEventListener("hashchange", function () {
            const hash = window.location.hash.substring(1) || "home";
            navigateTo(hash);
          });
        }

        function navigateTo(section) {
          // Update URL hash
          window.location.hash = section;

          // Hide all sections
          document.querySelectorAll(".content-section").forEach((section) => {
            section.classList.remove("active");
            section.style.display = "none"; // Ensure completely hidden
          });

          // Check if it's home or pricing page
          if (section === "home" || section === "pricing") {
            // Only show target section
            const targetSection = document.getElementById(`${section}-section`);
            if (targetSection) {
              targetSection.classList.add("active");
              targetSection.style.display = "block"; // Ensure visible
            }
            
            // Ensure How It Works is not displayed
            const howItWorksSection = document.getElementById("how-it-works-section");
            if (howItWorksSection) {
              howItWorksSection.classList.remove("active");
              howItWorksSection.style.display = "none"; // Ensure completely hidden
            }
          } else {
            // For other pages, show target section
            const targetSection = document.getElementById(`${section}-section`);
            if (targetSection) {
              targetSection.classList.add("active");
              targetSection.style.display = "block"; // Ensure visible
            }
          }

          // Scroll to top
          window.scrollTo(0, 0);

          // Update active navigation links
          document.querySelectorAll(".nav-link").forEach((link) => {
            link.classList.remove("active");
          });
          const activeLink = document.querySelector(
            `.nav-link[data-section="${section}"]`
          );
          if (activeLink) activeLink.classList.add("active");
        }

        function goToGenerator() {
          navigateTo("generator");
        }

        function openTermsModal(event) {
          if (event) event.preventDefault();
          const modal = new bootstrap.Modal(document.getElementById("termsModal"));
          modal.show();
        }
        
        function openPrivacyModal(event) {
          if (event) event.preventDefault();
          const modal = new bootstrap.Modal(document.getElementById("privacyModal"));
          modal.show();
        }
        
        function openCookieModal(event) {
          if (event) event.preventDefault();
          const modal = new bootstrap.Modal(document.getElementById("cookieModal"));
          modal.show();
        }

        function handleProfileUpdate(e) {
          e.preventDefault();
          
          // Get form values
          const name = document.getElementById("profile-name").value.trim();
          const email = document.getElementById("profile-email").value.trim();
          
          // Basic validation
          if (!name || !email) {
            showNotification(
              "error",
              "Update Failed",
              "Please fill in all required fields."
            );
            return;
          }
          
          if (!isValidEmail(email)) {
            showNotification(
              "error",
              "Update Failed",
              "Please enter a valid email address."
            );
            return;
          }
          
          // Update user profile
          currentUser.name = name;
          currentUser.email = email;
          
          // Update storage
          if (localStorage.getItem("currentUser")) {
            localStorage.setItem("currentUser", JSON.stringify(currentUser));
          } else if (sessionStorage.getItem("currentUser")) {
            sessionStorage.setItem("currentUser", JSON.stringify(currentUser));
          }
          
          // Update UI
          document.getElementById("navbar-username").textContent = name;
          document.getElementById("sidebar-username").textContent = name;
          
          // Show success notification
          showNotification(
            "success",
            "Profile Updated",
            "Your profile has been successfully updated."
          );
        }
        
        function handlePasswordUpdate(e) {
          e.preventDefault();

          // Get form values
          const currentPassword =
            document.getElementById("current-password").value;
          const newPassword = document.getElementById("new-password").value;
          const confirmPassword =
            document.getElementById("confirm-password").value;

          // Basic validation
          if (md5(currentPassword) !== currentUser.password) {
            showNotification(
              "error",
              "Password Update Failed",
              "Current password is incorrect."
            );
            return;
          }

          if (newPassword !== confirmPassword) {
            showNotification(
              "error",
              "Password Update Failed",
              "New passwords do not match."
            );
            return;
          }
          
          if (newPassword.length < 8) {
            showNotification(
              "error",
              "Password Update Failed",
              "Password must be at least 8 characters long."
            );
            return;
          }

          // Update user password
          currentUser.password = md5(newPassword);
          
          // Update storage
          if (localStorage.getItem("currentUser")) {
            localStorage.setItem("currentUser", JSON.stringify(currentUser));
          } else if (sessionStorage.getItem("currentUser")) {
            sessionStorage.setItem("currentUser", JSON.stringify(currentUser));
          }
          
          // Reset form
          document.getElementById("password-form").reset();
          
          // Show success notification
          showNotification(
            "success",
            "Password Updated",
            "Your password has been successfully updated."
          );
        }
        
        function handlePreferencesUpdate(e) {
          e.preventDefault();
          
          // Get form values
          const theme = document.querySelector('input[name="theme-preference"]:checked').value;
          const notifications = document.getElementById("notification-preference").checked;
          const language = document.getElementById("language-preference").value;
          
          // Update user preferences
          currentUser.preferences = {
            theme,
            notifications,
            language
          };
          
          // Update storage
          if (localStorage.getItem("currentUser")) {
            localStorage.setItem("currentUser", JSON.stringify(currentUser));
          } else if (sessionStorage.getItem("currentUser")) {
            sessionStorage.setItem("currentUser", JSON.stringify(currentUser));
          }
          
          // Apply theme if changed
          if (theme === "dark") {
            document.body.classList.add("dark-theme");
          } else {
            document.body.classList.remove("dark-theme");
          }
          
          // Show success notification
          showNotification(
            "success",
            "Preferences Updated",
            "Your preferences have been successfully updated."
          );
        }

        // 获取测验历史记录
        function fetchQuizHistory(page = 1, pageSize = 10, subject = null, gradeLevel = null) {
          // 保存当前页码
          currentHistoryPage = page;
          
          // 显示加载状态
          const historyList = document.querySelector('.generation-history-list');
          historyList.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-primary" role="status"></div><p class="mt-3">Loading history records...</p></div>';
          
          // 清空分页控件
          document.querySelector('.pagination').innerHTML = '';
          
          // 构建请求参数（改为POST请求体参数）
          const requestData = {
            page: page,
            page_size: pageSize
          };
          
          // 添加可选参数
          if (subject) requestData.subject = subject;
          if (gradeLevel) requestData.grade_level = gradeLevel;
          
          // 获取访问令牌 - 确保从localStorage和sessionStorage都尝试获取
          const accessToken = localStorage.getItem("accessToken") || sessionStorage.getItem("accessToken") || "";
          
          // 检查令牌是否有效并且用户是否登录
          if (!accessToken || !isLoggedIn) {
            showNotification(
              "error",
              "Authentication Failed",
              "No valid login credentials found. Please login again."
            );
            
            // 显示空状态
            historyList.innerHTML = '<div class="text-center py-5"><i class="fas fa-exclamation-circle text-warning mb-3" style="font-size: 2.5rem"></i><p>Not logged in or session expired. Please login to view.</p><button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#authModal">Login</button></div>';
            return;
          }
          
          // 发起请求获取历史记录 - 改为POST方法
          fetch('http://web.practicesnow.com/api/v1/quiz/list', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json',
              'Authorization': `Bearer ${accessToken}`
            },
            body: JSON.stringify(requestData)
          })
          .then(response => {
            console.log("response-history",response);
            // 检查响应状态
            const isSuccess = response.status >= 200 && response.status < 300;
            return response.json().then(data => {
              return { isSuccess, data, status: response.status };
            });
          })
          .then(result => {
            console.log("result-history",result);
            if (result.isSuccess && result.data.ok === 1) {
              // 成功获取数据
              const responseData = result.data.data;
              
              // 保存历史记录数据供本地搜索使用
              allHistoryItems = responseData.items;
              totalHistoryPages = responseData.pages;
              totalHistoryItems = responseData.total;
              
              // 显示历史记录
              renderHistoryItems(responseData.items);
              
              // 显示分页控件
              renderPagination(responseData.page, responseData.pages, responseData.total);
              
              // 如果没有记录，显示空状态
              if (responseData.items.length === 0) {
                historyList.innerHTML = '<div class="text-center py-5"><i class="fas fa-inbox text-muted mb-3" style="font-size: 2.5rem"></i><p>No quiz history records found</p><button class="btn btn-primary" id="create-new-quiz-from-history">Create New Quiz</button></div>';
                
                // 添加创建新测验按钮的事件监听
                document.getElementById('create-new-quiz-from-history').addEventListener('click', goToGenerator);
              }
            } else if (result.status === 401) {
              // 如果是401认证问题，尝试自动刷新登录
              refreshTokenAndRetry(() => fetchQuizHistory(page, pageSize, subject, gradeLevel));
            } else {
              // 处理API错误
              let errorMessage = result.data.message || "Failed to fetch history records";
              
              // 其他错误
              historyList.innerHTML = `<div class="text-center py-5"><i class="fas fa-exclamation-triangle text-danger mb-3" style="font-size: 2.5rem"></i><p>${errorMessage}</p><button class="btn btn-outline-primary" onclick="fetchQuizHistory(1)">Retry</button></div>`;
              
              showNotification(
                "error",
                "Loading Failed",
                errorMessage
              );
            }
          })
          .catch(error => {
            console.error("Failed to fetch quiz history:", error);
            
            // 显示错误状态
            historyList.innerHTML = '<div class="text-center py-5"><i class="fas fa-exclamation-triangle text-danger mb-3" style="font-size: 2.5rem"></i><p>Loading failed. Please check your network connection.</p><button class="btn btn-outline-primary" onclick="fetchQuizHistory(1)">Retry</button></div>';
            
            showNotification(
              "error",
              "Loading Failed",
              "An error occurred while fetching history records. Please try again later."
            );
          });
        }

        // 渲染历史记录列表项
        function renderHistoryItems(items) {
          const historyList = document.querySelector('.generation-history-list');
          historyList.innerHTML = '';
          
          items.forEach(item => {
            // 格式化创建时间
            const createdDate = new Date(item.created_at);
            const formattedDate = formatDate(createdDate);
            
            // 解析问题类型数组
            let questionTypes = [];
            try {
              questionTypes = JSON.parse(item.question_types);
            } catch (e) {
              console.error("Error parsing question types:", e);
            }
            
            // 创建历史记录项 HTML
            const historyItemHtml = `
              <div class="generation-history-item" data-quiz-id="${item.id}">
                <div class="generation-history-header">
                  <h5 class="generation-history-title">
                    ${item.grade_level} ${item.subject} ${item.make_comprehensive_test ? 'Comprehensive Test' : 'Quiz'}
                  </h5>
                  <div class="generation-history-date">
                    ${formattedDate}
                  </div>
                </div>
                <div class="generation-history-meta">
                  <span class="generation-history-tag">${item.grade_level}</span>
                  <span class="generation-history-tag">${item.subject}</span>
                  <span class="generation-history-tag">${item.number_of_questions} ${item.number_of_questions > 1 ? 'Questions' : 'Question'}</span>
                  <span class="generation-history-tag">${item.difficulty_level.charAt(0).toUpperCase() + item.difficulty_level.slice(1)}</span>
                  ${item.make_comprehensive_test ? '<span class="generation-history-tag bg-warning">Comprehensive</span>' : ''}
                </div>
                <div class="generation-history-preview">
                  ${extractPreview(item.question, 150)}
                </div>
                <div class="d-flex justify-content-end">
                  <button class="btn btn-sm btn-outline-primary me-2 view-quiz-btn" data-quiz-id="${item.id}">
                    <i class="fas fa-eye me-1"></i> View
                  </button>
                  <button class="btn btn-sm btn-outline-secondary me-2 toggle-favorite-btn" data-quiz-id="${item.id}" data-is-favorite="${item.is_favorite}">
                    <i class="fas ${item.is_favorite ? 'fa-star' : 'fa-star-o'} me-1"></i> ${item.is_favorite ? 'Unfavorite' : 'Favorite'}
                  </button>
                  <button class="btn btn-sm btn-outline-danger delete-quiz-btn" data-quiz-id="${item.id}">
                    <i class="fas fa-trash me-1"></i> Delete
                  </button>
                </div>
              </div>
            `;
            
            historyList.innerHTML += historyItemHtml;
          });
          
          // 添加事件监听器
          document.querySelectorAll('.view-quiz-btn').forEach(btn => {
            btn.addEventListener('click', function() {
              const quizId = this.getAttribute('data-quiz-id');
              viewQuiz(quizId);
            });
          });
          
          document.querySelectorAll('.toggle-favorite-btn').forEach(btn => {
            btn.addEventListener('click', function() {
              const quizId = this.getAttribute('data-quiz-id');
              const isFavorite = this.getAttribute('data-is-favorite') === 'true';
              toggleFavorite(quizId, !isFavorite);
            });
          });
          
          document.querySelectorAll('.delete-quiz-btn').forEach(btn => {
            btn.addEventListener('click', function() {
              const quizId = this.getAttribute('data-quiz-id');
              confirmDeleteQuiz(quizId);
            });
          });
        }

        // 提取问题预览（截取前N个字符）
        function extractPreview(htmlContent, maxLength = 150) {
          // 创建临时元素解析HTML
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = htmlContent;
          
          // 获取纯文本内容
          const textContent = tempDiv.textContent || tempDiv.innerText || '';
          
          // 截取前N个字符
          let preview = textContent.trim().substring(0, maxLength);
          
          // 如果原文更长，添加省略号
          if (textContent.length > maxLength) {
            preview += '...';
          }
          
          return preview;
        }

        // 渲染分页控件
        function renderPagination(currentPage, totalPages, totalItems) {
          const paginationElement = document.querySelector('.pagination');
          
          if (!paginationElement) return;
          
          // 清空分页控件
          paginationElement.innerHTML = '';
          
          // 显示总条数 - 只显示一次
          const listInfoElement = document.createElement('div');
          listInfoElement.className = 'pagination-info text-secondary mb-2 text-center';
          listInfoElement.textContent = `Total ${totalItems} records, ${totalPages} pages`;
          
          // 先移除所有可能存在的旧信息元素
          const oldInfoElements = document.querySelectorAll('.pagination-info');
          oldInfoElements.forEach(element => element.remove());
          
          // 添加新的信息元素
          paginationElement.parentNode.insertBefore(listInfoElement, paginationElement);
          
          // 上一页按钮
          const prevItem = document.createElement('li');
          prevItem.className = `page-item ${currentPage <= 1 ? 'disabled' : ''}`;
          
          const prevLink = document.createElement('a');
          prevLink.className = 'page-link';
          prevLink.href = '#';
          prevLink.textContent = 'Previous';
          prevLink.setAttribute('aria-label', 'Previous');
          
          if (currentPage > 1) {
            prevLink.addEventListener('click', function(e) {
              e.preventDefault();
              fetchQuizHistory(currentPage - 1);
            });
          }
          
          prevItem.appendChild(prevLink);
          paginationElement.appendChild(prevItem);
          
          // 页码按钮
          const maxButtons = 5; // 最多显示5个页码按钮
          let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
          let endPage = Math.min(totalPages, startPage + maxButtons - 1);
          
          // 调整startPage，确保显示足够的页码按钮
          if (endPage - startPage + 1 < maxButtons && startPage > 1) {
            startPage = Math.max(1, endPage - maxButtons + 1);
          }
          
          // 添加第一页按钮（如果不在可见范围内）
          if (startPage > 1) {
            const firstItem = document.createElement('li');
            firstItem.className = 'page-item';
            
            const firstLink = document.createElement('a');
            firstLink.className = 'page-link';
            firstLink.href = '#';
            firstLink.textContent = '1';
            
            firstLink.addEventListener('click', function(e) {
              e.preventDefault();
              fetchQuizHistory(1);
            });
            
            firstItem.appendChild(firstLink);
            paginationElement.appendChild(firstItem);
            
            // 添加省略号（如果不是紧挨着第一页）
            if (startPage > 2) {
              const ellipsisItem = document.createElement('li');
              ellipsisItem.className = 'page-item disabled';
              
              const ellipsisLink = document.createElement('a');
              ellipsisLink.className = 'page-link';
              ellipsisLink.textContent = '...';
              
              ellipsisItem.appendChild(ellipsisLink);
              paginationElement.appendChild(ellipsisItem);
            }
          }
          
          // 添加中间的页码按钮
          for (let i = startPage; i <= endPage; i++) {
            const pageItem = document.createElement('li');
            pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
            
            const pageLink = document.createElement('a');
            pageLink.className = 'page-link';
            pageLink.href = '#';
            pageLink.textContent = i;
            
            if (i !== currentPage) {
              pageLink.addEventListener('click', function(e) {
                e.preventDefault();
                fetchQuizHistory(i);
              });
            }
            
            pageItem.appendChild(pageLink);
            paginationElement.appendChild(pageItem);
          }
          
          // 添加最后一页按钮（如果不在可见范围内）
          if (endPage < totalPages) {
            // 添加省略号（如果不是紧挨着最后一页）
            if (endPage < totalPages - 1) {
              const ellipsisItem = document.createElement('li');
              ellipsisItem.className = 'page-item disabled';
              
              const ellipsisLink = document.createElement('a');
              ellipsisLink.className = 'page-link';
              ellipsisLink.textContent = '...';
              
              ellipsisItem.appendChild(ellipsisLink);
              paginationElement.appendChild(ellipsisItem);
            }
            
            const lastItem = document.createElement('li');
            lastItem.className = 'page-item';
            
            const lastLink = document.createElement('a');
            lastLink.className = 'page-link';
            lastLink.href = '#';
            lastLink.textContent = totalPages;
            
            lastLink.addEventListener('click', function(e) {
              e.preventDefault();
              fetchQuizHistory(totalPages);
            });
            
            lastItem.appendChild(lastLink);
            paginationElement.appendChild(lastItem);
          }
          
          // 下一页按钮
          const nextItem = document.createElement('li');
          nextItem.className = `page-item ${currentPage >= totalPages ? 'disabled' : ''}`;
          
          const nextLink = document.createElement('a');
          nextLink.className = 'page-link';
          nextLink.href = '#';
          nextLink.textContent = 'Next';
          nextLink.setAttribute('aria-label', 'Next');
          
          if (currentPage < totalPages) {
            nextLink.addEventListener('click', function(e) {
              e.preventDefault();
              fetchQuizHistory(currentPage + 1);
            });
          }
          
          nextItem.appendChild(nextLink);
          paginationElement.appendChild(nextItem);
        }

        // 查看测验详情
        function viewQuiz(quizId) {
          // 获取访问令牌
          const accessToken = localStorage.getItem("accessToken") || sessionStorage.getItem("accessToken") || "";
          
          // 显示加载中状态
          showNotification(
            "info",
            "Loading",
            "Loading quiz details..."
          );
          
          // 调用API获取测验详情
          fetch(`http://web.practicesnow.com/api/v1/quiz/${quizId}`, {
            method: 'GET',
            headers: {
              'Accept': 'application/json',
              'Authorization': `Bearer ${accessToken}`
            }
          })
          .then(response => {
            const isSuccess = response.status >= 200 && response.status < 300;
            return response.json().then(data => {
              return { isSuccess, data, status: response.status };
            });
          })
          .then(result => {
            if (result.isSuccess && result.data.ok === 1) {
              // 成功获取数据
              const quizData = result.data.data;
              
              // 导航到生成器页面
              navigateTo("generator");
              
              // 显示测验内容
              displayHistoryQuiz(quizData);
            } else {
              // 处理API错误
              throw new Error(result.data.message || "Failed to fetch quiz details");
            }
          })
          .catch(error => {
            console.error("Failed to fetch quiz details:", error);
            
            showNotification(
              "error",
              "Loading Failed",
              error.message || "An error occurred while loading quiz details. Please try again later."
            );
          });
        }

        // 显示历史测验内容
        function displayHistoryQuiz(quizData) {
          // 更新预览标题
          document.getElementById("preview-title").textContent = 
            `${quizData.grade_level} ${quizData.subject} ${quizData.make_comprehensive_test ? 'Comprehensive Test' : 'Quiz'}`;
          
          // 更新日期
          const createdDate = new Date(quizData.created_at);
          document.getElementById("preview-date").textContent = formatDate(createdDate);
          
          // 创建问题和答案容器
          const container = document.getElementById("questions-container");
          container.innerHTML = "";
          
          // 创建问题容器
          const questionsDiv = document.createElement("div");
          questionsDiv.className = "generated-questions";
          questionsDiv.innerHTML = quizData.question;
          
          // 创建答案容器（默认隐藏）
          const answersDiv = document.createElement("div");
          answersDiv.className = "question-answer";
          answersDiv.style.display = "none";
          answersDiv.innerHTML = quizData.answer;
          
          // 添加到容器
          container.appendChild(questionsDiv);
          container.appendChild(answersDiv);
          
          // 隐藏占位符和加载指示器，显示内容
          document.getElementById("preview-placeholder").style.display = "none";
          document.getElementById("loading-indicator").style.display = "none";
          document.getElementById("preview-content").style.display = "block";
          
          // 重置答案显示状态
          showingAnswers = false;
          document.getElementById("toggle-answers").innerHTML =
            '<i class="fas fa-eye me-1"></i> Show Answers';
        }

        // 收藏/取消收藏测验
        function toggleFavorite(quizId, makeFavorite) {
          // 获取访问令牌
          const accessToken = localStorage.getItem("accessToken") || sessionStorage.getItem("accessToken") || "";
          
          // 准备请求体数据
          const requestBody = {
            quiz_id: quizId,
            is_favorite: makeFavorite
          };
          
          // 显示加载中状态
          const button = document.querySelector(`.toggle-favorite-btn[data-quiz-id="${quizId}"]`);
          if (button) {
            const originalText = button.innerHTML;
            button.disabled = true;
            button.innerHTML = '<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span> Loading...';
          }
          
          // 调用API
          fetch('http://web.practicesnow.com/api/v1/quiz/favorite', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json',
              'Authorization': `Bearer ${accessToken}`
            },
            body: JSON.stringify(requestBody)
          })
          .then(response => {
            const isSuccess = response.status >= 200 && response.status < 300;
            return response.json().then(data => {
              return { isSuccess, data, status: response.status };
            });
          })
          .then(result => {
            if (result.isSuccess && result.data.ok === 1) {
              // 更新按钮状态
              if (button) {
                button.disabled = false;
                button.setAttribute('data-is-favorite', makeFavorite);
                button.innerHTML = `<i class="fas ${makeFavorite ? 'fa-star' : 'fa-star-o'} me-1"></i> ${makeFavorite ? 'Unfavorite' : 'Favorite'}`;
              }
              
              // 更新本地数据中的收藏状态
              const itemIndex = allHistoryItems.findIndex(item => item.id == quizId);
              if (itemIndex !== -1) {
                allHistoryItems[itemIndex].is_favorite = makeFavorite;
              }
              
              showNotification(
                "success",
                makeFavorite ? "Added to Favorites" : "Removed from Favorites",
                makeFavorite ? "Quiz has been added to favorites" : "Quiz has been removed from favorites"
              );
            } else {
              // 恢复按钮状态
              if (button) {
                button.disabled = false;
                button.innerHTML = `<i class="fas ${!makeFavorite ? 'fa-star' : 'fa-star-o'} me-1"></i> ${!makeFavorite ? 'Unfavorite' : 'Favorite'}`;
              }
              
              throw new Error(result.data.message || (makeFavorite ? "Failed to add to favorites" : "Failed to remove from favorites"));
            }
          })
          .catch(error => {
            console.error(`Failed to ${makeFavorite ? 'favorite' : 'unfavorite'} quiz:`, error);
            
            // 恢复按钮状态
            if (button) {
              button.disabled = false;
              button.innerHTML = `<i class="fas ${!makeFavorite ? 'fa-star' : 'fa-star-o'} me-1"></i> ${!makeFavorite ? 'Unfavorite' : 'Favorite'}`;
            }
            
            showNotification(
              "error",
              makeFavorite ? "Favorite Failed" : "Unfavorite Failed",
              error.message || "Operation failed. Please try again later."
            );
          });
        }

        // 确认删除测验
        function confirmDeleteQuiz(quizId) {
          // 使用Bootstrap模态框替代原生confirm
          const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
          
          // 设置确认删除按钮的点击事件
          const confirmDeleteButton = document.getElementById('confirmDeleteButton');
          
          // 移除之前可能存在的事件监听器
          const newConfirmDeleteButton = confirmDeleteButton.cloneNode(true);
          confirmDeleteButton.parentNode.replaceChild(newConfirmDeleteButton, confirmDeleteButton);
          
          // 添加新的事件监听器
          newConfirmDeleteButton.addEventListener('click', function() {
            // 隐藏模态框
            deleteModal.hide();
            // 执行删除操作
            deleteQuiz(quizId);
          });
          
          // 显示模态框
          deleteModal.show();
        }

        // 删除测验
        function deleteQuiz(quizId) {
          // 获取访问令牌
          const accessToken = localStorage.getItem("accessToken") || sessionStorage.getItem("accessToken") || "";
          
          // 显示删除中状态
          const quizElement = document.querySelector(`.generation-history-item[data-quiz-id="${quizId}"]`);
          if (quizElement) {
            // 禁用删除按钮，显示加载状态
            const deleteButton = quizElement.querySelector('.delete-quiz-btn');
            if (deleteButton) {
              deleteButton.disabled = true;
              deleteButton.innerHTML = '<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span> Deleting...';
            }
          }
          
          // 准备请求体
          const requestData = {
            quiz_id: quizId
          };
          
          // 调用API - 使用POST方法和新接口
          fetch('http://web.practicesnow.com/api/v1/quiz/delete', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json',
              'Authorization': `Bearer ${accessToken}`
            },
            body: JSON.stringify(requestData)
          })
          .then(response => {
            const isSuccess = response.status >= 200 && response.status < 300;
            return response.json().then(data => {
              return { isSuccess, data, status: response.status };
            });
          })
          .then(result => {
            if (result.isSuccess && result.data.ok === 1) {
              // 从列表中移除测验
              if (quizElement) {
                quizElement.remove();
              }
              
              // 如果列表为空，显示空状态
              const historyList = document.querySelector('.generation-history-list');
              if (historyList && historyList.children.length === 0) {
                historyList.innerHTML = '<div class="text-center py-5"><i class="fas fa-inbox text-muted mb-3" style="font-size: 2.5rem"></i><p>No quiz history records</p><button class="btn btn-primary" id="create-new-quiz-from-history">Create New Quiz</button></div>';
                
                // 添加创建新测验按钮的事件监听
                document.getElementById('create-new-quiz-from-history').addEventListener('click', goToGenerator);
              }
              
              // 同样检查收藏列表中是否有该测验，如果有也移除
              const favoriteQuizElement = document.querySelector(`.favorites-list .generation-history-item[data-quiz-id="${quizId}"]`);
              if (favoriteQuizElement) {
                favoriteQuizElement.remove();
                
                // 如果收藏列表为空，显示空状态
                const favoritesList = document.querySelector('.favorites-list');
                if (favoritesList && favoritesList.children.length === 0) {
                  favoritesList.innerHTML = '<div class="text-center py-5"><i class="fas fa-heart text-muted mb-3" style="font-size: 2.5rem"></i><p>No favorite quizzes found</p><button class="btn btn-primary" id="go-to-history">Browse History</button></div>';
                  
                  // 添加浏览历史记录按钮的事件监听
                  document.getElementById('go-to-history').addEventListener('click', function() {
                    document.querySelector('.nav-link[data-tab="generation-history"]').click();
                  });
                }
              }
              
              // 从allHistoryItems和allFavoriteItems中移除该测验
              const historyIndex = allHistoryItems.findIndex(item => item.id == quizId);
              if (historyIndex !== -1) {
                allHistoryItems.splice(historyIndex, 1);
              }
              
              const favoriteIndex = allFavoriteItems.findIndex(item => item.id == quizId);
              if (favoriteIndex !== -1) {
                allFavoriteItems.splice(favoriteIndex, 1);
              }
              
              showNotification(
                "success",
                "Delete Successful",
                "Quiz has been successfully deleted"
              );
            } else {
              // 恢复删除按钮状态
              if (quizElement) {
                const deleteButton = quizElement.querySelector('.delete-quiz-btn');
                if (deleteButton) {
                  deleteButton.disabled = false;
                  deleteButton.innerHTML = '<i class="fas fa-trash me-1"></i> Delete';
                }
              }
              
              throw new Error(result.data.message || "Failed to delete quiz");
            }
          })
          .catch(error => {
            console.error("Failed to delete quiz:", error);
            
            // 恢复删除按钮状态
            if (quizElement) {
              const deleteButton = quizElement.querySelector('.delete-quiz-btn');
              if (deleteButton) {
                deleteButton.disabled = false;
                deleteButton.innerHTML = '<i class="fas fa-trash me-1"></i> Delete';
              }
            }
            
            showNotification(
              "error",
              "Delete Failed",
              error.message || "An error occurred while deleting quiz. Please try again later."
            );
          });
        }

        // 添加搜索功能
        document.addEventListener('DOMContentLoaded', function() {
          const historySearchInput = document.getElementById('history-search');
          if (historySearchInput) {
            // 使用防抖函数减少频繁搜索
            let searchTimeout;
            historySearchInput.addEventListener('input', function() {
              clearTimeout(searchTimeout);
              searchTimeout = setTimeout(() => {
                const searchTerm = this.value.trim().toLowerCase();
                
                // 如果搜索词太短，不执行搜索
                if (searchTerm.length < 2 && searchTerm.length > 0) return;
                
                // 当输入为空时，恢复显示所有记录
                if (searchTerm.length === 0) {
                  // 使用原始数据恢复显示
                  renderHistoryItems(allHistoryItems);
                  renderPagination(currentHistoryPage, totalHistoryPages, totalHistoryItems);
                  return;
                }
                
                // 根据输入内容在本地进行模糊搜索
                if (searchTerm.length >= 2) {
                  // 在本地进行搜索匹配
                  const filteredItems = allHistoryItems.filter(item => {
                    // 在多个字段中搜索匹配项
                    return (
                      (item.subject && item.subject.toLowerCase().includes(searchTerm)) ||
                      (item.grade_level && item.grade_level.toLowerCase().includes(searchTerm)) ||
                      (item.difficulty_level && item.difficulty_level.toLowerCase().includes(searchTerm)) ||
                      (item.question && item.question.toLowerCase().includes(searchTerm))
                    );
                  });
                  
                  // 显示筛选后的结果
                  renderHistoryItems(filteredItems);
                  
                  // 更新分页信息
                  const tempPagination = document.querySelector('.pagination');
                  if (tempPagination) {
                    // 更新信息显示
                    const listInfoElement = document.createElement('div');
                    listInfoElement.className = 'pagination-info text-secondary mb-2 text-center';
                    
                    // 先移除所有可能存在的旧信息元素
                    const oldInfoElements = document.querySelectorAll('.pagination-info');
                    oldInfoElements.forEach(element => element.remove());
                    
                    // 如果有搜索结果，显示数量信息
                    if (filteredItems.length > 0) {
                      listInfoElement.textContent = `Found ${filteredItems.length} matching records`;
                      tempPagination.parentNode.insertBefore(listInfoElement, tempPagination);
                      
                      // 在搜索模式下隐藏分页控件
                      tempPagination.innerHTML = '';
                    } else {
                      // 如果没有搜索结果
                      const historyList = document.querySelector('.generation-history-list');
                      historyList.innerHTML = '<div class="text-center py-5"><i class="fas fa-search text-muted mb-3" style="font-size: 2.5rem"></i><p>No matching records found</p><button class="btn btn-outline-primary" id="clear-search">Clear Search</button></div>';
                      
                      // 添加清除搜索按钮事件
                      document.getElementById('clear-search').addEventListener('click', function() {
                        historySearchInput.value = '';
                        // 恢复原始数据显示
                        renderHistoryItems(allHistoryItems);
                        renderPagination(currentHistoryPage, totalHistoryPages, totalHistoryItems);
                      });
                      
                      // 隐藏分页控件
                      tempPagination.innerHTML = '';
                    }
                  }
                }
              }, 500); // 500ms防抖延迟
            });
          }
        });

        // 获取收藏列表
        function fetchFavorites(page = 1, pageSize = 10, searchTerm = null) {
          // 保存当前页码
          currentFavoritePage = page;
          
          // 显示加载状态
          const favoritesList = document.querySelector('.favorites-list');
          favoritesList.innerHTML = '<div class="text-center py-5"><div class="spinner-border text-primary" role="status"></div><p class="mt-3">Loading favorites...</p></div>';
          
          // 清空分页控件
          document.querySelector('.favorites-pagination').innerHTML = '';
          
          // 构建请求参数
          const requestData = {
            page: page,
            page_size: pageSize
          };
          
          // 添加搜索参数（如果有）
          if (searchTerm) requestData.search = searchTerm;
          
          // 删除筛选参数
          
          // 获取访问令牌
          const accessToken = localStorage.getItem("accessToken") || sessionStorage.getItem("accessToken") || "";
          
          // 检查令牌是否有效并且用户是否登录
          if (!accessToken || !isLoggedIn) {
            showNotification(
              "error",
              "Authentication Failed",
              "No valid login credentials found. Please login again."
            );
            
            // 显示空状态
            favoritesList.innerHTML = '<div class="text-center py-5"><i class="fas fa-exclamation-circle text-warning mb-3" style="font-size: 2.5rem"></i><p>Not logged in or session expired. Please login to view.</p><button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#authModal">Login</button></div>';
            return;
          }
          
          // 发起请求获取收藏列表 - 使用favorite-list接口
          fetch('http://web.practicesnow.com/api/v1/quiz/favorite-list', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json',
              'Authorization': `Bearer ${accessToken}`
            },
            body: JSON.stringify(requestData)
          })
          .then(response => {
            console.log("response-favorites", response);
            // 检查响应状态
            const isSuccess = response.status >= 200 && response.status < 300;
            return response.json().then(data => {
              return { isSuccess, data, status: response.status };
            });
          })
          .then(result => {
            console.log("result-favorites", result);
            if (result.isSuccess && result.data.ok === 1) {
              // 成功获取数据
              const responseData = result.data.data;
              
              // 保存收藏数据供本地搜索使用
              allFavoriteItems = responseData.items;
              totalFavoritePages = responseData.pages;
              totalFavoriteItems = responseData.total;
              
              // 显示收藏列表
              renderFavoriteItems(responseData.items);
              
              // 显示分页控件
              renderFavoritePagination(responseData.page, responseData.pages, responseData.total);
              
              // 如果没有收藏记录，显示空状态
              if (responseData.items.length === 0) {
                favoritesList.innerHTML = '<div class="text-center py-5"><i class="fas fa-heart text-muted mb-3" style="font-size: 2.5rem"></i><p>No favorite quizzes found</p><button class="btn btn-primary" id="go-to-history">Browse History</button></div>';
                
                // 添加浏览历史记录按钮的事件监听
                document.getElementById('go-to-history').addEventListener('click', function() {
                  // 切换到历史记录标签
                  document.querySelector('.nav-link[data-tab="generation-history"]').click();
                });
              }
            } else if (result.status === 401) {
              // 如果是401认证问题，尝试自动刷新登录
              refreshTokenAndRetry(() => fetchFavorites(page, pageSize, searchTerm));
            } else {
              // 处理API错误
              let errorMessage = result.data.message || "Failed to fetch favorites";
              
              // 其他错误
              favoritesList.innerHTML = `<div class="text-center py-5"><i class="fas fa-exclamation-triangle text-danger mb-3" style="font-size: 2.5rem"></i><p>${errorMessage}</p><button class="btn btn-outline-primary" onclick="fetchFavorites(1)">Retry</button></div>`;
              
              showNotification(
                "error",
                "Loading Failed",
                errorMessage
              );
            }
          })
          .catch(error => {
            console.error("Failed to fetch favorites:", error);
            
            // 显示错误状态
            favoritesList.innerHTML = '<div class="text-center py-5"><i class="fas fa-exclamation-triangle text-danger mb-3" style="font-size: 2.5rem"></i><p>Loading failed. Please check your network connection.</p><button class="btn btn-outline-primary" onclick="fetchFavorites(1)">Retry</button></div>';
            
            showNotification(
              "error",
              "Loading Failed",
              "An error occurred while fetching favorites. Please try again later."
            );
          });
        }

        // 渲染收藏列表项
        function renderFavoriteItems(items) {
          const favoritesList = document.querySelector('.favorites-list');
          favoritesList.innerHTML = '';
          
          items.forEach(item => {
            // 格式化创建时间
            const createdDate = new Date(item.created_at);
            const formattedDate = formatDate(createdDate);
            
            // 解析问题类型数组
            let questionTypes = [];
            try {
              questionTypes = JSON.parse(item.question_types);
            } catch (e) {
              console.error("Error parsing question types:", e);
            }
            
            // 创建收藏项 HTML
            const favoriteItemHtml = `
              <div class="generation-history-item" data-quiz-id="${item.id}">
                <div class="generation-history-header">
                  <h5 class="generation-history-title">
                    ${item.grade_level} ${item.subject} ${item.make_comprehensive_test ? 'Comprehensive Test' : 'Quiz'}
                  </h5>
                  <div class="generation-history-date">
                    ${formattedDate}
                  </div>
                </div>
                <div class="generation-history-meta">
                  <span class="generation-history-tag">${item.grade_level}</span>
                  <span class="generation-history-tag">${item.subject}</span>
                  <span class="generation-history-tag">${item.number_of_questions} ${item.number_of_questions > 1 ? 'Questions' : 'Question'}</span>
                  <span class="generation-history-tag">${item.difficulty_level.charAt(0).toUpperCase() + item.difficulty_level.slice(1)}</span>
                  ${item.make_comprehensive_test ? '<span class="generation-history-tag bg-warning">Comprehensive</span>' : ''}
                </div>
                <div class="generation-history-preview">
                  ${extractPreview(item.question, 150)}
                </div>
                <div class="d-flex justify-content-end">
                  <button class="btn btn-sm btn-outline-primary me-2 view-quiz-btn" data-quiz-id="${item.id}">
                    <i class="fas fa-eye me-1"></i> View
                  </button>
                  <button class="btn btn-sm btn-outline-danger unfavorite-btn" data-quiz-id="${item.id}">
                    <i class="fas fa-star me-1"></i> Remove
                  </button>
                </div>
              </div>
            `;
            
            favoritesList.innerHTML += favoriteItemHtml;
          });
          
          // 添加事件监听器
          document.querySelectorAll('.favorites-list .view-quiz-btn').forEach(btn => {
            btn.addEventListener('click', function() {
              const quizId = this.getAttribute('data-quiz-id');
              viewQuiz(quizId);
            });
          });
          
          document.querySelectorAll('.favorites-list .unfavorite-btn').forEach(btn => {
            btn.addEventListener('click', function() {
              const quizId = this.getAttribute('data-quiz-id');
              toggleFavorite(quizId, false);
              
              // 移除该项从收藏列表
              this.closest('.generation-history-item').remove();
              
              // 检查是否收藏列表为空
              if (document.querySelector('.favorites-list').children.length === 0) {
                document.querySelector('.favorites-list').innerHTML = '<div class="text-center py-5"><i class="fas fa-heart text-muted mb-3" style="font-size: 2.5rem"></i><p>No favorite quizzes found</p><button class="btn btn-primary" id="go-to-history">Browse History</button></div>';
                
                // 添加浏览历史记录按钮的事件监听
                document.getElementById('go-to-history').addEventListener('click', function() {
                  document.querySelector('.nav-link[data-tab="generation-history"]').click();
                });
              }
            });
          });
        }

        // 渲染收藏分页控件
        function renderFavoritePagination(currentPage, totalPages, totalItems) {
          const paginationElement = document.querySelector('.favorites-pagination');
          
          if (!paginationElement) return;
          
          // 清空分页控件
          paginationElement.innerHTML = '';
          
          // 删除显示总条数的代码
          // 移除所有可能存在的旧信息元素
          const oldInfoElements = document.querySelectorAll('.pagination-info');
          oldInfoElements.forEach(element => element.remove());
          
          // 上一页按钮
          const prevItem = document.createElement('li');
          prevItem.className = `page-item ${currentPage <= 1 ? 'disabled' : ''}`;
          
          const prevLink = document.createElement('a');
          prevLink.className = 'page-link';
          prevLink.href = '#';
          prevLink.textContent = 'Previous';
          prevLink.setAttribute('aria-label', 'Previous');
          
          if (currentPage > 1) {
            prevLink.addEventListener('click', function(e) {
              e.preventDefault();
              fetchFavorites(currentPage - 1);
            });
          }
          
          prevItem.appendChild(prevLink);
          paginationElement.appendChild(prevItem);
          
          // 页码按钮
          const maxButtons = 5; // 最多显示5个页码按钮
          let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
          let endPage = Math.min(totalPages, startPage + maxButtons - 1);
          
          // 调整startPage，确保显示足够的页码按钮
          if (endPage - startPage + 1 < maxButtons && startPage > 1) {
            startPage = Math.max(1, endPage - maxButtons + 1);
          }
          
          // 添加第一页按钮（如果不在可见范围内）
          if (startPage > 1) {
            const firstItem = document.createElement('li');
            firstItem.className = 'page-item';
            
            const firstLink = document.createElement('a');
            firstLink.className = 'page-link';
            firstLink.href = '#';
            firstLink.textContent = '1';
            
            firstLink.addEventListener('click', function(e) {
              e.preventDefault();
              fetchFavorites(1);
            });
            
            firstItem.appendChild(firstLink);
            paginationElement.appendChild(firstItem);
            
            // 添加省略号（如果不是紧挨着第一页）
            if (startPage > 2) {
              const ellipsisItem = document.createElement('li');
              ellipsisItem.className = 'page-item disabled';
              
              const ellipsisLink = document.createElement('a');
              ellipsisLink.className = 'page-link';
              ellipsisLink.textContent = '...';
              
              ellipsisItem.appendChild(ellipsisLink);
              paginationElement.appendChild(ellipsisItem);
            }
          }
          
          // 添加中间的页码按钮
          for (let i = startPage; i <= endPage; i++) {
            const pageItem = document.createElement('li');
            pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
            
            const pageLink = document.createElement('a');
            pageLink.className = 'page-link';
            pageLink.href = '#';
            pageLink.textContent = i;
            
            if (i !== currentPage) {
              pageLink.addEventListener('click', function(e) {
                e.preventDefault();
                fetchFavorites(i);
              });
            }
            
            pageItem.appendChild(pageLink);
            paginationElement.appendChild(pageItem);
          }
          
          // 添加最后一页按钮（如果不在可见范围内）
          if (endPage < totalPages) {
            // 添加省略号（如果不是紧挨着最后一页）
            if (endPage < totalPages - 1) {
              const ellipsisItem = document.createElement('li');
              ellipsisItem.className = 'page-item disabled';
              
              const ellipsisLink = document.createElement('a');
              ellipsisLink.className = 'page-link';
              ellipsisLink.textContent = '...';
              
              ellipsisItem.appendChild(ellipsisLink);
              paginationElement.appendChild(ellipsisItem);
            }
            
            const lastItem = document.createElement('li');
            lastItem.className = 'page-item';
            
            const lastLink = document.createElement('a');
            lastLink.className = 'page-link';
            lastLink.href = '#';
            lastLink.textContent = totalPages;
            
            lastLink.addEventListener('click', function(e) {
              e.preventDefault();
              fetchFavorites(totalPages);
            });
            
            lastItem.appendChild(lastLink);
            paginationElement.appendChild(lastItem);
          }
          
          // 下一页按钮
          const nextItem = document.createElement('li');
          nextItem.className = `page-item ${currentPage >= totalPages ? 'disabled' : ''}`;
          
          const nextLink = document.createElement('a');
          nextLink.className = 'page-link';
          nextLink.href = '#';
          nextLink.textContent = 'Next';
          nextLink.setAttribute('aria-label', 'Next');
          
          if (currentPage < totalPages) {
            nextLink.addEventListener('click', function(e) {
              e.preventDefault();
              fetchFavorites(currentPage + 1);
            });
          }
          
          nextItem.appendChild(nextLink);
          paginationElement.appendChild(nextItem);
        }

        // 添加收藏搜索功能
        document.addEventListener('DOMContentLoaded', function() {
          // 已有的历史记录搜索功能...
          
          // 删除筛选按钮事件监听
          
          // 收藏搜索功能
          const favoritesSearchInput = document.getElementById('favorites-search');
          if (favoritesSearchInput) {
            // 使用防抖函数减少频繁搜索
            let searchTimeout;
            favoritesSearchInput.addEventListener('input', function() {
              clearTimeout(searchTimeout);
              searchTimeout = setTimeout(() => {
                const searchTerm = this.value.trim().toLowerCase();
                
                // 如果搜索词太短，不执行搜索
                if (searchTerm.length < 2 && searchTerm.length > 0) return;
                
                // 当输入为空时，恢复显示所有记录
                if (searchTerm.length === 0) {
                  // 使用原始数据恢复显示
                  renderFavoriteItems(allFavoriteItems);
                  renderFavoritePagination(currentFavoritePage, totalFavoritePages, totalFavoriteItems);
                  return;
                }
                
                // 根据输入内容在本地进行模糊搜索
                if (searchTerm.length >= 2) {
                  // 在本地进行搜索匹配
                  const filteredItems = allFavoriteItems.filter(item => {
                    // 在多个字段中搜索匹配项
                    return (
                      (item.subject && item.subject.toLowerCase().includes(searchTerm)) ||
                      (item.grade_level && item.grade_level.toLowerCase().includes(searchTerm)) ||
                      (item.difficulty_level && item.difficulty_level.toLowerCase().includes(searchTerm)) ||
                      (item.question && item.question.toLowerCase().includes(searchTerm))
                    );
                  });
                  
                  // 显示筛选后的结果
                  renderFavoriteItems(filteredItems);
                  
                  // 更新分页信息
                  const tempPagination = document.querySelector('.favorites-pagination');
                  if (tempPagination) {
                    // 移除所有信息元素
                    const oldInfoElements = document.querySelectorAll('.pagination-info');
                    oldInfoElements.forEach(element => element.remove());
                    
                    // 如果有搜索结果，不显示数量信息
                    if (filteredItems.length > 0) {
                      // 在搜索模式下隐藏分页控件
                      tempPagination.innerHTML = '';
                    } else {
                      // 如果没有搜索结果
                      const favoritesList = document.querySelector('.favorites-list');
                      favoritesList.innerHTML = '<div class="text-center py-5"><i class="fas fa-search text-muted mb-3" style="font-size: 2.5rem"></i><p>No matching favorites found</p><button class="btn btn-outline-primary" id="clear-favorites-search">Clear Search</button></div>';
                      
                      // 添加清除搜索按钮事件
                      document.getElementById('clear-favorites-search').addEventListener('click', function() {
                        favoritesSearchInput.value = '';
                        // 恢复原始数据显示
                        renderFavoriteItems(allFavoriteItems);
                        renderFavoritePagination(currentFavoritePage, totalFavoritePages, totalFavoriteItems);
                      });
                      
                      // 隐藏分页控件
                      tempPagination.innerHTML = '';
                    }
                  }
                }
              }, 500); // 500ms防抖延迟
            });
          }
        });

        // 添加令牌刷新函数
        function refreshTokenAndRetry(callback) {
          // 尝试获取刷新令牌
          const refreshToken = localStorage.getItem("refreshToken") || sessionStorage.getItem("refreshToken") || "";
          
          if (!refreshToken) {
            // 如果没有刷新令牌，需要重新登录
            handleSessionExpired();
            return;
          }
          
          // 调用刷新令牌API
          fetch('http://web.practicesnow.com/api/v1/auth/refresh', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify({ refresh_token: refreshToken })
          })
          .then(response => {
            const isSuccess = response.status >= 200 && response.status < 300;
            return response.json().then(data => {
              return { isSuccess, data, status: response.status };
            });
          })
          .then(result => {
            if (result.isSuccess && result.data.ok === 1) {
              // 成功刷新令牌
              const data = result.data.data;
              
              // 保存新令牌
              if (localStorage.getItem("accessToken")) {
                localStorage.setItem("accessToken", data.access_token);
                localStorage.setItem("refreshToken", data.refresh_token);
              } else {
                sessionStorage.setItem("accessToken", data.access_token);
                sessionStorage.setItem("refreshToken", data.refresh_token);
              }
              
              // 重试原始请求
              if (typeof callback === 'function') {
                callback();
              }
            } else {
              // 刷新令牌失败，需要重新登录
              handleSessionExpired();
            }
          })
          .catch(error => {
            console.error("Token refresh failed:", error);
            handleSessionExpired();
          });
        }

        // 处理会话过期
        function handleSessionExpired() {
          // 清除用户数据
          isLoggedIn = false;
          currentUser = null;
          
          // 清除本地存储的令牌
          localStorage.removeItem("accessToken");
          localStorage.removeItem("refreshToken");
          sessionStorage.removeItem("accessToken");
          sessionStorage.removeItem("refreshToken");
          
          // 显示通知
          showNotification(
            "warning",
            "Session Expired",
            "Your session has expired. Please login again."
          );
          
          // 更新UI
          document.getElementById("auth-buttons").style.display = "flex";
          document.getElementById("user-info").style.display = "none";
          
          // 显示登录模态框
          const authModal = new bootstrap.Modal(document.getElementById("authModal"));
          authModal.show();
        }

        // 添加检测中文输入的函数
        function checkChineseInput(inputElement) {
          // 检查输入是否包含中文字符
          if (/[\u4e00-\u9fa5]/.test(inputElement.value)) {
            // 如果没有警告提示，添加一个
            if (!inputElement.nextElementSibling || !inputElement.nextElementSibling.classList.contains('text-warning')) {
              const warningElement = document.createElement('small');
              warningElement.className = 'text-warning d-block mt-1';
              warningElement.textContent = 'Please use English characters';
              inputElement.parentNode.insertBefore(warningElement, inputElement.nextSibling);
              
              // 3秒后自动隐藏提示
              setTimeout(() => {
                if (warningElement.parentNode) {
                  warningElement.parentNode.removeChild(warningElement);
                }
              }, 3000);
            }
          }
        }
      </script>
      
      <!-- 添加删除确认模态框 -->
      <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="deleteConfirmModalLabel">Confirm Delete</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <p>Are you sure you want to delete this quiz? This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-danger" id="confirmDeleteButton">Delete</button>
            </div>
          </div>
        </div>
      </div>
  <!-- Dashboard Recent Activity Script -->
  <script src="js/dashboard/recent_activity.js"></script>
    </body>
  </html>
